<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media & Entertainment Technology Certifications | BTH Education Group - Professional Development & HEXAD Framework</title>
    <meta name="description" content="Master entertainment technology from content creation to distribution with certifications in broadcasting, streaming platforms, game engines, and production tools. across 15+ industry sectors. Professional development pathway or complete HEXAD framework.">
    
    <link rel="icon" type="image/png" href="../assets/images/favicon.png">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Technology Sector Specific Styling - minimal rebuild to fix corrupted block */
    :root { --focus-primary-color: #667eea; --it-primary: #667eea; --container-max: 1400px; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Arial, sans-serif; color: #0f172a; background: #ffffff; line-height: 1.5; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        /* Navigation */
        .tech-navbar { position: sticky; top: 0; z-index: 1000; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: #fff; }
    .tech-nav-container { max-width: var(--container-max); margin: 0 auto; padding: 0 2rem; height: 80px; display: flex; align-items: center; justify-content: space-between; }
    .tech-nav-menu { display: flex; gap: 1rem; }
    .tech-nav-logo { display:flex; align-items:center; gap:10px; color:#e2e8f0; text-decoration:none; font-weight:800; }
    .tech-navbar.scrolled { backdrop-filter: saturate(140%) blur(8px); background: rgba(15,23,42,0.9); border-bottom:1px solid rgba(148,163,184,0.15); }
        .tech-nav-link { color: #e2e8f0; text-decoration: none; position: relative; padding: 0.5rem 0.75rem; }
        .tech-nav-link:hover, .tech-nav-link.active { color: #ffffff; }
        .tech-nav-cta { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 0.75rem 1.5rem; border-radius: 25px; text-decoration: none; font-weight: 600; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; border: 2px solid transparent; }
        .tech-nav-toggle { display: none; flex-direction: column; cursor: pointer; background: none; border: none; padding: 0.5rem; }
        .tech-nav-toggle span { width: 25px; height: 3px; background: white; margin: 3px 0; border-radius: 2px; transition: all 0.3s ease; }
        @media (max-width: 968px) {
          .tech-nav-menu { position: fixed; top: 80px; left: 0; width: 100%; height: calc(100vh - 80px); background: rgba(15, 23, 42, 0.98); -webkit-backdrop-filter: blur(20px); backdrop-filter: blur(20px); flex-direction: column; justify-content: flex-start; padding-top: 2rem; transform: translateX(-100%); transition: transform 0.3s ease; gap: 0; }
          .tech-nav-menu.active { transform: translateX(0); }
          .tech-nav-toggle { display: flex; }
        }

                /* WORLD-CLASS HERO SECTION (restored) */
                .programs-hero { position: relative; background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #475569 75%, #64748b 100%); color: white; padding: 120px 0 160px; text-align: center; overflow: hidden; min-height: 80vh; display: flex; align-items: center; }
                .programs-hero::before { content: ''; position: absolute; inset: 0; background: radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(16, 185, 129, 0.2) 0%, transparent 50%), radial-gradient(circle at 40% 60%, rgba(139, 92, 246, 0.2) 0%, transparent 50%); animation: backgroundShift 20s ease-in-out infinite; }
                .programs-hero::after { content: ''; position: absolute; inset: 0; background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M30 30c0-16.569 13.431-30 30-30v60c-16.569 0-30-13.431-30-30z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); animation: patternFloat 25s linear infinite; }
                @keyframes backgroundShift { 0%, 100% { background: radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(16, 185, 129, 0.2) 0%, transparent 50%), radial-gradient(circle at 40% 60%, rgba(139, 92, 246, 0.2) 0%, transparent 50%);} 33% { background: radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.2) 0%, transparent 50%), radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.3) 0%, transparent 50%), radial-gradient(circle at 60% 40%, rgba(59, 130, 246, 0.2) 0%, transparent 50%);} 66% { background: radial-gradient(circle at 40% 80%, rgba(139, 92, 246, 0.2) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.3) 0%, transparent 50%), radial-gradient(circle at 20% 40%, rgba(16, 185, 129, 0.2) 0%, transparent 50%);} }
                @keyframes patternFloat { 0% { transform: translateY(0px) rotate(0deg);} 100% { transform: translateY(-60px) rotate(360deg);} }
                .hero-content { position: relative; z-index: 10; width: 100%; max-width: var(--container-max); margin: 0 auto; padding: 0 2rem; }
                .hero-badge { display: inline-flex; align-items: center; background: rgba(255, 255, 255, 0.1); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 50px; padding: 0.75rem 1.5rem; margin-bottom: 2rem; font-size: 0.9rem; font-weight: 600; color: #e2e8f0; animation: fadeInUp 1s ease-out 0.2s both; }
                .hero-badge .badge-icon { width: 20px; height: 20px; margin-right: 0.5rem; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; }
                .programs-hero h1 { font-size: clamp(2.5rem, 5vw, 4.5rem); font-weight: 800; margin-bottom: 1.5rem; line-height: 1.1; background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 50%, #cbd5e1 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: fadeInUp 1s ease-out 0.4s both; }
                .programs-hero .subtitle { font-size: 1.25rem; opacity: 0.9; margin-bottom: 3rem; max-width: 700px; margin-left: auto; margin-right: auto; line-height: 1.6; color: #cbd5e1; animation: fadeInUp 1s ease-out 0.6s both; }
                @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px);} to { opacity: 1; transform: translateY(0);} }
                .hero-cta-section { margin: 3rem 0; animation: fadeInUp 1s ease-out 0.8s both; }
                .hero-cta-buttons { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 2rem; }
                .hero-primary-btn { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; padding: 1rem 2.5rem; border-radius: 50px; text-decoration: none; font-weight: 700; font-size: 1.1rem; transition: all 0.3s ease; border: 2px solid transparent; position: relative; overflow: hidden; }
                .hero-primary-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s; }
                .hero-primary-btn:hover::before { left: 100%; }
                .hero-primary-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4); }
                .hero-secondary-btn { background: transparent; color: white; padding: 1rem 2.5rem; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 1.1rem; border: 2px solid rgba(255, 255, 255, 0.3); transition: all 0.3s ease; -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); }
                .hero-secondary-btn:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.5); transform: translateY(-2px); }

            /* Hero stats and badges (fix distortions) */
            .programs-hero .level-system-badge { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: #e2e8f0; margin: 0.75rem 0 0.75rem; }
            .partner-badge { display:inline-flex; align-items:center; gap:0.5rem; background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.18); color:#e2e8f0; border-radius: 50px; padding: 0.5rem 1rem; font-size: 0.9rem; font-weight: 600; margin-top: 0.5rem; }
            .partner-badge i { color: #fbbf24; }
            .programs-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 2rem; margin-top: 4rem; max-width: 1000px; margin-left: auto; margin-right: auto; animation: fadeInUp 1s ease-out 1s both; }
            .stat-card { background: rgba(255, 255, 255, 0.1); -webkit-backdrop-filter: blur(15px); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; padding: 2rem 1.5rem; text-align: center; transition: all 0.3s ease; position: relative; overflow: hidden; }
            .stat-number { font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
            .stat-label { font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: #cbd5e1; }
        /* Filters & modal */
    .filter-section { background: #f8fafc; padding: 60px 0; margin: 3rem 0; border-top: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; position: static; top: auto; z-index: auto; }
    @media (max-width: 768px) { .filter-section { position: static; top: auto; } }
        .modal-backdrop { position: fixed; inset: 0; background: rgba(15,23,42,0.55); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal-backdrop.active { display: flex; }
    .modal-card { background: #fff; border-radius: 14px; box-shadow: 0 20px 60px rgba(15,23,42,0.3); width: min(720px, 92vw); max-height: 85vh; overflow: auto; border: 1px solid #e2e8f0; }
        .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.25rem; border-bottom: 1px solid #e2e8f0; }
        .modal-title { font-size: 1.05rem; font-weight: 700; color: #1e293b; }
        .modal-close { background: transparent; border: none; font-size: 1.1rem; cursor: pointer; color: #64748b; }
    .modal-body { padding: 0.85rem 1rem; color: #334155; }
        .kv { display: grid; grid-template-columns: 160px 1fr; gap: 0.4rem 1rem; }
        .kv .k { color: #64748b; }
        .kv .v { color: #1f2937; }
        .info-button { background: #eef2ff; color: #3730a3; border: 1px solid #c7d2fe; border-radius: 8px; padding: 0.35rem 0.6rem; font-size: 0.85rem; cursor: pointer; }
    /* Rich modal sections */
    .modal-sections { display: grid; gap: 0.75rem; }
    .modal-section { background:#f8fafc; border:1px solid #e2e8f0; border-radius:12px; padding:0.75rem 0.9rem; position: relative; }
    .modal-section h3 { margin:0 0 0.3rem; font-size:1rem; color:#0f172a; display:flex; align-items:center; gap:0.5rem; cursor: pointer; }
    .modal-section .section-icon { font-size:0.95rem; opacity:0.95; }
    .modal-section p { margin:0.25rem 0; color:#334155; line-height:1.6; }
    .modal-section ul { margin:0.25rem 0 0.25rem 1.1rem; color:#334155; }
    .modal-section .chev { margin-left:auto; color:#64748b; transition: transform 0.18s ease; }
    .modal-section.collapsed .chev { transform: rotate(-90deg); }
    .modal-section.collapsed > p, .modal-section.collapsed > ul { display:none; }
    .modal-section.collapsed { padding-bottom: 0.5rem; }
    /* Brand-themable section colors */
    :root {
        --sec-focus: #2563eb;
        --sec-purpose: #0ea5e9;
        --sec-impact: #16a34a;
        --sec-usecases: #a855f7;
        --sec-roles: #f59e0b;
        --sec-comp: #ef4444;
        --sec-pd: #06b6d4;
    }
    /* Section theme modifiers */
    .modal-section.-focus { border-left:4px solid var(--sec-focus); background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%); }
    .modal-section.-focus h3 .section-icon { color: var(--sec-focus); }
    .modal-section.-purpose { border-left:4px solid var(--sec-purpose); background: linear-gradient(180deg, #f8fafc 0%, #f0f9ff 100%); }
    .modal-section.-purpose h3 .section-icon { color: var(--sec-purpose); }
    .modal-section.-impact { border-left:4px solid var(--sec-impact); background: linear-gradient(180deg, #f8fafc 0%, #ecfdf5 100%); }
    .modal-section.-impact h3 .section-icon { color: var(--sec-impact); }
    .modal-section.-usecases { border-left:4px solid var(--sec-usecases); background: linear-gradient(180deg, #f8fafc 0%, #faf5ff 100%); }
    .modal-section.-usecases h3 .section-icon { color: var(--sec-usecases); }
    .modal-section.-roles { border-left:4px solid var(--sec-roles); background: linear-gradient(180deg, #f8fafc 0%, #fffbeb 100%); }
    .modal-section.-roles h3 .section-icon { color: var(--sec-roles); }
    .modal-section.-comp { border-left:4px solid var(--sec-comp); background: linear-gradient(180deg, #f8fafc 0%, #fef2f2 100%); }
    .modal-section.-comp h3 .section-icon { color: var(--sec-comp); }
    .modal-section.-pd { border-left:4px solid var(--sec-pd); background: linear-gradient(180deg, #f8fafc 0%, #ecfeff 100%); }
    .modal-section.-pd h3 .section-icon { color: var(--sec-pd); }
    .modal-meta { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap:0.5rem; margin-top:0.6rem; }
    .modal-chip { background:#eef2ff; border:1px solid #c7d2fe; color:#1e3a8a; border-radius:999px; padding:0.2rem 0.55rem; font-weight:600; font-size:0.83rem; display:inline-flex; align-items:center; gap:0.35rem; }
    /* Premium meta grid (columns: label over value per column) */
    .meta-grid { display:grid; grid-template-columns: repeat(5, 1fr); border:1px solid #e2e8f0; border-radius:12px; overflow:hidden; margin-bottom:0.5rem; }
    .meta-grid .col { display:flex; flex-direction:column; border-right:1px solid #e2e8f0; }
    .meta-grid .col:last-child { border-right:none; }
    .meta-grid .label { background:#f1f5f9; color:#475569; font-weight:700; text-transform:uppercase; letter-spacing:0.02em; font-size:0.78rem; padding:0.5rem 0.7rem; border-bottom:1px solid #e2e8f0; }
    .meta-grid .value { color:#0f172a; font-weight:600; padding:0.5rem 0.7rem; font-size:0.9rem; }
    /* Ensure meta grid spans full width within kv grid container */
    .kv .meta-grid { grid-column: 1 / -1; }
    .kv .meta-divider { height:1px; background:#e2e8f0; margin:0.5rem 0 0.75rem; grid-column: 1 / -1; }
    @media (max-width: 1024px) {
        .meta-grid { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 640px) {
        .meta-grid { grid-template-columns: repeat(2, 1fr); }
    }
        /* Footer */
    .main-footer { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: #e2e8f0; padding: 0; margin-top: 4rem; }
    .main-footer .container { max-width: var(--container-max); margin: 0 auto; padding: 0 2rem; }

        /* Level System Badge */
        .level-system-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(139, 92, 246, 0.15);
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 50px;
            color: #5b21b6;
            padding: 0.35rem 0.75rem;
            gap: 0.5rem;
            font-weight: 700;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(79, 172, 254, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }
        
        .stat-card:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .stat-number {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 0.75rem;
            background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 2;
            display: block;
        }
        
        .stat-label {
            font-size: 1rem;
            font-weight: 600;
            color: #cbd5e1;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        /* Framework Selection */
        .framework-selection {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 80px 0;
            margin-bottom: 2rem;
        }

        .framework-selection .container {
            max-width: var(--container-max);
            margin: 0 auto;
            padding: 0 2rem;
        }

        .framework-selection h2 {
            text-align: center;
            font-size: 2.5rem;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .framework-subtitle {
            text-align: center;
            font-size: 1.2rem;
            color: #64748b;
            margin-bottom: 3rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .framework-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 3rem;
            margin-top: 3rem;
        }

        .framework-card {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .framework-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--it-primary);
        }

        .framework-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 30px 80px rgba(102, 126, 234, 0.2);
        }

        .framework-card.premium::before {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
        }
        /* Framework Features List */
        .framework-features { list-style: none; margin: 1.5rem 0; padding: 0; }
        .framework-features li { padding: 0.75rem 0; display: flex; align-items: center; border-bottom: 1px solid #f1f5f9; }
        .framework-features li:last-child { border-bottom: none; }
        .framework-features i { color: #10b981; margin-right: 1rem; width: 20px; }

        /* Modules cards styling */
        #level-modules { margin-top: 2rem; }
        #level-modules h3 { text-align: center; color: #1e293b; margin-bottom: 1rem; }
    .modules-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1.5rem; max-width: var(--container-max); margin: 0 auto; }
        .module-card { background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 1.25rem; box-shadow: 0 8px 24px rgba(0,0,0,0.06); display: flex; flex-direction: column; align-items: center; text-align: center; }
        .module-icon { font-size: 1.8rem; color: #10b981; margin-bottom: 0.5rem; }
        .module-title { font-weight: 700; color: #1e293b; margin-bottom: 0.25rem; }
        .module-desc { color: #64748b; font-size: 0.95rem; }

        .cta-button {
            width: 100%;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .cta-standard {
            background: var(--it-primary);
            color: white;
        }

        .cta-premium {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1e293b;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Category Overview */
        .category-overview {
            padding: 60px 0;
        }

        .category-overview .container {
            max-width: var(--container-max);
            margin: 0 auto;
            padding: 0 2rem;
        }

        .category-overview h2 {
            font-size: 2.5rem;
            text-align: center;
            color: #1e293b;
            margin-bottom: 3rem;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .category-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--focus-primary-color);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .category-card:hover::before {
            transform: scaleX(1);
        }

        .category-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(102, 126, 234, 0.2);
        }

        .category-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .category-header i {
            font-size: 2rem;
            margin-right: 1rem;
            color: var(--focus-primary-color);
        }

        .category-header h3 {
            font-size: 1.4rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .category-description {
            color: #64748b;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .focus-areas {
            margin: 1rem 0;
        }

        .focus-areas strong {
            color: #1e293b;
            display: block;
            margin-bottom: 0.5rem;
        }

        .focus-area-tag {
            display: inline-block;
            background: #f1f5f9;
            color: #475569;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .focus-area-tag:hover {
            background: var(--focus-primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .vendors-list {
            margin: 1rem 0;
        }

        .vendors-list strong {
            color: #1e293b;
            display: block;
            margin-bottom: 0.5rem;
        }

        .vendor-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 500;
            margin: 0.25rem;
            border: 1px solid;
            cursor: pointer;
            user-select: none;
        }

        .vendor-badge.premium {
            background: #fef3c7;
            color: #92400e;
            border-color: #fcd34d;
        }

        .vendor-badge.standard {
            background: #f1f5f9;
            color: #475569;
            border-color: #cbd5e1;
        }

        /* Advanced Filtering System */
        .filter-section {
            background: #f8fafc;
            padding: 60px 0;
            margin: 3rem 0;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            position: static;
            top: auto;
            z-index: auto;
        }
        @media (max-width: 768px) {
            .filter-section { position: static; top: auto; }
        }
        /* Pagination controls */
        .pagination { display:flex; gap:0.5rem; justify-content:center; align-items:center; margin: 1.25rem 0; flex-wrap: wrap; }
        .page-btn { background:#fff; border:1px solid #e2e8f0; color:#334155; padding:0.5rem 0.9rem; border-radius:8px; cursor:pointer; font-weight:600; }
        .page-btn:hover { background:#f8fafc; }
        .page-btn[disabled] { opacity:0.5; cursor:not-allowed; }
        .page-indicator { color:#64748b; font-size:0.95rem; margin:0 0.5rem; }

        .filter-section .container {
            max-width: var(--container-max);
            margin: 0 auto;
            padding: 0 2rem;
        }

        .filter-section h2 {
            text-align: center;
            font-size: 2.5rem;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .filter-subtitle {
            text-align: center;
            font-size: 1.2rem;
            color: #64748b;
            margin-bottom: 3rem;
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto 2rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1.5rem 1rem 3rem;
            border: 2px solid #e2e8f0;
            border-radius: 50px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--focus-primary-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1.2rem;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            max-width: var(--container-max);
            margin: 0 auto;
        }

        .filter-group {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .filter-group h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--focus-primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn-secondary, .btn-primary {
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #d1d5db;
        }

        .btn-primary {
            background: var(--it-primary);
            color: white;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }

        /* Active filter chips */
        .filter-chips { display:flex; flex-wrap:wrap; gap:0.5rem; justify-content:center; margin: 0.5rem 0 0; }
        .filter-chip { display:inline-flex; align-items:center; gap:0.4rem; background:#eef2ff; color:#1e3a8a; border:1px solid #c7d2fe; padding:0.25rem 0.55rem; border-radius:999px; font-weight:600; font-size:0.82rem; }
        .filter-chip button { background:transparent; border:none; color:#475569; cursor:pointer; font-size:0.9rem; line-height:1; }

        /* Compact density adjustments */
        .grid-compact .cert-card-premium { padding: 1rem !important; }
        .grid-compact .cert-card-premium h4 { font-size: 1rem !important; }
    /* vendor logo uses direct <img> with fixed height; wrapper removed */

        /* Lightweight modal overlay */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(15,23,42,0.55); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal-backdrop.active { display: flex; }
        .modal-card { background: #fff; border-radius: 14px; box-shadow: 0 20px 60px rgba(15,23,42,0.3); width: min(720px, 92vw); max-height: 85vh; overflow: auto; border: 1px solid #e2e8f0; }
        .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.25rem; border-bottom: 1px solid #e2e8f0; }
        .modal-title { font-size: 1.05rem; font-weight: 700; color: #1e293b; }
        .modal-close { background: transparent; border: none; font-size: 1.1rem; cursor: pointer; color: #64748b; }
        .modal-body { padding: 1rem 1.25rem; color: #334155; }
        .kv { display: grid; grid-template-columns: 160px 1fr; gap: 0.4rem 1rem; }
        .kv .k { color: #64748b; }
        .kv .v { color: #1f2937; }
        .info-button { background: #eef2ff; color: #3730a3; border: 1px solid #c7d2fe; border-radius: 8px; padding: 0.35rem 0.6rem; font-size: 0.85rem; cursor: pointer; }

        /* Footer Styling */
        .main-footer {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            padding: 0;
            margin-top: 4rem;
        }
        .main-footer .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-start;
            padding: 60px 0 30px;
            gap: 2rem;
        }
        @media (min-width: 1024px) {
            .footer-content {
                display: grid;
                grid-template-columns: minmax(320px, 420px) 1fr;
                align-items: flex-start;
                gap: 3rem;
            }
        }
        .footer-brand {
            flex: 1 1 260px;
            margin-bottom: 2rem;
        }
        .footer-brand .logo-text {
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: #e2e8f0;
        }
        .footer-brand .logo-text:hover { color:#ffffff; }
        .footer-brand p { color:#cbd5e1; margin: 0.75rem 0 1rem; line-height: 1.6; }
        .footer-contact { color:#cbd5e1; font-size:0.98rem; }
        .footer-contact a { color:#a5b4fc; text-decoration:none; }
        .footer-contact a:hover { color:#4facfe; }
        .footer-social { display:flex; gap:0.6rem; margin-top:0.75rem; }
        .footer-social a { display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:50%; border:1px solid rgba(255,255,255,0.18); color:#e2e8f0; text-decoration:none; transition:all 0.2s; }
        .footer-social a:hover { background:rgba(255,255,255,0.08); color:#ffffff; border-color:rgba(255,255,255,0.3); transform: translateY(-1px); }
        .footer-links {
            display: flex;
            flex: 2 1 500px;
            gap: 3rem;
            flex-wrap: wrap;
        }
        @media (min-width: 1024px) {
            .footer-links { display:grid; grid-template-columns: repeat(4, minmax(220px, 1fr)); align-items:flex-start; column-gap: 2rem; }
        }
        .footer-column {
            min-width: 220px;
        }
        .footer-column h4 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #a5b4fc;
        }
        .footer-column ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-column ul li {
            margin-bottom: 0.7rem;
        }
        .footer-column ul li a {
            color: #e2e8f0;
            text-decoration: none;
            font-size: 0.98rem;
            transition: color 0.2s;
        }
        @media (min-width: 1024px) {
            .footer-column ul li a { white-space: nowrap; }
        }
        .footer-column ul li a:hover,
        .footer-column ul li a.active {
            color: #4facfe;
        }
        .footer-bottom {
            border-top: 1px solid rgba(255,255,255,0.08);
            padding: 18px 0 10px;
            text-align: center;
            font-size: 0.95rem;
            color: #cbd5e1;
        }
        .footer-legal {
            margin-top: 0.5rem;
        }
        .footer-legal a {
            color: #a5b4fc;
            margin: 0 0.7rem;
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.2s;
        }
        .footer-legal a:hover {
            color: #4facfe;
        }
        @media (max-width: 900px) {
            .footer-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 2rem;
            }
            .footer-links {
                gap: 2rem;
            }
        }
        @media (max-width: 600px) {
            .main-footer .container {
                padding: 0 1rem;
            }
            .footer-content {
                padding: 40px 0 20px;
            }
            .footer-links {
                flex-direction: column;
                gap: 1.5rem;
            }
            .footer-column {
                min-width: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <!-- NAVIGATION - COPIED FROM technology-old.html -->
<nav class="tech-navbar" id="techNavbar">
    <div class="tech-nav-container">
        <a href="../index.html" class="tech-nav-logo">
            <div class="logo-icon">
                <i class="fas fa-microchip"></i>
            </div>
            BTH Education Group
        </a>
        
        <div class="tech-nav-menu" id="techNavMenu">
            <a href="../index.html" class="tech-nav-link">Home</a>
            <a href="../program.html" class="tech-nav-link active">Programs</a>
            <a href="../about.html" class="tech-nav-link">About</a>
            <a href="../contact.html" class="tech-nav-link">Contact</a>
            <a href="../apply.html" class="tech-nav-link">Apply</a>
            <a href="../hexad-mastery.html" class="tech-nav-cta">HEXAD Framework</a>
        </div>
        
        <button class="tech-nav-toggle" id="techNavToggle">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </div>
</nav>

    <!-- FLAGSHIP Media & Enterta HERO SECTION - EXACT COPY FROM technology-old.html -->
    <section class="programs-hero">
        <div class="hero-content">
            <div class="hero-badge">
                <div class="badge-icon">
                    <i class="fas fa-microchip"></i>
                </div>
                Media & Entertainment Technology Excellence
            </div>
            <div class="level-system-badge">
                <i class="fas fa-layer-group"></i>
                Level 1-5 Professional System
            </div>
            <div class="partner-badge" title="Authorized Pearson VUE Exam Delivery Partner">
                <i class="fas fa-certificate"></i>
                Authorized Pearson VUE Exam Delivery Partner (Site ID: 89828)
            </div>
            
            <h1>Media & Enterta Professional Certification Pathways</h1>
            <p class="subtitle">Master the complete Media & Entertainment Technology landscape through our comprehensive Level 1-5 certification system across 6 major domains and 47 industry-leading vendor partnerships.</p>
            
            <div class="hero-cta-section">
                <div class="hero-cta-buttons">
                    <a href="#framework-selection" class="hero-primary-btn">
                        <i class="fas fa-rocket"></i> Choose Your Framework
                    </a>
                    <a href="#certification-filtering" class="hero-secondary-btn">
                        <i class="fas fa-sitemap"></i> Browse Certifications
                    </a>
                </div>
            </div>

            <!-- Media & Enterta Statistics -->
            <div class="programs-stats">
                <div class="stat-card">
                    <div class="stat-number">500+</div>
                    <div class="stat-label">Certifications</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">15+</div>
                    <div class="stat-label">Industry Sectors</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">39</div>
                    <div class="stat-label">Vendor Partners</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">2</div>
                    <div class="stat-label">Framework Options</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Framework Selection -->
    <section id="framework-selection" class="framework-selection">
        <div class="container">
            <h2>Choose Your Learning Framework</h2>
            <p class="framework-subtitle">Select the pathway that aligns with your development goals</p>
            
            <div class="framework-cards">
                <!-- Standard Professional Pathway -->
                <div class="framework-card standard" data-framework="standard">
                    <div class="framework-title">Standard Professional Pathway</div>
                    <div class="framework-description">Professional development focused certification pathway for career advancement in technology sectors.</div>
                    
                    <div class="framework-price">
                        <span class="price-range">$8,100 - $26,865</span>
                        <span class="price-label">Professional development focused</span>
                    </div>
                    
                    <ul class="framework-features">
                        <li><i class="fas fa-check"></i> Industry-Leading Certifications</li>
                        <li><i class="fas fa-check"></i> Professional Ethics & Communication Skills</li>
                        <li><i class="fas fa-check"></i> Career Skills & Leadership Development</li>
                        <li><i class="fas fa-check"></i> AI Integration & Emerging Technologies</li>
                        <li><i class="fas fa-check"></i> Level 1-5 Progression System</li>
                        <li><i class="fas fa-check"></i> Industry Mentor Network Access</li>
                    </ul>
                    
                    <button class="cta-button cta-standard" onclick="selectFramework('standard')">
                        Choose Standard Pathway
                    </button>
                </div>
                
                <!-- HEXAD Complete Framework -->
                <div class="framework-card premium" data-framework="hexad">
                    <div class="framework-title">HEXAD Complete Framework</div>
                    <div class="framework-description">Complete human development system including career, personal growth, financial success, and relationship mastery.</div>
                    
                    <div class="framework-price">
                        <span class="price-range">$12,936.65 - $41,371.65</span>
                        <span class="price-label">6-dimensional complete development</span>
                    </div>
                    
                    <ul class="framework-features">
                        <li><i class="fas fa-check"></i> <strong>Professional Development:</strong> All Standard features included</li>
                        <li><i class="fas fa-check"></i> <strong>Personal Development:</strong> Character, Skills & Wisdom</li>
                        <li><i class="fas fa-check"></i> <strong>Occupational Development:</strong> Work Excellence & Leadership</li>
                        <li><i class="fas fa-check"></i> <strong>Financial Development:</strong> Wealth Building & Investment</li>
                        <li><i class="fas fa-check"></i> <strong>Relationship Development:</strong> Communication & Social Mastery</li>
                        <li><i class="fas fa-check"></i> <strong>Truth Education:</strong> Critical Thinking & Wisdom</li>
                    </ul>
                    
                    <button class="cta-button cta-premium" onclick="selectFramework('hexad')">
                        Choose HEXAD Framework
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Category Overview -->
    <section class="category-overview">
        <div class="container">
            <h2>Technology Certification Categories</h2>
            
            <div class="category-grid">
                <!-- Core Media & Enterta Foundations & Networking -->
                <div class="category-card" data-category="core-it">
                    <div class="category-header">
                        <i class="fas fa-network-wired"></i>
                        <h3>Core Media & Enterta Foundations & Networking</h3>
                    </div>
                    <div class="category-description">
                        Build fundamental Media & Enterta skills and advanced networking expertise for enterprise environments.
                    </div>
                    <div class="focus-areas">
                        <strong>Focus Areas:</strong>
                        <span class="focus-area-tag">Foundations</span>
                        <span class="focus-area-tag">OS</span>
                        <span class="focus-area-tag">Enterprise R&S</span>
                        <span class="focus-area-tag">Wireless</span>
                        <span class="focus-area-tag">5G/SP</span>
                    </div>
                    <div class="vendors-list">
                        <strong>Vendor Partners:</strong>
                        <span class="vendor-badge premium">CompTIA</span>
                        <span class="vendor-badge premium">Cisco</span>
                        <span class="vendor-badge standard">Juniper</span>
                        <span class="vendor-badge standard">Aruba</span>
                        <span class="vendor-badge premium">CWNP</span>
                        <span class="vendor-badge standard">Nokia</span>
                        <span class="vendor-badge standard">Huawei</span>
                        <span class="vendor-badge standard">ZTE</span>
                        <span class="vendor-badge standard">Fortinet</span>
                    </div>
                </div>

                <!-- Cloud & Platforms -->
                <div class="category-card" data-category="cloud-platforms">
                    <div class="category-header">
                        <i class="fas fa-cloud"></i>
                        <h3>Cloud & Platforms</h3>
                    </div>
                    <div class="category-description">
                        Master cloud computing, virtualization, and modern platform technologies.
                    </div>
                    <div class="focus-areas">
                        <strong>Focus Areas:</strong>
                        <span class="focus-area-tag">Public Cloud</span>
                        <span class="focus-area-tag">Virtualization</span>
                        <span class="focus-area-tag">Linux</span>
                        <span class="focus-area-tag">Data Platforms</span>
                        <span class="focus-area-tag">Modern Workplace</span>
                    </div>
                    <div class="vendors-list">
                        <strong>Vendor Partners:</strong>
                        <span class="vendor-badge premium">AWS</span>
                        <span class="vendor-badge premium">Microsoft</span>
                        <span class="vendor-badge premium">Google Cloud</span>
                        <span class="vendor-badge standard">Red Hat</span>
                        <span class="vendor-badge standard">SUSE</span>
                        <span class="vendor-badge premium">VMware/Omnissa</span>
                        <span class="vendor-badge standard">Snowflake</span>
                        <span class="vendor-badge standard">MongoDB</span>
                        <span class="vendor-badge standard">NetApp</span>
                        <span class="vendor-badge standard">Oracle</span>
                    </div>
                </div>

                <!-- Cybersecurity & Privacy -->
                <div class="category-card" data-category="cybersecurity">
                    <div class="category-header">
                        <i class="fas fa-shield-alt"></i>
                        <h3>Cybersecurity & Privacy</h3>
                    </div>
                    <div class="category-description">
                        Comprehensive cybersecurity training from blue team defense to offensive security.
                    </div>
                    <div class="focus-areas">
                        <strong>Focus Areas:</strong>
                        <span class="focus-area-tag">Blue Team</span>
                        <span class="focus-area-tag">Offensive Security</span>
                        <span class="focus-area-tag">Cloud Security</span>
                        <span class="focus-area-tag">GRC & Audit</span>
                        <span class="focus-area-tag">Privacy</span>
                    </div>
                    <div class="vendors-list">
                        <strong>Vendor Partners:</strong>
                        <span class="vendor-badge premium">CompTIA</span>
                        <span class="vendor-badge premium">(ISC)Â²</span>
                        <span class="vendor-badge premium">ISACA</span>
                        <span class="vendor-badge standard">EC-Council</span>
                        <span class="vendor-badge standard">GIAC</span>
                        <span class="vendor-badge standard">IAPP</span>
                        <span class="vendor-badge standard">CSA</span>
                        <span class="vendor-badge standard">Fortinet</span>
                    </div>
                </div>

                <!-- Software Development & DevOps -->
                <div class="category-card" data-category="software-devops">
                    <div class="category-header">
                        <i class="fas fa-code"></i>
                        <h3>Software Development & DevOps</h3>
                    </div>
                    <div class="category-description">
                        Modern software development, CI/CD, containers, and DevOps methodologies.
                    </div>
                    <div class="focus-areas">
                        <strong>Focus Areas:</strong>
                        <span class="focus-area-tag">Programming</span>
                        <span class="focus-area-tag">CI/CD</span>
                        <span class="focus-area-tag">Containers</span>
                        <span class="focus-area-tag">Kubernetes</span>
                        <span class="focus-area-tag">Application Platforms</span>
                        <span class="focus-area-tag">Databases</span>
                    </div>
                    <div class="vendors-list">
                        <strong>Vendor Partners:</strong>
                        <span class="vendor-badge premium">Microsoft</span>
                        <span class="vendor-badge standard">Red Hat</span>
                        <span class="vendor-badge standard">SUSE</span>
                        <span class="vendor-badge premium">VMware/Omnissa</span>
                        <span class="vendor-badge standard">MongoDB</span>
                        <span class="vendor-badge standard">Zend</span>
                        <span class="vendor-badge standard">Qt</span>
                        <span class="vendor-badge standard">CNCF</span>
                    </div>
                </div>

                <!-- Media & Enterta Governance & Agile -->
                <div class="category-card" data-category="governance-agile">
                    <div class="category-header">
                        <i class="fas fa-tasks"></i>
                        <h3>Media & Enterta Governance & Agile</h3>
                    </div>
                    <div class="category-description">
                        Media & Enterta service management, project management, and agile methodologies.
                    </div>
                    <div class="focus-areas">
                        <strong>Focus Areas:</strong>
                        <span class="focus-area-tag">Service Management</span>
                        <span class="focus-area-tag">Project/Program/Portfolio</span>
                        <span class="focus-area-tag">Agile Frameworks</span>
                        <span class="focus-area-tag">Media & Enterta Governance & Audit</span>
                    </div>
                    <div class="vendors-list">
                        <strong>Vendor Partners:</strong>
                        <span class="vendor-badge premium">PeopleCert</span>
                        <span class="vendor-badge premium">PMI</span>
                        <span class="vendor-badge premium">ISACA</span>
                        <span class="vendor-badge standard">Scrum Alliance</span>
                    </div>
                </div>

                <!-- Specialized Technical -->
                <div class="category-card" data-category="specialized-tech">
                    <div class="category-header">
                        <i class="fas fa-cogs"></i>
                        <h3>Specialized Technical</h3>
                    </div>
                    <div class="category-description">
                        Advanced technical specializations in data protection, observability, and enterprise platforms.
                    </div>
                    <div class="focus-areas">
                        <strong>Focus Areas:</strong>
                        <span class="focus-area-tag">Storage & Data Protection</span>
                        <span class="focus-area-tag">Observability & SIEM</span>
                        <span class="focus-area-tag">Virtualization & EUC</span>
                        <span class="focus-area-tag">Data Platforms</span>
                    </div>
                    <div class="vendors-list">
                        <strong>Vendor Partners:</strong>
                        <span class="vendor-badge standard">Veeam</span>
                        <span class="vendor-badge standard">Splunk</span>
                        <span class="vendor-badge standard">Citrix</span>
                        <span class="vendor-badge standard">NetApp</span>
                        <span class="vendor-badge standard">Teradata</span>
                        <span class="vendor-badge premium">VMware/Omnissa</span>
                        <span class="vendor-badge standard">ForgeRock</span>
                        <span class="vendor-badge standard">ETA International</span>
                    </div>
                </div>

                <!-- Emerging Technologies -->
                <div class="category-card" data-category="emerging-tech">
                    <div class="category-header">
                        <i class="fas fa-rocket"></i>
                        <h3>Emerging Technologies</h3>
                    </div>
                    <div class="category-description">
                        Cutting-edge technologies including AI, blockchain, IoT, and quantum computing.
                    </div>
                    <div class="focus-areas">
                        <strong>Focus Areas:</strong>
                        <span class="focus-area-tag">AI & ML</span>
                        <span class="focus-area-tag">IoT</span>
                        <span class="focus-area-tag">Blockchain</span>
                        <span class="focus-area-tag">AR/VR & Metaverse</span>
                        <span class="focus-area-tag">Quantum Computing</span>
                    </div>
                    <div class="vendors-list">
                        <strong>Vendor Partners:</strong>
                        <span class="vendor-badge premium">Microsoft</span>
                        <span class="vendor-badge premium">AWS</span>
                        <span class="vendor-badge premium">Google Cloud</span>
                        <span class="vendor-badge standard">Linux Foundation</span>
                        <span class="vendor-badge standard">Unity</span>
                        <span class="vendor-badge standard">NVIDIA</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Advanced Filtering System -->
    <section id="certification-filtering" class="filter-section">
        <div class="container">
            <h2>Advanced Certification Filtering</h2>
            <div style="text-align:center;margin-top:0.5rem;">
                <img src="../assets/badges/dataset-health.svg" alt="Dataset Health" style="height:20px;vertical-align:middle;" onerror="this.style.display='none'">
            </div>
            <p class="filter-subtitle">Find the perfect certifications for your career goals with our intelligent filtering system</p>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="Search certifications, vendors, or technologies..." />
            </div>
            
            <div class="filter-grid">
                <div class="filter-group">
                    <h4><i class="fas fa-layer-group"></i> Level</h4>
                    <select id="levelFilter">
                        <option value="">All Levels</option>
                        <option value="1">Level 1 - Foundation</option>
                        <option value="2">Level 2 - Associate</option>
                        <option value="3">Level 3 - Professional</option>
                        <option value="4">Level 4 - Expert</option>
                        <option value="5">Level 5 - Master</option>
                    </select>
                    <div id="levelHint" style="color:#64748b;font-size:0.85rem;margin-top:0.35rem;">
                        Tip: Level N includes Levels 1..N; earlier foundations remain visible and recommended.
                    </div>
                    <div id="quickPickRow" style="margin-top:0.5rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
                        <button class="btn-secondary" id="quickPickPrimary" title="Auto-select a recommended subset for this vendor & level">Quick Pick</button>
                        <button class="btn-secondary" id="quickPickClear" title="Clear current level selections">Clear Level Picks</button>
                    </div>
                </div>
                <div class="filter-group">
                    <h4><i class="fas fa-tags"></i> Category</h4>
                    <select id="categoryFilter">
                        <option value="">All Categories</option>
                        <!-- options populated dynamically from dataset -->
                    </select>
                </div>
                <div class="filter-group">
                    <h4><i class="fas fa-filter"></i> Focus Area</h4>
                    <select id="focusFilter">
                        <option value="">All Focus Areas</option>
                        <option value="Foundations">Foundations</option>
                        <option value="Enterprise R&S">Enterprise R&S</option>
                        <option value="Wireless">Wireless</option>
                        <option value="Public Cloud">Public Cloud</option>
                        <option value="Virtualization">Virtualization</option>
                        <option value="AI & ML">AI & ML</option>
                        <option value="Cybersecurity">Cybersecurity</option>
                        <option value="DevOps">DevOps</option>
                        <!-- Add more as needed -->
                    </select>
                </div>
                <div class="filter-group">
                    <h4><i class="fas fa-share-nodes"></i> Track (multi-select)</h4>
                    <select id="trackFilter" multiple size="6" aria-label="Select one or more tracks">
                        <!-- populated from dataset -->
                    </select>
                    <div style="color:#64748b;font-size:0.85rem;margin-top:0.35rem;">Tip: Hold Cmd/Ctrl to select multiple. Leave empty for all.</div>
                </div>
                <div class="filter-group">
                    <h4><i class="fas fa-building"></i> Vendor <span class="vendor-count">(39)</span></h4>
                    <select id="vendorFilter">
                        <option value="">All Vendors</option>
                        <option value="Juniper">Juniper</option>
                        <option value="Aruba">Aruba</option>
                        <option value="Nokia">Nokia</option>
                        <option value="Huawei">Huawei</option>
                        <option value="ZTE">ZTE</option>
                        <option value="Salesforce">Salesforce</option>
                        <option value="Fortinet">Fortinet</option>
                        <option value="AWS">Amazon AWS</option>
                        <option value="SUSE">SUSE</option>
                        <option value="VMware/Omnissa">VMware/Omnissa</option>
                        <option value="Snowflake">Snowflake</option>
                        <option value="MongoDB">MongoDB</option>
                        <option value="NetApp">NetApp</option>
                        <option value="(ISC)Â²">(ISC)Â²</option>
                        <option value="EC-Council">EC-Council</option>
                        <option value="GIAC">GIAC</option>
                        <option value="IAPP">IAPP</option>
                        <option value="CSA">CSA</option>
                        <option value="Scrum Alliance">Scrum Alliance</option>
                        <option value="Veeam">Veeam</option>
                        <option value="Splunk">Splunk</option>
                        <option value="Citrix">Citrix</option>
                        <option value="Teradata">Teradata</option>
                        <option value="ForgeRock">ForgeRock</option>
                        <option value="ETA International">ETA International</option>
                        <option value="Linux Foundation">Linux Foundation</option>
                        <option value="Unity">Unity</option>
                        <option value="NVIDIA">NVIDIA</option>
                        <option value="Zend">Zend</option>
                        <option value="Qt">Qt</option>
                        <option value="CNCF">CNCF</option>
                    </select>
                </div>
                <div class="filter-group" id="vendorAreaGroup" style="display:none;">
                    <h4 id="vendorAreaLabel"><i class="fas fa-diagram-project"></i> Vendor Area</h4>
                    <select id="vendorAreaFilter">
                        <option value="">All Areas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <h4><i class="fas fa-star"></i> Partnership</h4>
                    <select id="partnershipFilter">
                        <option value="">All Partners</option>
                        <option value="premium">Premium Partners</option>
                        <option value="standard">Standard Partners</option>
                    </select>
                </div>
                <div class="filter-group">
                    <h4><i class="fas fa-sort"></i> Sort</h4>
                    <select id="sortFilter">
                        <option value="relevance">Relevance</option>
                        <option value="name-asc">Name AâZ</option>
                        <option value="name-desc">Name ZâA</option>
                        <option value="level-asc" selected>Level â</option>
                        <option value="level-desc">Level â</option>
                        <option value="vendor-asc">Vendor AâZ</option>
                        <option value="vendor-desc">Vendor ZâA</option>
                        <option value="salary-desc">Salary HighâLow</option>
                        <option value="salary-asc">Salary LowâHigh</option>
                        <option value="demand-desc">Demand HighâLow</option>
                        <option value="demand-asc">Demand LowâHigh</option>
                    </select>
                </div>
                <div class="filter-group">
                    <h4><i class="fas fa-layer-group"></i> Group By</h4>
                    <select id="groupByFilter" aria-label="Group results by">
                        <option value="none">None</option>
                        <option value="vendor">Vendor</option>
                        <option value="category">Category</option>
                    </select>
                </div>
            </div>
            
            <div class="filter-actions">
                <button class="btn-secondary" onclick="clearFilters()">Clear Filters</button>
                <button class="btn-secondary" onclick="clearUrlState()">Clear URL State</button>
                <button class="btn-primary" onclick="applyFilters()">Apply Filters</button>
                <button class="btn-secondary" onclick="exportSelected('json')"><i class="fas fa-file-export"></i> Export Selected (JSON)</button>
                <button class="btn-secondary" onclick="exportSelected('csv')"><i class="fas fa-file-csv"></i> Export Selected (CSV)</button>
                <button class="btn-secondary" onclick="exportResults('json')"><i class="fas fa-list"></i> Export Results (JSON)</button>
                <button class="btn-secondary" onclick="exportResults('csv')"><i class="fas fa-file-csv"></i> Export Results (CSV)</button>
                <button class="btn-secondary" id="copyLinkBtn"><i class="fas fa-link"></i> Copy Shareable Link</button>
            </div>
            <div id="active-filter-chips" class="filter-chips" aria-live="polite"></div>
            <div class="filter-actions" style="margin-top:0.75rem; gap:0.75rem;">
                <label style="display:flex; gap:0.4rem; align-items:center; background:#fff; border:1px solid #e2e8f0; padding:0.4rem 0.6rem; border-radius:8px;">
                    <input id="toggleVendorAnchor" type="checkbox" checked>
                    <span>Vendor-anchored pathway</span>
                </label>
                <label style="display:flex; gap:0.4rem; align-items:center; background:#fff; border:1px solid #e2e8f0; padding:0.4rem 0.6rem; border-radius:8px;">
                    <input id="toggleEligibleOnly" type="checkbox" checked>
                    <span>Only show eligible additions for this level</span>
                </label>
                <label style="display:flex; gap:0.4rem; align-items:center; background:#fff; border:1px solid #e2e8f0; padding:0.4rem 0.6rem; border-radius:8px;">
                    <input id="toggleStrictChronology" type="checkbox" checked>
                    <span>Strict chronology (respect level windows & prerequisites)</span>
                </label>
                <label style="display:flex; gap:0.4rem; align-items:center; background:#fff; border:1px solid #e2e8f0; padding:0.4rem 0.6rem; border-radius:8px;">
                    <input id="toggleRecommendedFirst" type="checkbox" checked>
                    <span>Recommended first</span>
                </label>
                <label style="display:flex; gap:0.4rem; align-items:center; background:#fff; border:1px solid #e2e8f0; padding:0.4rem 0.6rem; border-radius:8px;">
                    <input id="densityToggle" type="checkbox">
                    <span>Compact view</span>
                </label>
            </div>
            <div id="results-summary" class="results-summary" style="text-align:center;color:#475569;margin-top:1rem;" aria-live="polite"></div>
            <div id="l1-guidance" style="max-width: var(--container-max); margin: 0.5rem auto 0; display:none;"></div>
            <details id="vendor-counts" style="max-width: 900px; margin: 0.5rem auto 1rem; background:#ffffff; border:1px solid #e2e8f0; border-radius:12px; padding:0.75rem 1rem;">
                <summary style="cursor:pointer;color:#334155;font-weight:600;">Vendor counts overview</summary>
                <div class="vendor-counts-body" style="margin-top:0.5rem; color:#475569; font-size:0.95rem;"></div>
            </details>
            <details id="quote-panel" open style="max-width: var(--container-max); margin: 0.5rem auto 1rem; background:#ffffff; border:1px solid #e2e8f0; border-radius:12px; padding:0.75rem 1rem;">
                <summary style="cursor:pointer;color:#334155;font-weight:700;">Your Level Quotes</summary>
                <div id="quote-content" style="margin-top:0.5rem; color:#475569; font-size:0.95rem;"></div>
            </details>
            <!-- Pagination (top) -->
            <div id="results-pagination-top" class="pagination" aria-label="Results pagination (top)" style="display:none;"></div>

            <!-- Dynamic Results: Certifications & Modules -->
            <div id="dynamic-results">
                <!-- Certification cards will be rendered here based on filters -->
            </div>
            <!-- Pagination (bottom) -->
            <div id="results-pagination-bottom" class="pagination" aria-label="Results pagination (bottom)" style="display:none;"></div>
            <div id="level-modules">
                <!-- Professional development modules for selected level will be rendered here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <a href="../index.html" class="logo-text"><i class="fas fa-microchip"></i> BTH Education Group</a>
                    <p>Transforming lives through comprehensive education and professional development.</p>
                    <div class="footer-contact">
                        <div><i class="fas fa-envelope"></i> <a href="mailto:info@btheducationgroup.com">info@btheducationgroup.com</a></div>
                        <div style="margin-top:4px;"><i class="fas fa-globe"></i> <a href="https://www.btheducationgroup.com" target="_blank" rel="noopener">www.btheducationgroup.com</a></div>
                    </div>
                    <div class="footer-social" aria-label="Social links">
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" aria-label="X / Twitter"><i class="fab fa-x-twitter"></i></a>
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Programs</h4>
                        <ul>
                            <li><a href="media.html" class="active">Media & Entertainment Technology</a></li>
                            <li><a href="../program.html#healthcare">Healthcare Technology</a></li>
                            <li><a href="../program.html#manufacturing">Manufacturing</a></li>
                            <li><a href="../program.html">All Programs</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Frameworks</h4>
                        <ul>
                            <li><a href="../hexad-mastery.html">HEXAD Complete Framework</a></li>
                            <li><a href="../program.html">Standard Pathway</a></li>
                            <li><a href="../about.html">About HEXAD</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Support</h4>
                        <ul>
                            <li><a href="../index.html">Home</a></li>
                            <li><a href="../contact.html">Contact Us</a></li>
                            <li><a href="../apply.html">Apply Now</a></li>
                            <li><a href="../faq.html">FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Company</h4>
                        <ul>
                            <li><a href="../about.html">About Us</a></li>
                            <li><a href="../partners.html">Partners</a></li>
                            <li><a href="../contact.html#locations">Locations</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 BTH Education Group. All rights reserved.</p>
                <div class="footer-legal">
                    <a href="../privacy.html">Privacy Policy</a>
                    <a href="../terms.html">Terms of Service</a>
                </div>
                <p style="margin-top:8px;font-size:0.9rem;color:#94a3b8;max-width:900px;margin-left:auto;margin-right:auto;">
                    All product names, logos, and brands are property of their respective owners. Use of these names, logos, and brands does not imply endorsement. Logos displayed are used under brand guidelines and authorized exam delivery partnerships.
                </p>
                <p style="margin-top:6px;font-size:0.92rem;color:#a5b4fc;">Authorized Pearson VUE Testing Center & Exam Delivery Partner (Site ID: 89828)</p>
            </div>
        </div>
    </footer>

    <script>
        // Mobile Navigation + Navbar Effects
        document.addEventListener('DOMContentLoaded', function() {
            const navToggle = document.querySelector('#techNavToggle');
            const navMenu = document.querySelector('#techNavMenu');
            const navbar = document.querySelector('#techNavbar');

            if (navToggle && navMenu) {
                navToggle.addEventListener('click', () => {
                    navToggle.classList.toggle('active');
                    navMenu.classList.toggle('active');
                });

                document.querySelectorAll('.tech-nav-link').forEach(link => link.addEventListener('click', () => {
                    navToggle.classList.remove('active');
                    navMenu.classList.remove('active');
                }));
            }

            const onScroll = () => {
                if (!navbar) return;
                if (window.scrollY > 10) navbar.classList.add('scrolled'); else navbar.classList.remove('scrolled');
            };
            onScroll();
            window.addEventListener('scroll', onScroll, { passive: true });
        });

        // Framework Selection
        function selectFramework(framework) {
            sessionStorage.setItem('selectedFramework', framework);
            sessionStorage.setItem('selectedSector', 'information-technology');
            if (framework === 'standard') {
                sessionStorage.setItem('maxLevel', '3');
                document.getElementById('certification-filtering').scrollIntoView({ behavior: 'smooth' });
            } else {
                sessionStorage.setItem('maxLevel', '5');
                window.location.href = '../hexad-checkout-system.html?sector=information-technology&framework=' + framework;
            }
        }

    // Certification database (will be replaced by external JSON if available)
                let certifications = [
                        { id: 1, name: 'CompTIA Tech+', vendor: 'CompTIA', category: 'core-it', focus: 'Foundations', level: 1, retired: false, logo: 'https://www.comptia.org/_next/image/?url=https%3A%2F%2Fimages.cmp.optimizely.com%2F84c2ddbcb71111ef888eca5646afc7d8&w=256&q=90', premium: true, exam: 'FC0-U71',
                            neutral: true, level_range: [1,1], tracks: ['support','network','security'], prereqTags: [], tags:['foundation-it'], time_estimate_months: 1.5, popularity: 0.7, salary_index: 0.4 },
                        { id: 2, name: 'Foundation Certification', vendor: 'CompTIA', category: 'core-it', focus: 'Foundations', level: 1, retired: false, logo: 'assets/logos/comptia-aplus.png', premium: true, exam: '220-1201/220-1202',
                            neutral: true, level_range: [1,2], tracks: ['support'], prereqTags: ['foundation-it'], tags:['endpoint-support','hardware'], time_estimate_months: 2.5, popularity: 0.85, salary_index: 0.5 },
                        { id: 3, name: 'CompTIA Network+', vendor: 'CompTIA', category: 'core-it', focus: 'Foundations', level: 1, retired: false, logo: 'assets/logos/comptia-networkplus.png', premium: true, exam: 'N10-009',
                            neutral: true, level_range: [1,2], tracks: ['network'], prereqTags: ['foundation-it'], tags:['foundation-network'], time_estimate_months: 2.5, popularity: 0.8, salary_index: 0.55 },
                        { id: 4, name: 'Microsoft Azure Fundamentals', vendor: 'Microsoft', category: 'cloud-platforms', focus: 'Public Cloud', level: 1, retired: false, logo: 'assets/logos/azure-fundamentals.png', premium: true,
                            neutral: false, level_range: [1,2], tracks: ['cloud'], prereqTags: ['foundation-it'], tags:['vendor-cloud-fund'], time_estimate_months: 1.5, popularity: 0.75, salary_index: 0.5 },
                        { id: 5, name: 'Entry Level Certification', vendor: 'AWS', category: 'cloud-platforms', focus: 'Public Cloud', level: 1, retired: false, logo: 'assets/logos/aws-cloud-practitioner.png', premium: true,
                            neutral: false, level_range: [1,2], tracks: ['cloud'], prereqTags: ['foundation-it'], tags:['vendor-cloud-fund'], time_estimate_months: 1.5, popularity: 0.82, salary_index: 0.52 },
                        { id: 6, name: 'Cisco CCNA', vendor: 'Cisco', category: 'core-it', focus: 'Enterprise R&S', level: 2, retired: false, logo: 'assets/logos/cisco-ccna.png', premium: true,
                            neutral: false, level_range: [2,3], tracks: ['network'], prereqTags: ['foundation-network'], tags:['routing-switching'], time_estimate_months: 4, popularity: 0.88, salary_index: 0.65 },
                        { id: 7, name: 'Red Hat Certified System Admin', vendor: 'Red Hat', category: 'cloud-platforms', focus: 'Virtualization', level: 2, retired: false, logo: 'assets/logos/redhat-rhcsa.png', premium: false,
                            neutral: false, level_range: [2,3], tracks: ['linux','cloud'], prereqTags: ['foundation-it'], tags:['linux-admin'], time_estimate_months: 4, popularity: 0.7, salary_index: 0.6 },
                        { id: 8, name: 'Salesforce Certified Administrator', vendor: 'Salesforce', category: 'crm', focus: 'Foundations', level: 1, retired: false, logo: 'assets/logos/salesforce-admin.png', premium: true,
                            neutral: false, level_range: [1,2], tracks: ['crm'], prereqTags: [], tags:['salesforce','crm'], time_estimate_months: 2, popularity: 0.8, salary_index: 0.55 },
                        { id: 9, name: 'Salesforce Platform Developer I', vendor: 'Salesforce', category: 'crm', focus: 'Developer', level: 2, retired: false, logo: 'assets/logos/salesforce-dev1.png', premium: true,
                            neutral: false, level_range: [2,3], tracks: ['crm','developer'], prereqTags: [], tags:['salesforce','developer'], time_estimate_months: 3, popularity: 0.75, salary_index: 0.6 },
                ];

        // Level duration guidance (overall per level)
        const levelDuration = {
            1: '2â3 years',
            2: '3 years',
            3: '3 years',
            4: '3â4 years',
            5: '4â5 years'
        };

        // Professional Development Modules by Level (updated counts: L1:12, L2:15, L3:18, L4:22, L5:28)
        // Each module: { code, title, hours, levelLabel, desc, icon }
        const pdModules = {
            1: [
                { code: 'PR-L1-01', title: 'Professional Ethics Foundations', hours: '24h', levelLabel: 'Foundation', desc: 'Integrity, accountability, ethical decision-making.', icon: 'fa-scale-balanced' },
                { code: 'PR-L1-02', title: 'Communication Skills I', hours: '24h', levelLabel: 'Foundation', desc: 'Clear written and verbal communication.', icon: 'fa-comments' },
                { code: 'PR-L1-03', title: 'Career Skills I', hours: '24h', levelLabel: 'Foundation', desc: 'Resume, interviewing, workplace success.', icon: 'fa-briefcase' },
                { code: 'PR-L1-04', title: 'Team Collaboration Basics', hours: '24h', levelLabel: 'Foundation', desc: 'Tools and practices for effective teamwork.', icon: 'fa-people-group' },
                { code: 'PR-L1-05', title: 'Time and Focus Management', hours: '16h', levelLabel: 'Foundation', desc: 'Prioritization and personal productivity.', icon: 'fa-clock' },
                { code: 'PR-L1-06', title: 'AI Integration I', hours: '16h', levelLabel: 'Foundation', desc: 'Practical AI tools for daily tasks.', icon: 'fa-robot' },
                { code: 'PR-L1-07', title: 'Customer-Centric Mindset', hours: '16h', levelLabel: 'Foundation', desc: 'Delivering value and service excellence.', icon: 'fa-handshake' },
                { code: 'PR-L1-08', title: 'Critical Thinking I', hours: '16h', levelLabel: 'Foundation', desc: 'Reasoning and problem-solving basics.', icon: 'fa-lightbulb' },
                { code: 'PR-L1-09', title: 'Digital Professionalism', hours: '12h', levelLabel: 'Foundation', desc: 'Online presence and workplace etiquette.', icon: 'fa-user-tie' },
                { code: 'PR-L1-10', title: 'Security Awareness I', hours: '12h', levelLabel: 'Foundation', desc: 'Secure habits and organizational policies.', icon: 'fa-shield-halved' },
                { code: 'PR-L1-11', title: 'Industry Mentor Network I', hours: '12h', levelLabel: 'Foundation', desc: 'Mentor engagement and feedback loops.', icon: 'fa-user-group' },
                { code: 'PR-L1-12', title: 'Professional Tools Bootcamp', hours: '12h', levelLabel: 'Foundation', desc: 'Productivity suites and collaboration tools.', icon: 'fa-toolbox' },
            ],
            2: [
                { code: 'PR-L2-01', title: 'Advanced Ethics', hours: '36h', levelLabel: 'Intermediate', desc: 'Complex ethical challenges & sound judgment.', icon: 'fa-scale-balanced' },
                { code: 'PR-L2-02', title: 'Communication Skills II', hours: '32h', levelLabel: 'Intermediate', desc: 'Influencing and stakeholder communication.', icon: 'fa-comments' },
                { code: 'PR-L2-03', title: 'Project Management I', hours: '36h', levelLabel: 'Intermediate', desc: 'Planning, execution, and delivery.', icon: 'fa-diagram-project' },
                { code: 'PR-L2-04', title: 'Team Leadership Development', hours: '48h', levelLabel: 'Intermediate', desc: 'Team collaboration, basic management skills, mentoring fundamentals.', icon: 'fa-chess-king' },
                { code: 'PR-L2-05', title: 'AI Integration II', hours: '24h', levelLabel: 'Intermediate', desc: 'Workflow automation and copilots.', icon: 'fa-robot' },
                { code: 'PR-L2-06', title: 'Career Strategy II', hours: '24h', levelLabel: 'Intermediate', desc: 'Role positioning and growth plans.', icon: 'fa-route' },
                { code: 'PR-L2-07', title: 'Security Awareness II', hours: '18h', levelLabel: 'Intermediate', desc: 'Threat awareness and risk basics.', icon: 'fa-shield' },
                { code: 'PR-L2-08', title: 'Mentor Network II', hours: '18h', levelLabel: 'Intermediate', desc: 'Expanding and leveraging mentors.', icon: 'fa-user-plus' },
                { code: 'PR-L2-09', title: 'Data Literacy I', hours: '18h', levelLabel: 'Intermediate', desc: 'Data fundamentals and storytelling.', icon: 'fa-chart-column' },
                { code: 'PR-L2-10', title: 'Modern Tools II', hours: '12h', levelLabel: 'Intermediate', desc: 'Advanced collaboration & PM tools.', icon: 'fa-screwdriver-wrench' },
                { code: 'PR-L2-11', title: 'Problem Solving II', hours: '18h', levelLabel: 'Intermediate', desc: 'Root-cause analysis and facilitation.', icon: 'fa-magnifying-glass' },
                { code: 'PR-L2-12', title: 'Writing for Impact', hours: '18h', levelLabel: 'Intermediate', desc: 'Business cases and executive briefs.', icon: 'fa-pen-to-square' },
                { code: 'PR-L2-13', title: 'Negotiation Basics', hours: '12h', levelLabel: 'Intermediate', desc: 'Principled negotiation techniques.', icon: 'fa-scale-balanced' },
                { code: 'PR-L2-14', title: 'Customer Discovery', hours: '12h', levelLabel: 'Intermediate', desc: 'Interviewing and requirement elicitation.', icon: 'fa-user-check' },
                { code: 'PR-L2-15', title: 'Business Fundamentals I', hours: '12h', levelLabel: 'Intermediate', desc: 'Finance and value creation basics.', icon: 'fa-briefcase' },
            ],
            3: [
                { code: 'PR-L3-01', title: 'Strategic Leadership I', hours: '48h', levelLabel: 'Advanced', desc: 'Leading teams, managing stakeholders, and driving organizational change.', icon: 'fa-chess-king' },
                { code: 'PR-L3-02', title: 'Project Management II', hours: '48h', levelLabel: 'Advanced', desc: 'Advanced PM methodologies, agile at scale, portfolio management.', icon: 'fa-diagram-project' },
                { code: 'PR-L3-03', title: 'Communication Excellence', hours: '36h', levelLabel: 'Advanced', desc: 'Executive presentations, public speaking, and technical writing.', icon: 'fa-microphone' },
                { code: 'PR-L3-04', title: 'AI Integration III', hours: '36h', levelLabel: 'Advanced', desc: 'AI strategy, building intelligent systems, and automation.', icon: 'fa-robot' },
                { code: 'PR-L3-05', title: 'Business Strategy I', hours: '36h', levelLabel: 'Advanced', desc: 'Strategic planning, competitive analysis, business models.', icon: 'fa-chess' },
                { code: 'PR-L3-06', title: 'Security Leadership I', hours: '30h', levelLabel: 'Advanced', desc: 'Risk management, compliance frameworks, security governance.', icon: 'fa-shield' },
                { code: 'PR-L3-07', title: 'Innovation & Design Thinking', hours: '30h', levelLabel: 'Advanced', desc: 'Creative problem-solving, rapid prototyping, and innovation.', icon: 'fa-lightbulb' },
                { code: 'PR-L3-08', title: 'Advanced Negotiation', hours: '24h', levelLabel: 'Advanced', desc: 'Complex negotiations, conflict resolution, win-win strategies.', icon: 'fa-handshake' },
                { code: 'PR-L3-09', title: 'Data-Driven Decision Making', hours: '24h', levelLabel: 'Advanced', desc: 'Analytics, business intelligence, and predictive modeling.', icon: 'fa-chart-line' },
                { code: 'PR-L3-10', title: 'Vendor Management', hours: '24h', levelLabel: 'Advanced', desc: 'Procurement, contract negotiation, and relationship management.', icon: 'fa-building' },
                { code: 'PR-L3-11', title: 'Career Architecture III', hours: '18h', levelLabel: 'Advanced', desc: 'Senior role transitions, executive presence, personal branding.', icon: 'fa-stairs' },
                { code: 'PR-L3-12', title: 'Financial Management I', hours: '24h', levelLabel: 'Advanced', desc: 'Budget management, ROI analysis, financial planning.', icon: 'fa-coins' },
                { code: 'PR-L3-13', title: 'Global Collaboration', hours: '18h', levelLabel: 'Advanced', desc: 'Cross-cultural teams, distributed leadership, timezone management.', icon: 'fa-globe' },
                { code: 'PR-L3-14', title: 'Technical Mentorship', hours: '18h', levelLabel: 'Advanced', desc: 'Developing others, knowledge transfer, coaching skills.', icon: 'fa-chalkboard-user' },
                { code: 'PR-L3-15', title: 'Process Optimization', hours: '18h', levelLabel: 'Advanced', desc: 'Lean practices, continuous improvement, efficiency.', icon: 'fa-gears' },
                { code: 'PR-L3-16', title: 'Change Management', hours: '18h', levelLabel: 'Advanced', desc: 'Leading organizational transformation and adoption.', icon: 'fa-arrows-rotate' },
                { code: 'PR-L3-17', title: 'Executive Communication', hours: '18h', levelLabel: 'Advanced', desc: 'Board presentations, stakeholder management, influence.', icon: 'fa-building-columns' },
                { code: 'PR-L3-18', title: 'Professional Network III', hours: '18h', levelLabel: 'Advanced', desc: 'Industry leadership, thought leadership, community building.', icon: 'fa-network-wired' },
            ],
            4: [
                { code: 'PR-L4-01', title: 'Strategic Leadership II', hours: '60h', levelLabel: 'Expert', desc: 'Enterprise leadership, vision setting, and organizational design.', icon: 'fa-chess-king' },
                { code: 'PR-L4-02', title: 'Program Management Mastery', hours: '60h', levelLabel: 'Expert', desc: 'Multi-project portfolios, program governance, strategic delivery.', icon: 'fa-diagram-project' },
                { code: 'PR-L4-03', title: 'AI Strategy & Implementation', hours: '48h', levelLabel: 'Expert', desc: 'Enterprise AI adoption, ML operations, and AI governance.', icon: 'fa-robot' },
                { code: 'PR-L4-04', title: 'Business Strategy II', hours: '48h', levelLabel: 'Expert', desc: 'Corporate strategy, M&A fundamentals, market positioning.', icon: 'fa-chess' },
                { code: 'PR-L4-05', title: 'Security Leadership II', hours: '42h', levelLabel: 'Expert', desc: 'Enterprise security architecture, zero trust, incident response.', icon: 'fa-shield' },
                { code: 'PR-L4-06', title: 'Enterprise Architecture', hours: '48h', levelLabel: 'Expert', desc: 'Solution architecture, technology strategy, EA frameworks.', icon: 'fa-building' },
                { code: 'PR-L4-07', title: 'Financial Management II', hours: '36h', levelLabel: 'Expert', desc: 'P&L ownership, capital allocation, investment analysis.', icon: 'fa-coins' },
                { code: 'PR-L4-08', title: 'Executive Presence', hours: '30h', levelLabel: 'Expert', desc: 'C-suite communication, gravitas, influence at scale.', icon: 'fa-user-tie' },
                { code: 'PR-L4-09', title: 'Digital Transformation', hours: '36h', levelLabel: 'Expert', desc: 'Leading enterprise transformation, change at scale.', icon: 'fa-arrows-spin' },
                { code: 'PR-L4-10', title: 'Advanced Analytics & BI', hours: '30h', levelLabel: 'Expert', desc: 'Data strategy, advanced modeling, business intelligence.', icon: 'fa-chart-pie' },
                { code: 'PR-L4-11', title: 'Organizational Psychology', hours: '30h', levelLabel: 'Expert', desc: 'Culture building, team dynamics, motivation theory.', icon: 'fa-brain' },
                { code: 'PR-L4-12', title: 'Strategic Partnerships', hours: '24h', levelLabel: 'Expert', desc: 'Ecosystem development, alliances, co-innovation.', icon: 'fa-handshake-angle' },
                { code: 'PR-L4-13', title: 'Thought Leadership', hours: '24h', levelLabel: 'Expert', desc: 'Publishing, speaking, industry influence, personal brand.', icon: 'fa-bullhorn' },
                { code: 'PR-L4-14', title: 'Crisis Management', hours: '24h', levelLabel: 'Expert', desc: 'Business continuity, crisis response, resilience planning.', icon: 'fa-triangle-exclamation' },
                { code: 'PR-L4-15', title: 'Product Strategy', hours: '30h', levelLabel: 'Expert', desc: 'Product vision, market fit, go-to-market strategy.', icon: 'fa-box' },
                { code: 'PR-L4-16', title: 'Advanced Coaching', hours: '24h', levelLabel: 'Expert', desc: 'Executive coaching, leadership development programs.', icon: 'fa-person-chalkboard' },
                { code: 'PR-L4-17', title: 'Global Leadership', hours: '24h', levelLabel: 'Expert', desc: 'Leading international teams, cultural intelligence.', icon: 'fa-earth-americas' },
                { code: 'PR-L4-18', title: 'Legal & Compliance', hours: '18h', levelLabel: 'Expert', desc: 'Contract law, regulatory compliance, governance.', icon: 'fa-gavel' },
                { code: 'PR-L4-19', title: 'Talent Management', hours: '24h', levelLabel: 'Expert', desc: 'Recruiting, retention, succession planning, culture.', icon: 'fa-users' },
                { code: 'PR-L4-20', title: 'Business Development', hours: '24h', levelLabel: 'Expert', desc: 'Pipeline management, sales strategy, client relationships.', icon: 'fa-chart-line-up' },
                { code: 'PR-L4-21', title: 'Innovation Leadership', hours: '24h', levelLabel: 'Expert', desc: 'R&D strategy, innovation culture, disruptive thinking.', icon: 'fa-rocket' },
                { code: 'PR-L4-22', title: 'Board Advisory Skills', hours: '18h', levelLabel: 'Expert', desc: 'Board governance, fiduciary duties, strategic counsel.', icon: 'fa-landmark' },
            ],
            5: [
                { code: 'PR-L5-01', title: 'C-Suite Leadership', hours: '72h', levelLabel: 'Master', desc: 'Executive leadership, enterprise vision, board dynamics.', icon: 'fa-crown' },
                { code: 'PR-L5-02', title: 'Enterprise AI Governance', hours: '60h', levelLabel: 'Master', desc: 'AI at scale, ethics, regulatory compliance, AI ROI.', icon: 'fa-robot' },
                { code: 'PR-L5-03', title: 'Corporate Strategy', hours: '60h', levelLabel: 'Master', desc: 'Long-term vision, industry disruption, competitive moats.', icon: 'fa-chess' },
                { code: 'PR-L5-04', title: 'Global Security Strategy', hours: '54h', levelLabel: 'Master', desc: 'CISO perspective, geopolitical risk, cyber warfare.', icon: 'fa-shield' },
                { code: 'PR-L5-05', title: 'Financial Leadership', hours: '48h', levelLabel: 'Master', desc: 'CFO fundamentals, capital markets, investor relations.', icon: 'fa-coins' },
                { code: 'PR-L5-06', title: 'Technology Vision & Roadmap', hours: '48h', levelLabel: 'Master', desc: 'CTO perspective, innovation pipeline, R&D strategy.', icon: 'fa-map' },
                { code: 'PR-L5-07', title: 'M&A Strategy & Execution', hours: '42h', levelLabel: 'Master', desc: 'Acquisitions, integrations, divestiture, valuation.', icon: 'fa-building-circle-arrow-right' },
                { code: 'PR-L5-08', title: 'Board Leadership', hours: '36h', levelLabel: 'Master', desc: 'Board governance, committee work, shareholder value.', icon: 'fa-landmark' },
                { code: 'PR-L5-09', title: 'Enterprise Transformation', hours: '48h', levelLabel: 'Master', desc: 'Large-scale change, cultural transformation, reinvention.', icon: 'fa-arrows-rotate' },
                { code: 'PR-L5-10', title: 'Global Operations Excellence', hours: '42h', levelLabel: 'Master', desc: 'Multi-site operations, supply chain, efficiency at scale.', icon: 'fa-globe' },
                { code: 'PR-L5-11', title: 'Stakeholder Capitalism', hours: '36h', levelLabel: 'Master', desc: 'ESG strategy, sustainability, social impact, purpose.', icon: 'fa-handshake' },
                { code: 'PR-L5-12', title: 'Executive Communication Mastery', hours: '36h', levelLabel: 'Master', desc: 'Media training, crisis communication, public affairs.', icon: 'fa-microphone' },
                { code: 'PR-L5-13', title: 'Venture & Private Equity', hours: '30h', levelLabel: 'Master', desc: 'Investment thesis, portfolio management, exits.', icon: 'fa-sack-dollar' },
                { code: 'PR-L5-14', title: 'Regulatory Strategy', hours: '30h', levelLabel: 'Master', desc: 'Government relations, policy influence, compliance.', icon: 'fa-gavel' },
                { code: 'PR-L5-15', title: 'Industry Thought Leadership', hours: '30h', levelLabel: 'Master', desc: 'Keynotes, authorship, advisory boards, influence.', icon: 'fa-bullhorn' },
                { code: 'PR-L5-16', title: 'Talent & Culture at Scale', hours: '30h', levelLabel: 'Master', desc: 'CHRO perspective, workforce planning, culture design.', icon: 'fa-users' },
                { code: 'PR-L5-17', title: 'Strategic Risk Management', hours: '30h', levelLabel: 'Master', desc: 'Enterprise risk, resilience, scenario planning.', icon: 'fa-triangle-exclamation' },
                { code: 'PR-L5-18', title: 'Innovation Ecosystems', hours: '30h', levelLabel: 'Master', desc: 'Open innovation, corporate ventures, partnerships.', icon: 'fa-rocket' },
                { code: 'PR-L5-19', title: 'Data & Analytics Strategy', hours: '24h', levelLabel: 'Master', desc: 'CDO perspective, data monetization, analytics COE.', icon: 'fa-chart-pie' },
                { code: 'PR-L5-20', title: 'Customer Experience Leadership', hours: '24h', levelLabel: 'Master', desc: 'Customer strategy, experience design, loyalty.', icon: 'fa-user-check' },
                { code: 'PR-L5-21', title: 'Competitive Intelligence', hours: '24h', levelLabel: 'Master', desc: 'Market intelligence, competitive analysis, positioning.', icon: 'fa-magnifying-glass-chart' },
                { code: 'PR-L5-22', title: 'Executive Coaching & Mentorship', hours: '24h', levelLabel: 'Master', desc: 'Coaching C-suite, developing next-gen leaders.', icon: 'fa-person-chalkboard' },
                { code: 'PR-L5-23', title: 'Strategic Communications', hours: '24h', levelLabel: 'Master', desc: 'Corporate messaging, brand architecture, PR strategy.', icon: 'fa-comment-dots' },
                { code: 'PR-L5-24', title: 'Platform Business Models', hours: '24h', levelLabel: 'Master', desc: 'Network effects, multi-sided markets, ecosystems.', icon: 'fa-diagram-project' },
                { code: 'PR-L5-25', title: 'Geopolitical Strategy', hours: '24h', levelLabel: 'Master', desc: 'Global risk, trade policy, international expansion.', icon: 'fa-earth-americas' },
                { code: 'PR-L5-26', title: 'Legacy & Succession', hours: '18h', levelLabel: 'Master', desc: 'Leadership transition, succession planning, legacy.', icon: 'fa-stairs' },
                { code: 'PR-L5-27', title: 'Quantum & Emerging Tech', hours: '24h', levelLabel: 'Master', desc: 'Future technologies, quantum computing, emerging trends.', icon: 'fa-atom' },
                { code: 'PR-L5-28', title: 'Executive Wellness & Resilience', hours: '18h', levelLabel: 'Master', desc: 'Stress management, work-life integration, longevity.', icon: 'fa-heart-pulse' },
            ],
        };

        // Vendor logo mapping (fallbacks to default)
        const vendorLogoMap = {
            'AWS': '../assets/images/vendor-logos/aws.svg',
            'Amazon AWS': '../assets/images/vendor-logos/aws.svg',
            'Microsoft': '../assets/images/vendor-logos/microsoft.svg',
            'Azure': '../assets/images/vendor-logos/azure.svg',
            'CompTIA': '../assets/images/vendor-logos/comptia.svg',
            'Check Point': '../assets/images/vendor-logos/checkpoint.svg',
            'Databricks': '../assets/images/vendor-logos/databricks.svg',
            'Dell Technologies': '../assets/images/vendor-logos/dell.svg',
            'Docker': '../assets/images/vendor-logos/docker.svg',
            'Elastic': '../assets/images/vendor-logos/elastic.svg',
            'Cisco': '../assets/images/vendor-logos/cisco.svg',
            'Linux Foundation': '../assets/images/vendor-logos/linuxfoundation.svg',
            'Red Hat': '../assets/images/vendor-logos/redhat.svg',
            'VMware/Omnissa': '../assets/images/vendor-logos/vmware.svg',
            'Google Cloud': '../assets/images/vendor-logos/googlecloud.svg',
            'ISACA': '../assets/images/vendor-logos/isaca.svg',
            '(ISC)Â²': '../assets/images/vendor-logos/isc2.svg',
            'PMI': '../assets/images/vendor-logos/pmi.svg',
            'PeopleCert': '../assets/images/vendor-logos/peoplecert.svg',
            'GIAC': '../assets/images/vendor-logos/giac.svg',
            'IAPP': '../assets/images/vendor-logos/iapp.svg',
            'Huawei': '../assets/images/vendor-logos/huawei.svg',
            'CSA': '../assets/images/vendor-logos/csa.svg',
            'IEEE Computer Society': '../assets/images/vendor-logos/ieee.svg',
            'NetApp': '../assets/images/vendor-logos/netapp.svg',
            'Veeam': '../assets/images/vendor-logos/veeam.svg',
            'Splunk': '../assets/images/vendor-logos/splunk.svg',
            'Citrix': '../assets/images/vendor-logos/citrix.svg',
            'Juniper': '../assets/images/vendor-logos/juniper.svg',
            'SUSE': '../assets/images/vendor-logos/suse.svg',
            'Fortinet': '../assets/images/vendor-logos/fortinet.svg',
            'Oracle': '../assets/images/vendor-logos/oracle.svg',
            'Snowflake': '../assets/images/vendor-logos/snowflake.svg',
            'MongoDB': '../assets/images/vendor-logos/mongodb.svg',
            'EC-Council': '../assets/images/vendor-logos/eccouncil.svg',
            'Aruba': '../assets/images/vendor-logos/aruba.svg',
            'Nokia': '../assets/images/vendor-logos/nokia.svg',
            'ZTE': '../assets/images/vendor-logos/zte.svg',
            'Nutanix': '../assets/images/vendor-logos/nutanix.svg',
            'CWNP': '../assets/images/vendor-logos/cwnp.svg',
            'Unity': '../assets/images/vendor-logos/unity.svg',
            'NVIDIA': '../assets/images/vendor-logos/nvidia.svg',
            'CNCF': '../assets/images/vendor-logos/cncf.svg',
            'Teradata': '../assets/images/vendor-logos/teradata.svg',
            'ForgeRock': '../assets/images/vendor-logos/forgerock.svg',
            'ETA International': '../assets/images/vendor-logos/eta.svg',
            'Scrum Alliance': '../assets/images/vendor-logos/scrumalliance.svg',
            'Zend': '../assets/images/vendor-logos/zend.svg',
            'Qt': '../assets/images/vendor-logos/qt.svg',
            'HashiCorp': '../assets/images/vendor-logos/hashicorp.svg',
            'Palo Alto Networks': '../assets/images/vendor-logos/paloaltonetworks.svg',
            'ServiceNow': '../assets/images/vendor-logos/servicenow.svg',
            'Python Institute': '../assets/images/vendor-logos/pythoninstitute.svg',
            'Sophos': '../assets/images/vendor-logos/sophos.svg',
            'Salesforce': '../assets/images/vendor-logos/salesforce.svg',
        };

        // Prefer local, vetted vendor logos; only allow dataset-provided paths if they point to our local vendor-logos directory
        function isSafeLocalLogo(path) {
            if (!path) return false;
            const p = String(path).trim();
            return p.startsWith('../assets/images/vendor-logos/') || p.startsWith('assets/images/vendor-logos/') || p.startsWith('/assets/images/vendor-logos/');
        }
        function resolveLogoSrc(cert) {
            const mapped = vendorLogoMap[cert?.vendor];
            if (mapped) return mapped;
            const provided = String(cert?.logo || '').trim();
            if (provided && isSafeLocalLogo(provided)) return provided;
            return '../assets/images/vendor-logos/default-logo.svg';
        }

        // Salary guide (indicative averages in USD)
        const salaryGuide = {
            byName: {
                'CompTIA Tech+': 45000,
                'Foundation Certification': 52000,
                'CompTIA Network+': 65000,
                'Cisco CCNA': 78000,
                'Entry Level Certification': 90000,
                'Microsoft Azure Fundamentals': 85000,
                'Red Hat Certified System Admin': 95000
            },
            byVendor: {
                'CompTIA': 60000,
                'Cisco': 80000,
                'AWS': 95000,
                'Microsoft': 90000,
                'Red Hat': 95000,
                'Google Cloud': 92000,
                'Juniper': 82000,
                'Fortinet': 88000,
                'Salesforce': 105000
            },
            byLevelBase: { 1: 50000, 2: 70000, 3: 90000, 4: 110000, 5: 130000 }
        };

        // Vendor-agnostic curation engine: maps (vendor, level, area) -> curated name sets
        const curationEngine = (function(){
            const byVendor = {};
            // Helper to normalize area labels
            const normArea = (s)=>{ const t=String(s||'').toLowerCase(); if (!t) return ''; if (t.includes('offensive')) return 'Offensive Cybersecurity'; if (t.includes('defense') || t==='security' || t.includes('cybersecurity')) return 'Cybersecurity (Defense)'; if (t.includes('infra')) return 'Infrastructure'; if (t.includes('cloud')) return 'Cloud'; if (t.includes('data')) return 'Data & Analytics'; if (t.includes('xpert') || t.includes('expert')) return 'Xpert'; return s; };
            // Register CompTIA descriptor
            byVendor['CompTIA'] = {
                coreByLevel: {
                    1: ['CompTIA Tech+','Foundation Certification','CompTIA Network+'],
                    2: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+'],
                    3: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+'],
                    4: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+'],
                    5: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+']
                },
                defaultByLevel: {
                    1: ['CompTIA Tech+','Foundation Certification','CompTIA Network+'],
                    2: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+'],
                    3: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+','CompTIA CySA+','CompTIA PenTest+','CompTIA Cloud+','CompTIA Server+','CompTIA Linux+','CompTIA Data+'],
                    4: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+','CompTIA CySA+','CompTIA PenTest+','CompTIA Cloud+','CompTIA Server+','CompTIA Linux+'],
                    5: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+','CompTIA CySA+','CompTIA PenTest+','CompTIA SecurityX']
                },
                areaExtrasByLevel: {
                    3: {
                        'Cybersecurity (Defense)': ['CompTIA CySA+'],
                        'Offensive Cybersecurity': ['CompTIA PenTest+'],
                        'Infrastructure': ['CompTIA Server+','CompTIA Linux+'],
                        'Cloud': ['CompTIA Cloud+'],
                        'Data & Analytics': ['CompTIA Data+'],
                        'Xpert': []
                    },
                    4: {
                        'Cybersecurity (Defense)': ['CompTIA CySA+'],
                        'Offensive Cybersecurity': ['CompTIA PenTest+'],
                        'Infrastructure': ['CompTIA Server+','CompTIA Linux+'],
                        'Cloud': ['CompTIA Cloud+'],
                        'Data & Analytics': ['CompTIA Data+','CompTIA DataSys+'],
                        'Xpert': []
                    },
                    5: {
                        'Cybersecurity (Defense)': ['CompTIA CySA+','CompTIA SecurityX'],
                        'Offensive Cybersecurity': ['CompTIA PenTest+','CompTIA SecurityX'],
                        'Infrastructure': ['CompTIA Server+','CompTIA Linux+'],
                        'Cloud': ['CompTIA Cloud+','CompTIA CloudNetX'],
                        'Data & Analytics': ['CompTIA Data+','CompTIA DataSys+','CompTIA DataX'],
                        'Xpert': ['CompTIA SecurityX']
                    }
                },
                specializationNames: new Set(['CompTIA CySA+','CompTIA PenTest+','CompTIA SecurityX'])
            };
            function has(vendor){ return !!byVendor[vendor]; }
            function getCurated(vendor, level, area){
                const d = byVendor[vendor];
                if (!d) return { names: [], coreSet: new Set(), specSet: new Set() };
                const lvl = Number(level)||0;
                const core = new Set(d.coreByLevel[lvl] || []);
                let names = Array.from(d.defaultByLevel[lvl] || []);
                const aKey = normArea(area);
                if (lvl >= 2 && aKey) {
                    const extras = (d.areaExtrasByLevel[lvl] && d.areaExtrasByLevel[lvl][aKey]) || [];
                    names = Array.from(new Set([...(d.coreByLevel[lvl]||[]), ...extras]));
                }
                const specSet = d.specializationNames || new Set();
                return { names, coreSet: core, specSet };
            }
            return { has, getCurated };
        })();

        // ---------------------------------------------------------------------
        // Microsoft Level â Solution Area Matrix (from provided outline)
        // Each higher level is cumulative (includes all previous levels for area)
        // Areas: Azure Data and AI, Infrastructure, Digital & App Innovation,
        //        Modern Workplace, Security, Networking
        // Architect & enterprise track items ONLY appear at Level 5.
        // ---------------------------------------------------------------------
        const MICROSOFT_LEVEL_AREA_MATRIX = {
            'Azure Data and AI': {
                1: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Data Fundamentals','Microsoft Certified: Fabric Data Engineer Associate'],
                2: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Data Fundamentals','Microsoft Certified: Fabric Data Engineer Associate','Microsoft Certified: Azure Database Administrator Associate'],
                3: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Data Fundamentals','Microsoft Certified: Azure AI Fundamentals','Microsoft Certified: Fabric Data Engineer Associate','Microsoft Certified: Azure Database Administrator Associate'],
                4: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Data Fundamentals','Microsoft Certified: Azure AI Fundamentals','Microsoft Certified: Fabric Data Engineer Associate','Microsoft Certified: Azure Database Administrator Associate','Microsoft Certified: Azure AI Engineer Associate'],
                5: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Data Fundamentals','Microsoft Certified: Fabric Data Engineer Associate','Microsoft Certified: Azure Database Administrator Associate','Microsoft Certified: Azure AI Fundamentals','Microsoft Certified: Azure AI Engineer Associate','Microsoft Certified: Azure Data Scientist Associate']
            },
            'Infrastructure': {
                1: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Security Engineer Associate'],
                2: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Security Engineer Associate','Microsoft Certified: Azure Developer Associate'],
                3: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Security Engineer Associate','Microsoft Certified: Azure Developer Associate','Microsoft Certified: Azure Administrator Associate'],
                4: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Security Engineer Associate','Microsoft Certified: Azure Developer Associate','Microsoft Certified: Azure Administrator Associate','Microsoft Certified: DevOps Engineer Expert'],
                5: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Security Engineer Associate','Microsoft Certified: Azure Developer Associate','Microsoft Certified: Azure Administrator Associate','Microsoft Certified: DevOps Engineer Expert','Microsoft Certified: Azure Solutions Architect Expert']
            },
            'Digital & App Innovation': {
                1: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure AI Fundamentals','Microsoft Certified: Azure AI Engineer Associate'],
                2: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure AI Fundamentals','Microsoft Certified: Azure AI Engineer Associate','Microsoft Certified: Azure Developer Associate'],
                3: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure AI Fundamentals','Microsoft Certified: Azure AI Engineer Associate','Microsoft Certified: Azure Developer Associate','Microsoft Certified: Azure Cosmos DB Developer Specialty'],
                4: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure AI Fundamentals','Microsoft Certified: Azure AI Engineer Associate','Microsoft Certified: Azure Developer Associate','Microsoft Certified: Azure Cosmos DB Developer Specialty','Microsoft Certified: DevOps Engineer Expert'],
                5: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure AI Fundamentals','Microsoft Certified: Azure AI Engineer Associate','Microsoft Certified: Azure Developer Associate','Microsoft Certified: Azure Cosmos DB Developer Specialty','Microsoft Certified: DevOps Engineer Expert','Microsoft Certified: Azure Solutions Architect Expert']
            },
            'Modern Workplace': {
                1: ['Microsoft Certified: Microsoft 365 Fundamentals','Microsoft Certified: Teams Administrator Associate','Microsoft Certified: Security Administrator Associate'],
                2: ['Microsoft Certified: Microsoft 365 Fundamentals','Microsoft Certified: Teams Administrator Associate','Microsoft Certified: Security Administrator Associate','Microsoft Certified: Messaging Administrator Associate'],
                3: ['Microsoft Certified: Microsoft 365 Fundamentals','Microsoft Certified: Teams Administrator Associate','Microsoft Certified: Security Administrator Associate','Microsoft Certified: Messaging Administrator Associate','Microsoft Certified: Teamwork Administrator Associate'],
                4: ['Microsoft Certified: Microsoft 365 Fundamentals','Microsoft Certified: Teams Administrator Associate','Microsoft Certified: Security Administrator Associate','Microsoft Certified: Messaging Administrator Associate','Microsoft Certified: Teamwork Administrator Associate','Microsoft Certified: Modern Desktop Administrator Associate'],
                5: ['Microsoft Certified: Microsoft 365 Fundamentals','Microsoft Certified: Teams Administrator Associate','Microsoft Certified: Security Administrator Associate','Microsoft Certified: Messaging Administrator Associate','Microsoft Certified: Teamwork Administrator Associate','Microsoft Certified: Modern Desktop Administrator Associate','Microsoft Certified: Microsoft 365 Enterprise Administrator Expert']
            },
            'Security': {
                1: ['Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Security Engineer Associate'],
                2: ['Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Security Engineer Associate','Microsoft Certified: Security Operations Analyst Associate'],
                3: ['Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Security Engineer Associate','Microsoft Certified: Security Operations Analyst Associate','Microsoft Certified: Identity and Access Administrator Associate'],
                4: ['Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Security Engineer Associate','Microsoft Certified: Security Operations Analyst Associate','Microsoft Certified: Identity and Access Administrator Associate','Microsoft Certified: Information Protection Administrator Associate'],
                5: ['Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Security Engineer Associate','Microsoft Certified: Security Operations Analyst Associate','Microsoft Certified: Identity and Access Administrator Associate','Microsoft Certified: Information Protection Administrator Associate','Microsoft Certified: Cybersecurity Architect Expert']
            },
            'Networking': {
                1: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Azure Network Engineer Associate','Microsoft Certified: Windows Server Hybrid Administrator Associate'],
                2: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Network Engineer Associate','Microsoft Certified: Windows Server Hybrid Administrator Associate'],
                3: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Network Engineer Associate','Microsoft Certified: Windows Server Hybrid Administrator Associate','Microsoft Certified: Azure Security Engineer Associate'],
                4: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Network Engineer Associate','Microsoft Certified: Windows Server Hybrid Administrator Associate','Microsoft Certified: Azure Security Engineer Associate','Microsoft Certified: Azure Virtual Desktop Specialty'],
                5: ['Microsoft Certified: Azure Fundamentals','Microsoft Certified: Security, Compliance, and Identity Fundamentals','Microsoft Certified: Azure Network Engineer Associate','Microsoft Certified: Windows Server Hybrid Administrator Associate','Microsoft Certified: Azure Security Engineer Associate','Microsoft Certified: Azure Virtual Desktop Specialty','Microsoft Certified: Azure for SAP Workloads Specialty']
            }
        };

        // Normalize a Microsoft certification name for matching against matrix entries
        function normalizeMsCertName(name){
            if (!name) return '';
            let n = String(name).trim();
            // Remove leading vendor prefix variants while preserving role keywords
            n = n.replace(/^Microsoft\s+Certified:\s*/i,'');
            n = n.replace(/^Microsoft\s+/i,'');
            // Standardize 'Fabric' variants (Fabrics, Fabric, Data Engineer vs Analytics Engineer)
            n = n.replace(/Fabrics?/gi,'Fabric');
            // Collapse multiple spaces
            n = n.replace(/\s+/g,' ').trim();
            return n.toLowerCase();
        }
        // Determine if a cert matches a matrix item (substring / token based)
        function msMatrixMatch(certName, targetName){
            // Strict normalized forms (keep suite words to avoid collapsing distinct Fundamentals tracks)
            const normCert = normalizeMsCertName(certName);
            const normTarget = normalizeMsCertName(targetName);
            if (!normCert || !normTarget) return false;
            if (normCert === normTarget) return true; // exact after prefix removal only
            // Token comparison excluding optional role markers but KEEP suite identifiers
            const optional = new Set(['associate','expert','fundamentals','specialty','certified']);
            const tokenize = (s)=> s.split(/[^a-z0-9]+/).filter(t=> t && !optional.has(t));
            const certTokens = new Set(tokenize(normCert));
            const targetTokens = tokenize(normTarget);
            if (targetTokens.length === 0) return false; // avoid generic 'fundamentals' == everything
            if (targetTokens.every(t=> certTokens.has(t))) return true;
            // Substring allowance only if length difference is modest and not both fundamentals
            if ((normCert.includes(normTarget) || normTarget.includes(normCert)) && !(/fundamentals/.test(normCert) && /fundamentals/.test(normTarget) && normCert!==normTarget)) return true;
            return false;
        }

        // Provide a canonical display name for Microsoft certifications regardless of legacy dataset naming
        function canonicalMicrosoftDisplayName(cert){
            if (!cert || cert.vendor!=='Microsoft') return cert?.name || '';
            const rawName = String(cert.name||'');
            if (/^Microsoft Certified:/i.test(rawName)) return rawName; // Already canonical
            const exam = String(cert.exam||'').toUpperCase();
            const n = rawName.toLowerCase();
            // Targeted remaps (extend as needed)
            const byExam = {
                'DP-600': 'Microsoft Certified: Fabric Data Engineer Associate',
                'DP-900': 'Microsoft Certified: Azure Data Fundamentals',
                'AZ-900': 'Microsoft Certified: Azure Fundamentals',
                'DP-300': 'Microsoft Certified: Azure Database Administrator Associate',
                'AI-900': 'Microsoft Certified: Azure AI Fundamentals',
                'AI-102': 'Microsoft Certified: Azure AI Engineer Associate',
                'DP-100': 'Microsoft Certified: Azure Data Scientist Associate',
                'AZ-104': 'Microsoft Certified: Azure Administrator Associate',
                'AZ-204': 'Microsoft Certified: Azure Developer Associate',
                'AZ-500': 'Microsoft Certified: Azure Security Engineer Associate',
                'AZ-400': 'Microsoft Certified: DevOps Engineer Expert',
                'AZ-305': 'Microsoft Certified: Azure Solutions Architect Expert',
                'SC-900': 'Microsoft Certified: Security, Compliance, and Identity Fundamentals',
                'SC-200': 'Microsoft Certified: Security Operations Analyst Associate',
                'SC-300': 'Microsoft Certified: Identity and Access Administrator Associate',
                'SC-400': 'Microsoft Certified: Information Protection Administrator Associate',
                'SC-100': 'Microsoft Certified: Cybersecurity Architect Expert',
                'AZ-700': 'Microsoft Certified: Azure Network Engineer Associate',
                'AZ-800': 'Microsoft Certified: Windows Server Hybrid Administrator Associate',
                'AZ-801': 'Microsoft Certified: Windows Server Hybrid Administrator Associate',
                'AZ-140': 'Microsoft Certified: Azure Virtual Desktop Specialty',
                'AZ-120': 'Microsoft Certified: Azure for SAP Workloads Specialty',
                'DP-420': 'Microsoft Certified: Azure Cosmos DB Developer Specialty',
                'MS-900': 'Microsoft Certified: Microsoft 365 Fundamentals',
                'MS-700': 'Microsoft Certified: Teams Administrator Associate',
                'MS-203': 'Microsoft Certified: Messaging Administrator Associate',
                'MS-740': 'Microsoft Certified: Teams Support Engineer Specialty',
                'MS-721': 'Microsoft Certified: Collaboration Communications Systems Engineer Specialty',
                'MS-102': 'Microsoft Certified: Modern Desktop Administrator Associate',
                'MS-100': 'Microsoft Certified: Microsoft 365 Enterprise Administrator Expert',
                'MS-101': 'Microsoft Certified: Microsoft 365 Enterprise Administrator Expert'
            };
            if (byExam[exam]) return byExam[exam];
            // Legacy Fabric Analytics naming
            if (/fabric.*analytics engineer/.test(n)) return 'Microsoft Certified: Fabric Data Engineer Associate';
            // Generic fallbacks based on keywords (only if not already prefixed)
            if (/fabric/.test(n) && /data engineer/.test(n)) return 'Microsoft Certified: Fabric Data Engineer Associate';
            return rawName; // Return unchanged if no mapping
        }

        function estimateSalary(cert){
            if (!cert) return null;
            if (typeof cert.salary === 'number' && cert.salary > 0) return cert.salary;
            if (salaryGuide.byName[cert.name]) return salaryGuide.byName[cert.name];
            const vendorBase = salaryGuide.byVendor[cert.vendor] || 0;
            const levelBase = salaryGuide.byLevelBase[cert.level] || 0;
            // Blend vendor and level base (simple average if both exist, else fallback)
            if (vendorBase && levelBase) return Math.round((vendorBase + levelBase) / 2);
            return vendorBase || levelBase || null;
        }

        // Category labels and canonical order for dynamic select
        const categoryLabelMap = {
            'core-it': 'Core Media & Enterta Foundations & Networking',
            'cloud-platforms': 'Cloud & Platforms',
            'cybersecurity': 'Cybersecurity & Privacy',
            'software-devops': 'Software Development & DevOps',
            'governance-agile': 'Media & Enterta Governance & Agile',
            'specialized-tech': 'Specialized Technical',
            'emerging-tech': 'Emerging Technologies'
        };
        const categoryOrder = ['core-it','cloud-platforms','cybersecurity','software-devops','governance-agile','specialized-tech','emerging-tech'];

        function suggestRoles(cert){
            const map = {
                'core-it': ['Media & Enterta Support Specialist', 'Network Support Technician', 'Systems Technician'],
                'cloud-platforms': ['Cloud Support Associate', 'Cloud Administrator', 'DevOps Associate'],
                'cybersecurity': ['Security Analyst (Blue Team)', 'SOC Analyst', 'Vulnerability Analyst'],
                'software-devops': ['Software Engineer (Jr.)', 'DevOps Engineer (Associate)', 'Platform Engineer'],
                'governance-agile': ['Media & EntertaSM Analyst', 'Project Coordinator', 'Scrum Master (Associate)'],
                'specialized-tech': ['Systems Engineer', 'Storage Administrator', 'Observability Analyst'],
                'emerging-tech': ['AI/ML Associate', 'Data Engineer (Associate)', 'IoT Specialist']
            };
            return map[cert.category] || ['Associate Professional', 'Analyst / Engineer (Level-aligned)'];
        }

        // Data-driven level exceptions (e.g., allow specific vendor exams at lower levels)
        const levelExceptions = [
            // Cisco: allow Associates at Level 1 (CCNA, CyberOps Associate, DevNet Associate)
            { vendor: 'Cisco', examRegex: /(200-301|200-201|200-901)|\bCCNA\b|CYBEROPS|CBROPS|DEVASC|DevNet Associate/i, allowAtLevels: [1], rationale: 'starter-associate' },
            
            // Microsoft: allow one Associate at Level 1 to pair with one or two Fundamentals
            { vendor: 'Microsoft', examRegex: /Associate|Administrator|Developer|AZ-104|SC-200|SC-300|AZ-204/i, allowAtLevels: [1], rationale: 'starter-associate' },
            // Google Cloud: allow Associate Cloud Engineer at Level 1 to pair with Digital Leader
            { vendor: 'Google Cloud', examRegex: /Associate Cloud Engineer|\bACE\b/i, allowAtLevels: [1], rationale: 'starter-associate' }
        ];
        function matchesException(cert) {
            if (!cert) return null;
            const v = String(cert.vendor||'');
            const nm = String(cert.name||'');
            const ex = String(cert.exam||'');
            for (const rule of levelExceptions) {
                if (rule.vendor && rule.vendor !== v) continue;
                if (rule.examRegex && !(rule.examRegex.test(nm) || rule.examRegex.test(ex))) continue;
                return rule;
            }
            return null;
        }
        function isLevelException(cert, level){
            const rule = matchesException(cert);
            if (!rule) return false;
            if (!Array.isArray(rule.allowAtLevels)) return false;
            return rule.allowAtLevels.includes(level);
        }

        // Estimate per-certification duration from level duration (proportional heuristic)
        function estimateCertDuration(cert){
            const level = cert?.level || 1;
            const ld = levelDuration[level];
            if (!ld) return 'Varies';
            // Convert level duration band to months
            const band = String(ld);
            let minY = 0, maxY = 0;
            if (band.includes('â')) {
                const parts = band.split('â');
                minY = parseFloat(parts[0]);
                maxY = parseFloat(parts[1]);
            } else if (band.includes('-')) {
                const parts = band.split('-');
                minY = parseFloat(parts[0]);
                maxY = parseFloat(parts[1]);
            } else {
                minY = maxY = parseFloat(band);
            }
            if (!isFinite(minY) || !isFinite(maxY) || !minY) return 'Varies';
            const avgYears = (minY + maxY) / 2;
            const totalMonths = avgYears * 12;
            // Assume per-level workload split: certifications ~55%, PD modules ~45%
            const certMonths = totalMonths * 0.55;
            // Estimated certifications count target per level (avg of min/max rule if defined)
            const rule = levelRules[level];
            const targetCount = rule ? (rule.min + (rule.max || rule.min)) / 2 : 5;
            const perCertMonths = certMonths / Math.max(1, targetCount);
            // Clamp between 1 and 8 months for reasonableness
            const clamped = Math.min(8, Math.max(1, perCertMonths));
            if (clamped < 2) return `${Math.round(clamped*4)/4} months`;
            return `${Math.round(clamped * 10) / 10} months`;
        }

        // Level bundle pricing (all-inclusive per level)
        const pricingConfig = {
            currency: 'USD',
            levelBundle: { 1: 8100, 2: 12000, 3: 16000, 4: 20000, 5: 26865 }
        };

        function computeSubtotal(level){
            return Number(pricingConfig.levelBundle?.[level]) || 0;
        }

        // Level selection rules (min/max certifications allowed per level)
        // Pattern: L1: 3, L2: 4, L3: 5-6, L4: 7, L5: 8-10
        const levelRules = {
            1: { min: 3, max: 3 },
            2: { min: 4, max: 4 },
            3: { min: 5, max: 6 },
            4: { min: 7, max: 7 },
            5: { min: 8, max: 10 }
        };

        // Track user-selected certifications per level
        const selectedByLevel = {
            1: new Set(),
            2: new Set(),
            3: new Set(),
            4: new Set(),
            5: new Set()
        };

        function getCumulativeSelection(level){
            const ids = new Set();
            for (let l=1; l<=level; l++) {
                if (selectedByLevel[l]) selectedByLevel[l].forEach(id=>ids.add(id));
            }
            return ids;
        }
        function getSelectedCount(level) {
            if (!level) return 0;
            return getCumulativeSelection(level).size;
        }

        function rulesTextFor(level) {
            if (!level || !levelRules[level]) return '';
            const { min, max } = levelRules[level];
            return min === max
                ? `Select ${min} certifications for Level ${level}.`
                : `Select ${min}-${max} certifications for Level ${level}.`;
        }

        function renderSelectionSummary(level, hostEl) {
            // Create/replace a compact summary banner under results
            const existing = hostEl.querySelector('.selection-summary');
            if (existing) existing.remove();
            if (!level || !levelRules[level]) return;
            const { min, max } = levelRules[level];
            const count = getSelectedCount(level);
            const summary = document.createElement('div');
            summary.className = 'selection-summary';
            summary.style.marginTop = '0.75rem';
            summary.style.padding = '0.75rem 1rem';
            summary.style.border = '1px solid #e2e8f0';
            summary.style.borderRadius = '12px';
            summary.style.background = '#f8fafc';
            summary.style.color = count < min ? '#b45309' : '#0f766e';
            summary.textContent = `${rulesTextFor(level)} Selected: ${count}${max ? `/${max}` : ''}.`;
            hostEl.appendChild(summary);
        }

        // Build Focus filter options and update vendor count dynamically from dataset
        function buildFiltersFromDataset() {
            try {
                // Normalize dataset once per session
                try {
                    if (!window._datasetNormalized) {
                        certifications = (function(list){
                            // Reuse enrichImportedCerts if present later, otherwise basic normalization
                            return validateAndNormalizeDataset(list);
                        })(certifications);
                        window._datasetNormalized = true;
                    }
                } catch(_) {}

                // Helper: compute a base eligible list honoring current state except a facet to skip
                const computeBaseEligible = (skipFacet)=>{
                    const lvl = parseInt(document.getElementById('levelFilter')?.value);
                    const cat = document.getElementById('categoryFilter')?.value || '';
                    const foc = document.getElementById('focusFilter')?.value || '';
                    const trackSelEls = Array.from(document.getElementById('trackFilter')?.selectedOptions || []);
                    const tracksSel = trackSelEls.map(o=>o.value);
                    const ven = document.getElementById('vendorFilter')?.value || '';
                    const vArea = document.getElementById('vendorAreaFilter')?.value || '';
                    const partner = document.getElementById('partnershipFilter')?.value || '';
                    const strictChron = !!document.getElementById('toggleStrictChronology')?.checked;
                    const inferStageLocal = (name)=>{
                        const n = String(name||'');
                        if (/(CCST|\bCCT\b|Certified Support Technician|Certified Technician)\b/i.test(n)) return 'Foundational';
                        if (/Fundamental|Foundational|Foundation|Cloud Practitioner|AI Practitioner/i.test(n)) return 'Foundational';
                        if (/(Associate|Administrator|Developer)\b/i.test(n)) return 'Associate';
                        if (/Professional/i.test(n)) return 'Professional';
                        if (/(Specialty|Specialist)\b/i.test(n)) return 'Specialty';
                        if (/(Expert|Architect)\b/i.test(n)) return 'Expert';
                        return null;
                    };
                    return certifications.filter(c=>!c.retired).filter(c=>{
                        if (strictChron && lvl) {
                            if (!isLevelException(c, lvl) && Array.isArray(c.level_range) && c.level_range.length===2) {
                                const [mn,mx] = c.level_range; if (!(lvl>=mn && lvl<=mx)) return false;
                            }
                            const st = c.vendor_stage || inferStageLocal(c.name);
                            if (lvl===1 && st && !/Fundamental|Foundational/i.test(st)) return false;
                            if (lvl===2 && st && !/Fundamental|Foundational|Associate|Administrator|Developer/i.test(st)) return false;
                        }
                        if (cat && (skipFacet!=='category') && c.category !== cat) return false;
                        if (foc && (skipFacet!=='focus') && c.focus !== foc) return false;
                        if (tracksSel.length>0 && (skipFacet!=='tracks')) {
                            const ct = Array.isArray(c.tracks) ? c.tracks : [];
                            if (!ct.some(t=>tracksSel.includes(t))) return false;
                        }
                        if (ven && (skipFacet!=='vendor') && c.vendor !== ven) return false;
                        if (vArea && (skipFacet!=='vendorArea')) {
                            const areas = Array.isArray(c.vendor_area) ? c.vendor_area : (c.vendor_area ? [c.vendor_area] : (c.vendor==='Microsoft' && c.solution_area ? [c.solution_area] : []));
                            if (!areas.includes(vArea)) return false;
                        }
                        if (partner && (skipFacet!=='partnership')) {
                            if (partner==='premium' && !c.premium) return false;
                            if (partner==='standard' && c.premium) return false;
                        }
                        return true;
                    });
                };
                // Category: dynamic from dataset with stable canonical order and friendly labels
                const catSelect = document.getElementById('categoryFilter');
                if (catSelect) {
                    const current = catSelect.value;
                    const base = computeBaseEligible('category');
                    const catSet = new Set();
                    const catCounts = {};
                    base.forEach(c => { if (c.category){ const k=String(c.category); catSet.add(k); catCounts[k]=(catCounts[k]||0)+1; } });
                    // compute ordered list: start with canonical in order if present, then any new categories alphabetically
                    const present = Array.from(catSet);
                    const ordered = categoryOrder.filter(k => present.includes(k));
                    const extras = present.filter(k => !categoryOrder.includes(k)).sort((a,b)=>a.localeCompare(b));
                    const finalList = [...ordered, ...extras];
                    // rebuild options
                    while (catSelect.firstChild) catSelect.removeChild(catSelect.firstChild);
                    const all = document.createElement('option'); all.value=''; all.textContent='All Categories'; catSelect.appendChild(all);
                    finalList.forEach(k => {
                        const opt = document.createElement('option');
                        opt.value = k;
                        const label = categoryLabelMap[k] || k.replace(/-/g,' ').replace(/\b\w/g, ch => ch.toUpperCase());
                        const count = catCounts[k] || 0;
                        opt.textContent = count ? `${label} (${count})` : label;
                        catSelect.appendChild(opt);
                    });
                    if (finalList.includes(current) || current==='') catSelect.value = current; else catSelect.value='';
                }

                const focusSelect = document.getElementById('focusFilter');
                if (focusSelect) {
                    const current = focusSelect.value;
                    // Clear and rebuild focus options
                    while (focusSelect.firstChild) focusSelect.removeChild(focusSelect.firstChild);
                    const all = document.createElement('option');
                    all.value = '';
                    all.textContent = 'All Focus Areas';
                    focusSelect.appendChild(all);
                    const base = computeBaseEligible('focus');
                    const focusSet = new Set();
                    const focusCounts = {};
                    base.forEach(c => { if (c.focus){ focusSet.add(c.focus); focusCounts[c.focus]=(focusCounts[c.focus]||0)+1; } });
                    Array.from(focusSet).sort().forEach(f => {
                        const opt = document.createElement('option');
                        opt.value = f;
                        const count = focusCounts[f] || 0;
                        opt.textContent = count ? `${f} (${count})` : f;
                        focusSelect.appendChild(opt);
                    });
                    // Restore selection if still present
                    if ([...focusSet, ''].includes(current)) focusSelect.value = current;
                }

                // Rebuild Vendor options from dataset and update count
                const vendorSelect = document.getElementById('vendorFilter');
                const vendorSet = new Set();
                const vendorCounts = {};
                const baseForVendor = computeBaseEligible('vendor');
                baseForVendor.forEach(c => { if (c.vendor){ vendorSet.add(c.vendor); vendorCounts[c.vendor]=(vendorCounts[c.vendor]||0)+1; } });
                if (vendorSelect) {
                    const currentVendor = vendorSelect.value;
                    while (vendorSelect.firstChild) vendorSelect.removeChild(vendorSelect.firstChild);
                    const allV = document.createElement('option');
                    allV.value = '';
                    allV.textContent = 'All Vendors';
                    vendorSelect.appendChild(allV);
                    Array.from(vendorSet).sort((a,b)=>a.localeCompare(b)).forEach(v => {
                        const opt = document.createElement('option');
                        opt.value = v;
                        const count = vendorCounts[v] || 0;
                        opt.textContent = count ? `${v} (${count})` : v;
                        vendorSelect.appendChild(opt);
                    });
                    if ([...vendorSet, ''].includes(currentVendor)) vendorSelect.value = currentVendor;
                }

                const vendorCountEl = document.querySelector('.vendor-count');
                if (vendorCountEl) vendorCountEl.textContent = `(${vendorSet.size})`;

                // Build vendor area options based on currently selected vendor
                rebuildVendorAreaOptions();

                // Build track options from dataset
                try {
                    const trackSelect = document.getElementById('trackFilter');
                    if (trackSelect) {
                        const current = Array.from(trackSelect.selectedOptions).map(o=>o.value);
                        while (trackSelect.firstChild) trackSelect.removeChild(trackSelect.firstChild);
                        const base = computeBaseEligible('tracks');
                        const trackSet = new Set();
                        const trackCounts = {};
                        base.forEach(c => (c.tracks||[]).forEach(t => { const k=String(t); trackSet.add(k); trackCounts[k]=(trackCounts[k]||0)+1; }));
                        const tracks = Array.from(trackSet).sort((a,b)=>a.localeCompare(b));
                        tracks.forEach(t => { const opt=document.createElement('option'); opt.value=t; const count=trackCounts[t]||0; opt.textContent = count ? `${t} (${count})` : t; trackSelect.appendChild(opt); });
                        // restore selection
                        current.forEach(v => { const o=[...trackSelect.options].find(x=>x.value===v); if (o) o.selected=true; });
                    }
                } catch(_) {}

                // Render vendor counts panel
                try {
                    const counts = Array.from(vendorSet).reduce((acc, v) => { acc[v] = 0; return acc; }, {});
                    const base = computeBaseEligible('vendor');
                    base.forEach(c => { if (c.vendor && counts.hasOwnProperty(c.vendor)) counts[c.vendor]++; });
                    const items = Object.entries(counts).sort((a,b)=>{
                        if (b[1] !== a[1]) return b[1]-a[1];
                        return a[0].localeCompare(b[0]);
                    });
                    const body = document.querySelector('#vendor-counts .vendor-counts-body');
                    if (body) {
                        body.innerHTML = items.map(([v,c])=>`${v}: ${c}`).join(' â¢ ');
                    }
                } catch (_) {}
            } catch (_) { /* no-op */ }
        }

        // Preferred/premium vendors for badge styling
        const premiumVendorsSet = new Set([
            'CompTIA','Cisco','AWS','Microsoft','Google Cloud','VMware/Omnissa','(ISC)Â²','ISACA','PeopleCert','PMI','CWNP'
        ]);

        // Populate category cards' Focus Areas and Vendor badges from the dataset
        function populateCategoryCardsFromDataset() {
            try {
                const cards = document.querySelectorAll('.category-card[data-category]');
                if (!cards.length || !Array.isArray(certifications) || certifications.length===0) return;
                cards.forEach(card => {
                    const cat = card.getAttribute('data-category');
                    if (!cat) return;
                    const inCat = certifications.filter(c => !c.retired && c.category === cat);
                    // Focus Areas: top 5 by count
                    const focusCounts = inCat.reduce((acc,c)=>{ const f=String(c.focus||'').trim(); if (f) acc[f]=(acc[f]||0)+1; return acc; }, {});
                    const focusAreas = Object.entries(focusCounts).sort((a,b)=>b[1]-a[1] || a[0].localeCompare(b[0])).slice(0,5).map(([f])=>f);
                    const focusHost = card.querySelector('.focus-areas');
                    if (focusHost) {
                        focusHost.innerHTML = '<strong>Focus Areas:</strong>';
                        focusAreas.forEach(f => {
                            const span = document.createElement('span');
                            span.className = 'focus-area-tag';
                            span.textContent = f;
                            focusHost.appendChild(span);
                        });
                    }
                    // Vendors: top 10 by count
                    const vendorCounts = inCat.reduce((acc,c)=>{ const v=String(c.vendor||'').trim(); if (v) acc[v]=(acc[v]||0)+1; return acc; }, {});
                    const vendors = Object.entries(vendorCounts).sort((a,b)=>b[1]-a[1] || a[0].localeCompare(b[0])).slice(0,10).map(([v])=>v);
                    const vendorsHost = card.querySelector('.vendors-list');
                    if (vendorsHost) {
                        vendorsHost.innerHTML = '<strong>Vendor Partners:</strong>';
                        vendors.forEach(v => {
                            const span = document.createElement('span');
                            span.className = 'vendor-badge ' + (premiumVendorsSet.has(v) ? 'premium' : 'standard');
                            span.textContent = v;
                            vendorsHost.appendChild(span);
                        });
                    }
                });
                // Rewire interactions for newly created tags/badges
                wireDynamicFocusAreaTags();
                wireDynamicVendorBadges();
            } catch(_) { /* no-op */ }
        }

        function wireDynamicVendorBadges(){
            document.querySelectorAll('.category-card .vendor-badge').forEach(badge => {
                if (badge.dataset.boundVendorClick === '1') return;
                badge.dataset.boundVendorClick = '1';
                // Accessibility attributes
                badge.setAttribute('role', 'button');
                badge.setAttribute('tabindex', '0');
                badge.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const vendorName = this.textContent.trim();
                    const category = this.closest('.category-card')?.dataset?.category || '';
                    const categorySel = document.getElementById('categoryFilter');
                    const vendorSel = document.getElementById('vendorFilter');
                    if (categorySel && category) categorySel.value = category;
                    if (vendorSel) vendorSel.value = vendorName;
                    // Clear search to avoid stale narrowing
                    const si = document.querySelector('.search-input');
                    if (si) si.value = '';
                    try { rebuildVendorAreaOptions(); } catch(_) {}
                    document.getElementById('certification-filtering').scrollIntoView({ behavior: 'smooth' });
                    try { setPage(1); applyFilters(); } catch(_){ }
                });
                // Keyboard support: Enter/Space
                badge.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
        }

        function wireDynamicFocusAreaTags(){
            document.querySelectorAll('.focus-area-tag').forEach(tag => {
                if (tag.dataset.boundFocusClick === '1') return;
                tag.dataset.boundFocusClick = '1';
                tag.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const focusArea = this.textContent;
                    const focusSel = document.getElementById('focusFilter');
                    if (focusSel) {
                        const opt = Array.from(focusSel.options).find(o=>o.value===focusArea || o.textContent===focusArea);
                        focusSel.value = opt ? opt.value : '';
                    }
                    const si = document.querySelector('.search-input');
                    if (si) si.value = '';
                    document.getElementById('certification-filtering').scrollIntoView({ behavior: 'smooth' });
                    try { setPage(1); applyFilters(); } catch(_){ }
                });
            });
        }

        // Pagination state
        let PAGE_SIZE = 12; // cards per page
        let currentPage = 1; // 1-based

        function setPage(n){ currentPage = Math.max(1, n); }

        function renderPagination(total, onPageChange){
            const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
            if (currentPage > totalPages) currentPage = totalPages;
            const top = document.getElementById('results-pagination-top');
            const bot = document.getElementById('results-pagination-bottom');
            const make = () => {
                const prevDisabled = currentPage <= 1;
                const nextDisabled = currentPage >= totalPages;
                return `
                    <button class="page-btn" ${prevDisabled?'disabled':''} data-act="prev">Prev</button>
                    <span class="page-indicator">Page ${currentPage} of ${totalPages}</span>
                    <button class="page-btn" ${nextDisabled?'disabled':''} data-act="next">Next</button>
                `;
            };
            [top, bot].forEach(el => {
                if (!el) return;
                if (totalPages <= 1) { el.style.display = 'none'; el.innerHTML = ''; return; }
                el.style.display = 'flex';
                el.innerHTML = make();
                el.querySelector('[data-act="prev"]')?.addEventListener('click', ()=>{ if (currentPage>1){ setPage(currentPage-1); onPageChange(); window.requestAnimationFrame(()=>{ el.scrollIntoView({behavior:'smooth', block:'nearest'}); }); } });
                el.querySelector('[data-act="next"]')?.addEventListener('click', ()=>{ if (currentPage<totalPages){ setPage(currentPage+1); onPageChange(); window.requestAnimationFrame(()=>{ el.scrollIntoView({behavior:'smooth', block:'nearest'}); }); } });
            });
        }

        function applyFilters() {
            const level = parseInt(document.getElementById('levelFilter').value);
            const category = document.getElementById('categoryFilter').value;
            const focus = document.getElementById('focusFilter').value;
            const trackSelEls = Array.from(document.getElementById('trackFilter')?.selectedOptions || []);
            const trackSelections = trackSelEls.map(o=>o.value);
            const vendor = document.getElementById('vendorFilter').value;
            const vendorArea = document.getElementById('vendorAreaFilter')?.value || '';
            const partnership = document.getElementById('partnershipFilter').value;
            const sort = document.getElementById('sortFilter')?.value || 'level-asc';
            const search = (document.querySelector('.search-input')?.value || '').toLowerCase();
            const vendorAnchored = !!document.getElementById('toggleVendorAnchor')?.checked;
            const strictChronology = !!document.getElementById('toggleStrictChronology')?.checked;
            const recommendedFirst = !!document.getElementById('toggleRecommendedFirst')?.checked;
            const eligibleOnly = !!document.getElementById('toggleEligibleOnly')?.checked;
            const groupBy = document.getElementById('groupByFilter')?.value || 'none';

            // Vendor normalization and policy map (single source of truth for level gating per vendor)
            const normVendor = (v)=>{
                const s = String(v||'').trim();
                if (!s) return '';
                const low = s.toLowerCase();
                if (/(^microsoft( corporation)?$|^msft$)/i.test(s)) return 'Microsoft';
                if (/^cisco( systems)?$/i.test(s)) return 'Cisco';
                return s; // keep original for others
            };
            // Normalize vendor area names for robust matching (e.g., "Data & AI" vs "Data and AI")
            const normArea = (a)=> String(a||'')
                .toLowerCase()
                .replace(/&/g,'and')
                .replace(/[^a-z0-9]+/g,' ')
                .replace(/\s+/g,' ')
                .trim();
            // Allowed stages per level per vendor; fallback to 'default'
            const VENDOR_POLICY = {
                default: {
                    1: ['Foundational'],
                    2: ['Foundational','Associate'],
                    3: ['Foundational','Associate','Professional','Expert','Specialty','Architect'],
                    4: ['Foundational','Associate','Professional','Expert','Specialty','Architect'],
                    5: ['Foundational','Associate','Professional','Expert','Specialty','Architect']
                },
                Microsoft: {
                    // Microsoft uses Fundamentals, Associate, Expert, Specialty (no "Professional" label)
                    1: ['Foundational','Fundamental'],
                    2: ['Foundational','Fundamental','Associate','Administrator','Developer','Data Analyst','Security Operations Analyst','Power Platform App Maker'],
                    3: ['Foundational','Fundamental','Associate','Administrator','Developer','Specialty','Expert','Architect'],
                    4: ['Foundational','Fundamental','Associate','Administrator','Developer','Specialty','Expert','Architect'],
                    5: ['Foundational','Fundamental','Associate','Administrator','Developer','Specialty','Expert','Architect']
                },
                Cisco: {
                    // Matches our business rules and Cisco-specific handling elsewhere
                    1: ['Foundational'],
                    2: ['Foundational','Associate','Administrator','Developer'],
                    3: ['Foundational','Associate','Professional','Expert'],
                    4: ['Foundational','Associate','Professional','Expert'],
                    5: ['Foundational','Associate','Professional','Expert']
                }
            };

            // Wire Quick Pick handlers (idempotent binding per apply)
            try {
                const qp = document.getElementById('quickPickPrimary');
                const qc = document.getElementById('quickPickClear');
                if (qp && !qp.__bound) {
                    qp.__bound = true;
                    qp.addEventListener('click', ()=>{
                        const lv = parseInt(document.getElementById('levelFilter').value)||0;
                        const ven = document.getElementById('vendorFilter').value||'';
                        if (!lv) { openInfoModal({ title:'Quick Pick', body:['Choose a Level to enable Quick Pick.']}); return; }
                        quickPickRecommend(ven, lv);
                        setPage(1); applyFilters();
                    });
                }
                if (qc && !qc.__bound) {
                    qc.__bound = true;
                    qc.addEventListener('click', ()=>{
                        const lv = parseInt(document.getElementById('levelFilter').value)||0;
                        if (!lv) return;
                        selectedByLevel[lv] = new Set();
                        setPage(1); applyFilters();
                    });
                }
            } catch(_) {}

            // Filter certifications
            const active = certifications.filter(c => !c.retired);
            // Eligibility check helpers
            const prior = level ? getCumulativeSelection(level-1) : new Set();
            const hasTag = (tags, tag)=>Array.isArray(tags) && tags.includes(tag);
            const prereqsMet = (cert)=>{
                const reqs = cert.prereqTags || [];
                if (!reqs.length) return true;
                // satisfied by prior selections' tags
                const priorCerts = certifications.filter(c=>prior.has(c.id));
                const priorTags = new Set(priorCerts.flatMap(c=>c.tags||[]));
                return reqs.every(r=>priorTags.has(r));
            };
            // Data-driven exception checker (replaces hardcoded Cisco L1 starter)
            const isCiscoL1AssociateStarter = (cert)=> isLevelException(cert, level);
            const inLevelWindow = (cert)=>{
                // Cumulative level visibility: Level N shows Levels 1..N
                if (isCiscoL1AssociateStarter(cert)) return true;
                if (!level) return true;
                
                // Use level_range if available, otherwise fall back to exact level matching
                if (Array.isArray(cert.level_range) && cert.level_range.length === 2) {
                    const [minL/*,maxL*/] = cert.level_range;
                    return level >= minL;
                }
                
                // Fallback: exact level match if no level_range
                return cert.level === level;
            };
            // Infer vendor stage from name if explicit stage is missing
            const inferVendorStage = (c) => {
                const n = String(c.name||'');
                // Cisco acronyms
                if (/(\bCCST\b|\bCCT\b|Certified Support Technician|Certified Technician)\b/i.test(n)) return 'Foundational';
                if (/(\bCCNA\b|CyberOps Associate|DevNet Associate)\b/i.test(n)) return 'Associate';
                if (/(\bCCNP\b|DevNet Professional)\b/i.test(n)) return 'Professional';
                if (/(\bCCIE\b|\bCCDE\b|DevNet Expert)\b/i.test(n)) return 'Expert';
                // Generic keywords
                if (/Fundamental|Foundational|Foundation|Cloud Practitioner|AI Practitioner/i.test(n)) return 'Foundational';
                if (/(Associate|Administrator|Developer)\b/i.test(n)) return 'Associate';
                if (/Professional/i.test(n)) return 'Professional';
                if (/(Specialty|Specialist)\b/i.test(n)) return 'Specialty';
                if (/(Expert|Architect)\b/i.test(n)) return 'Expert';
                return null;
            };

            const stageFitsLevel = (cert)=>{
                if (!level) return true;
                const st = cert.vendor_stage || inferVendorStage(cert);
                if (!st) return true;
                const vendorName = normVendor(cert.vendor);
                const policy = VENDOR_POLICY[vendorName] || VENDOR_POLICY.default;
                const allowed = policy[level] || VENDOR_POLICY.default[level];
                // Accept if vendor_stage text matches any allowed stage keyword
                const stStr = String(st);
                return allowed.some(k=> new RegExp(`(^|\\b)${k}(s)?(\\b|$)`, 'i').test(stStr));
            };
            // Helper: collect Level 1 Associate candidates honoring current filters except stage gating
            const collectL1AssociateCandidates = ()=>{
                if (!(strictChronology && level >= 1)) return [];
                let list = active.filter(cert => {
                    if (cert.retired) return false;
                    // NOTE: Bypass level_range window for L1 Associate candidates to allow up to two associates at Level 1
                    if (category && cert.category !== category) return false;
                    if (focus && cert.focus !== focus) return false;
                    if (trackSelections.length > 0) {
                        const ct = Array.isArray(cert.tracks) ? cert.tracks : [];
                        if (!ct.some(t => trackSelections.includes(t))) return false;
                    }
                    if (vendor && cert.vendor !== vendor) return false; // keep within selected vendor if any
                    if (vendor && vendorArea) {
                        // Cumulative visibility: if this item belongs to the selected vendor and is from an earlier recommended level,
                        // allow it to bypass vendor area gating so Levels 1..N remain visible at Level N (especially for Cisco foundations).
                        let earlyLevelForVendor = false;
                        try {
                            if (level && cert.vendor === vendor) {
                                if (Array.isArray(cert.level_range) && cert.level_range.length === 2) {
                                    const [minL/*,maxL*/] = cert.level_range;
                                    if (Number.isFinite(minL) && level > minL) earlyLevelForVendor = true;
                                } else {
                                    // If no explicit level_range, infer stage and treat Foundational/Associate as early relative to L>=2
                                    const st = cert.vendor_stage || inferVendorStage(cert);
                                    if (level >= 2 && /Fundamental|Foundational|Associate|Administrator|Developer/i.test(String(st||''))) earlyLevelForVendor = true;
                                }
                            }
                        } catch(_) { /* no-op */ }
                        if (!earlyLevelForVendor) {
                            const areasRaw = Array.isArray(cert.vendor_area) ? cert.vendor_area : (cert.vendor_area ? [cert.vendor_area] : (cert.vendor==='Microsoft' && cert.solution_area ? [cert.solution_area] : []));
                            const filterKey = normArea(vendorArea);
                            const match = areasRaw.some(a=> normArea(a) === filterKey);
                            if (!match) return false;
                        }
                    }
                    if (partnership === 'premium' && !cert.premium) return false;
                    if (partnership === 'standard' && cert.premium) return false;
                    if (search && !cert.name.toLowerCase().includes(search) && !cert.vendor.toLowerCase().includes(search) && !cert.focus.toLowerCase().includes(search)) return false;
                    // NOTE: Bypass prereq gating for Level 1 associate allowance so users can see/select up to two associates
                    // Require exception rule and appropriate stage
                    const st = cert.vendor_stage || inferVendorStage(cert);
                    if (!/Associate|Administrator|Developer/i.test(String(st||''))) return false;
                    if (!isLevelException(cert, 1)) return false;
                    return true;
                });
                // Sort by value + fit
                const preferredTracks = new Set(trackSelections && trackSelections.length ? trackSelections : ['Security','Data','Cloud','DevOps']);
                const focusPref = focus ? String(focus) : null;
                const trackScore = (c)=>{
                    let s = 0;
                    const tracks = Array.isArray(c.tracks) ? c.tracks : [];
                    for (const t of tracks) if (preferredTracks.has(String(t))) s += 1;
                    if (focusPref && String(c.focus||'') === focusPref) s += 0.5;
                    return s;
                };
                list.sort((a,b)=> (Number(b.salary_index)||0) - (Number(a.salary_index)||0)
                                    || (Number(b.popularity)||0) - (Number(a.popularity)||0)
                                    || trackScore(b) - trackScore(a)
                                    || String(a.name).localeCompare(b.name));
                return list;
            };
            // Helper: rebuild candidate list ignoring the explicit vendor constraint (to avoid dead-ends)
            const buildListIgnoringVendor = ()=>{
                let list = active.filter(cert => {
                    if (cert.retired) return false;
                    if (level && strictChronology && !inLevelWindow(cert)) return false;
                    if (category && cert.category !== category) return false;
                    if (focus && cert.focus !== focus) return false;
                    if (trackSelections.length > 0) {
                        const ct = Array.isArray(cert.tracks) ? cert.tracks : [];
                        if (!ct.some(t => trackSelections.includes(t))) return false;
                    }
                    // NOTE: Deliberately not applying explicit vendor filter here
                    if (vendor && vendorArea) {
                        // Cumulative visibility for selected vendor: allow earlier-level items even if not in the chosen area
                        let earlyLevelForVendor = false;
                        try {
                            if (level && cert.vendor === vendor) {
                                if (Array.isArray(cert.level_range) && cert.level_range.length === 2) {
                                    const [minL/*,maxL*/] = cert.level_range;
                                    if (Number.isFinite(minL) && level > minL) earlyLevelForVendor = true;
                                } else {
                                    const st = cert.vendor_stage || inferVendorStage(cert);
                                    if (level >= 2 && /Fundamental|Foundational|Associate|Administrator|Developer/i.test(String(st||''))) earlyLevelForVendor = true;
                                }
                            }
                        } catch(_) { /* no-op */ }
                        if (!earlyLevelForVendor) {
                            const areasRaw = Array.isArray(cert.vendor_area) ? cert.vendor_area : (cert.vendor_area ? [cert.vendor_area] : (cert.vendor==='Microsoft' && cert.solution_area ? [cert.solution_area] : []));
                            const filterKey = normArea(vendorArea);
                            const match = areasRaw.some(a=> normArea(a) === filterKey);
                            if (!match) return false;
                        }
                    }
                    if (partnership === 'premium' && !cert.premium) return false;
                    if (partnership === 'standard' && cert.premium) return false;
                    if (search && !cert.name.toLowerCase().includes(search) && !cert.vendor.toLowerCase().includes(search) && !cert.focus.toLowerCase().includes(search)) return false;
                    if (strictChronology && level && !prereqsMet(cert) && !isLevelException(cert, level)) return false;
                    if (strictChronology && level && !stageFitsLevel(cert) && !isLevelException(cert, level)) return false;
                    return true;
                });
                // Apply L1 associate allowance on the relaxed list for consistency
                if (strictChronology && level === 1) {
                    const L1_ASSOCIATE_LIMMedia & Enterta = 3; // Show up to 3 associates as options (user picks 1 per levelRules)
                    const isFoundational = (c)=> /Fundamental|Foundational/i.test(String(c.vendor_stage||''));
                    const isAssociate = (c)=> /Associate/i.test(String(c.vendor_stage||''));
                    const ciscoAllowed = (c)=> isLevelException(c, 1);
                    const foundational = list.filter(c => isFoundational(c) || ciscoAllowed(c));
                    const associates = list.filter(c => isAssociate(c) && !ciscoAllowed(c));
                    const preferredTracks = new Set(trackSelections && trackSelections.length ? trackSelections : ['Security','Data','Cloud','DevOps']);
                    const focusPref = focus ? String(focus) : null;
                    const trackScore = (c)=>{
                        let s = 0;
                        const tracks = Array.isArray(c.tracks) ? c.tracks : [];
                        for (const t of tracks) if (preferredTracks.has(String(t))) s += 1;
                        if (focusPref && String(c.focus||'') === focusPref) s += 0.5;
                        return s;
                    };
                    associates.sort((a,b)=> (Number(b.salary_index)||0) - (Number(a.salary_index)||0)
                                            || (Number(b.popularity)||0) - (Number(a.popularity)||0)
                                            || trackScore(b) - trackScore(a)
                                            || String(a.name).localeCompare(b.name));
                    const assocAllowed = associates.slice(0, L1_ASSOCIATE_LIMMedia & Enterta);
                    list = foundational.concat(assocAllowed);
                }
                return list;
            };
            let filtered;
            
            // Cisco Special Case (All Levels): Rebuild cumulative list to guarantee all foundations/associates appear
            // This bypasses category/focus/tracks/vendor area filters for earlier-level items to preserve cumulative visibility
            if (strictChronology && vendor === 'Cisco' && level >= 1 && level <= 5) {
                console.log('ð CISCO SPECIAL CASE TRIGGERED:', {vendor, level, strictChronology});
                const isFoundational = (c)=> /Fundamental|Foundational/i.test(String(c.vendor_stage || inferVendorStage(c)));
                const isAssociate = (c)=> /Associate/i.test(String(c.vendor_stage || inferVendorStage(c)));
                const isProfessional = (c)=> /Professional/i.test(String(c.vendor_stage || inferVendorStage(c)));
                const isExpert = (c)=> /Expert/i.test(String(c.vendor_stage || inferVendorStage(c)));
                const L1_ASSOCIATE_LIMMedia & Enterta = 3; // Show up to 3 associates as options at L1
                
                // Build cumulative list by stage
                const out = [];
                const seen = new Set();
                
                // 1. Foundations: always visible at all levels (no filters except vendor match)
                const foundational = active.filter(c => {
                    if (c.retired) return false;
                    if (c.vendor !== vendor) return false;
                    if (!isFoundational(c)) return false;
                    return true;
                });
                foundational.sort((a,b)=> String(a.name).localeCompare(b.name));
                for (const c of foundational) {
                    if (!seen.has(c.id)) { seen.add(c.id); out.push(c); }
                }
                
                // 2. Associates: L1 exceptions (CCNA, CyberOps, DevNet) always visible at L1+
                if (level >= 1) {
                    const associates = collectL1AssociateCandidates().filter(c => {
                        if (c.vendor !== vendor) return false;
                        if (!isLevelException(c, 1)) return false;
                        return true;
                    });
                    associates.sort((a,b)=> String(a.name).localeCompare(b.name));
                    const assocAllowed = associates.slice(0, L1_ASSOCIATE_LIMMedia & Enterta);
                    for (const c of assocAllowed) {
                        if (!seen.has(c.id)) { seen.add(c.id); out.push(c); }
                    }
                }
                
                // 3. Professional-level items: visible at L3+ (CCNP tracks, DevNet Professional, etc.)
                // Level 2 should ONLY show Foundational + Associates, NOT Professional tier
                console.log('ð§ PROFESSIONAL CHECK: level=' + level + ', should add Professional?', level >= 3);
                if (level >= 3) {
                    const professional = active.filter(c => {
                        if (c.retired) return false;
                        if (c.vendor !== vendor) return false;
                        if (seen.has(c.id)) return false; // already added
                        if (!isProfessional(c)) return false;
                        if (!inLevelWindow(c)) return false;
                        return true;
                    });
                    console.log('â PROFESSIONAL Media & EntertaEMS FOUND:', professional.length, professional.map(c => c.name));
                    professional.sort((a,b)=> String(a.name).localeCompare(b.name));
                    for (const c of professional) {
                        if (!seen.has(c.id)) { seen.add(c.id); out.push(c); }
                    }
                } else {
                    console.log('â SKIPPING PROFESSIONAL: Level', level, 'is less than 3');
                }
                
                // 4. Expert-level items: visible at L3+ (CCIE, CCDE, DevNet Expert)
                if (level >= 3) {
                    const expert = active.filter(c => {
                        if (c.retired) return false;
                        if (c.vendor !== vendor) return false;
                        if (seen.has(c.id)) return false; // already added
                        if (!isExpert(c)) return false;
                        if (!inLevelWindow(c)) return false;
                        return true;
                    });
                    expert.sort((a,b)=> String(a.name).localeCompare(b.name));
                    for (const c of expert) {
                        if (!seen.has(c.id)) { seen.add(c.id); out.push(c); }
                    }
                }
                
                filtered = out;
                console.log('ð CISCO LEVEL ' + level + ' FINAL COUNT:', out.length, 'items');
                console.log('ð CISCO LEVEL ' + level + ' Media & EntertaEMS:', out.map(c => c.name));
            }
            // Microsoft Special Case: Apply LevelâSolution Area matrix (cumulative per area)
            else if (strictChronology && vendor === 'Microsoft' && level >= 1 && level <= 5) {
                console.log('ð MICROSOFT MATRIX TRIGGERED:', {vendor, level, vendorArea, strictChronology});
                // Map dataset vendor area labels to matrix area keys
                const areaAliasMap = {
                    'data & ai': 'Azure Data and AI',
                    'data and ai': 'Azure Data and AI',
                    'azure data and ai': 'Azure Data and AI',
                    'digital & app innovation': 'Digital & App Innovation',
                    'digital and app innovation': 'Digital & App Innovation',
                    'modern work': 'Modern Workplace',
                    'modern workplace': 'Modern Workplace',
                    'infrastructure': 'Infrastructure',
                    'security': 'Security',
                    'networking': 'Networking'
                };
                const normAreaKey = (a)=> areaAliasMap[String(a||'').toLowerCase()] || '';
                const areaSelected = normAreaKey(vendorArea) || '';
                // Build cumulative allowed names set across levels up to current
                const accumulateArea = (areaLabel)=>{
                    const matrix = MICROSOFT_LEVEL_AREA_MATRIX[areaLabel];
                    if (!matrix) return [];
                    const names = [];
                    for (let l=1; l<=level; l++) {
                        if (matrix[l]) names.push(...matrix[l]);
                    }
                    return Array.from(new Set(names));
                };
                let areaList;
                if (areaSelected && MICROSOFT_LEVEL_AREA_MATRIX[areaSelected]) {
                    areaList = accumulateArea(areaSelected);
                } else {
                    // Union across all areas if no specific area chosen
                    areaList = Array.from(new Set(Object.keys(MICROSOFT_LEVEL_AREA_MATRIX).flatMap(a=>accumulateArea(a))));
                }
                // Store both raw and normalized names for robust matching
                const allowedRaw = new Set(areaList);
                const allowedNorm = new Set(areaList.map(n=>normalizeMsCertName(n)));
                // Architect-level gating: only show architect/enterprise items at Level 5
                const isArchitectTrack = (nm)=>/(Solutions Architect Expert|Cybersecurity Architect Expert|Enterprise Administrator|Data Scientist|for SAP Workloads Specialty)/i.test(nm);
                const out = [];
                const seen = new Set();
                // Pull all Microsoft certs from active list first (ignore other vendors)
                const msActive = active.filter(c=>c.vendor==='Microsoft');
                // Helper: assign solution area to a Microsoft cert based on canonical name presence in matrix lists
                function assignMicrosoftSolutionArea(cert){
                    if (!cert || cert.vendor!=='Microsoft') return;
                    const canonical = canonicalMicrosoftDisplayName(cert);
                    const normCanonical = normalizeMsCertName(canonical);
                    for (const areaKey of Object.keys(MICROSOFT_LEVEL_AREA_MATRIX)) {
                        const allNames = Array.from(new Set(Object.values(MICROSOFT_LEVEL_AREA_MATRIX[areaKey]).flat()));
                        for (const nm of allNames) {
                            if (normCanonical === normalizeMsCertName(nm) || msMatrixMatch(canonical, nm)) {
                                cert.solution_area = areaKey; // non-destructive; adds if missing
                                return;
                            }
                        }
                    }
                }
                // Include items that match matrix-listed names only (cumulative up to current level)
                msActive.forEach(c => {
                    assignMicrosoftSolutionArea(c);
                    const canonical = canonicalMicrosoftDisplayName(c);
                    const toCheck = [canonical, c.name, c.name.replace(/^Microsoft\s+/i,'')];
                    let allowed = false;
                    // Fast path: normalized equality against allowed names
                    for (const nm of toCheck) { if (allowedNorm.has(normalizeMsCertName(nm))) { allowed = true; break; } }
                    // Fallback: token/substring match against allowed names
                    if (!allowed) {
                        for (const a of allowedRaw) { if (msMatrixMatch(canonical, a) || msMatrixMatch(c.name, a)) { allowed = true; break; } }
                    }
                    // Strict area enforcement: if an area is selected, require cert.solution_area to match that area key
                    if (areaSelected && c.solution_area !== areaSelected) return;
                    if (!allowed) return;
                    // Architect-level items will only be in allowed list at Level 5, but keep extra guard
                    if (isArchitectTrack(canonical) && level < 5) return;
                    if (seen.has(c.id)) return;
                    seen.add(c.id);
                    out.push(c);
                });

                // Order results to match markdown matrix order
                const orderIndex = new Map();
                areaList.forEach((nm, idx)=> orderIndex.set(normalizeMsCertName(nm), Math.min(idx, orderIndex.get(normalizeMsCertName(nm)) ?? idx)));
                out.sort((a,b)=>{
                    const an = normalizeMsCertName(canonicalMicrosoftDisplayName(a));
                    const bn = normalizeMsCertName(canonicalMicrosoftDisplayName(b));
                    const ai = orderIndex.has(an) ? orderIndex.get(an) : Number.MAX_SAFE_INTEGER;
                    const bi = orderIndex.has(bn) ? orderIndex.get(bn) : Number.MAX_SAFE_INTEGER;
                    if (ai !== bi) return ai - bi;
                    return String(a.name).localeCompare(String(b.name));
                });
                // Preserve previously selected (earlier levels) even if not in matrix (safety)
                if (level) {
                    const prev = getCumulativeSelection(level-1);
                    prev.forEach(id => {
                        const cert = certifications.find(c=>c.id===id);
                        if (cert && cert.vendor==='Microsoft' && !seen.has(cert.id)) { seen.add(cert.id); out.push(cert); }
                    });
                }
                // Optional: apply search / partnership refinement AFTER matrix inclusion
                const partnership = document.getElementById('partnershipFilter').value;
                const search = (document.querySelector('.search-input')?.value || '').toLowerCase();
                filtered = out.filter(c => {
                    if (partnership==='premium' && !c.premium) return false;
                    if (partnership==='standard' && c.premium) return false;
                    if (search && !c.name.toLowerCase().includes(search) && !c.focus.toLowerCase().includes(search)) return false;
                    return true;
                });
                console.log('ð MICROSOFT LEVEL ' + level + ' FINAL COUNT:', filtered.length, 'items');
                console.log('ð MICROSOFT Media & EntertaEMS:', filtered.map(c=>c.name));
            }
            // Vendor-agnostic curation (CompTIA currently)
            else if (vendor === 'CompTIA' && level) {
                const area = (document.getElementById('vendorAreaFilter')?.value || '').trim();
                const { names } = curationEngine.getCurated('CompTIA', level, area);
                let baseSet = active.filter(c => c.vendor === 'CompTIA' && (names.length ? names.includes(c.name) : true));
                // Apply non-stage filters (category/focus/tracks/partnership/search); skip vendorArea metadata check for CompTIA curated set
                baseSet = baseSet.filter(cert => {
                    if (category && cert.category !== category) return false;
                    if (focus && cert.focus !== focus) return false;
                    if (trackSelections.length > 0) {
                        const ct = Array.isArray(cert.tracks) ? cert.tracks : [];
                        if (!ct.some(t => trackSelections.includes(t))) return false;
                    }
                    if (partnership === 'premium' && !cert.premium) return false;
                    if (partnership === 'standard' && cert.premium) return false;
                    if (search && !cert.name.toLowerCase().includes(search) && !cert.vendor.toLowerCase().includes(search) && !cert.focus.toLowerCase().includes(search)) return false;
                    return true;
                });
                // Fallback to default pipeline if curated set ends up empty (e.g., data mismatch)
                if (baseSet.length > 0) {
                    filtered = baseSet;
                } else {
                    filtered = active.filter(cert => {
                        if (cert.retired) return false;
                        if (level && strictChronology && !inLevelWindow(cert)) return false;
                        if (category && cert.category !== category) return false;
                        if (focus && cert.focus !== focus) return false;
                        if (trackSelections.length > 0) {
                            const ct = Array.isArray(cert.tracks) ? cert.tracks : [];
                            if (!ct.some(t => trackSelections.includes(t))) return false;
                        }
                        if (vendor && cert.vendor !== vendor) return false;
                        if (vendor && vendorArea) {
                            const areasRaw = Array.isArray(cert.vendor_area) ? cert.vendor_area : (cert.vendor_area ? [cert.vendor_area] : (cert.vendor==='Microsoft' && cert.solution_area ? [cert.solution_area] : []));
                            const filterKey = normArea(vendorArea);
                            const match = areasRaw.some(a=> normArea(a) === filterKey);
                            if (!match) return false;
                        }
                        if (partnership === 'premium' && !cert.premium) return false;
                        if (partnership === 'standard' && cert.premium) return false;
                        if (search && !cert.name.toLowerCase().includes(search) && !cert.vendor.toLowerCase().includes(search) && !cert.focus.toLowerCase().includes(search)) return false;
                        if (strictChronology && level && !prereqsMet(cert) && !isCiscoL1AssociateStarter(cert)) return false;
                        if (strictChronology && level && !stageFitsLevel(cert) && !isCiscoL1AssociateStarter(cert)) return false;
                        return true;
                    });
                }
            } else {
                filtered = active.filter(cert => {
                    if (cert.retired) return false;
                    if (level && strictChronology && !inLevelWindow(cert)) return false;
                    if (category && cert.category !== category) return false;
                    if (focus && cert.focus !== focus) return false;
                    if (trackSelections.length > 0) {
                        const ct = Array.isArray(cert.tracks) ? cert.tracks : [];
                        if (!ct.some(t => trackSelections.includes(t))) return false;
                    }
                    if (vendor && cert.vendor !== vendor) return false;
                    if (vendor && vendorArea) {
                        const areasRaw2 = Array.isArray(cert.vendor_area) ? cert.vendor_area : (cert.vendor_area ? [cert.vendor_area] : (cert.vendor==='Microsoft' && cert.solution_area ? [cert.solution_area] : []));
                        const filterKey2 = normArea(vendorArea);
                        const match2 = areasRaw2.some(a=> normArea(a) === filterKey2);
                        if (!match2) return false;
                    }
                    if (partnership === 'premium' && !cert.premium) return false;
                    if (partnership === 'standard' && cert.premium) return false;
                    if (search && !cert.name.toLowerCase().includes(search) && !cert.vendor.toLowerCase().includes(search) && !cert.focus.toLowerCase().includes(search)) return false;
                    if (strictChronology && level && !prereqsMet(cert) && !isCiscoL1AssociateStarter(cert)) return false; // only enforce prereqs when a level is selected (with Cisco L1 associate starters allowed)
                    // Apply stage-to-level mapping for all vendors when level is selected
                    if (strictChronology && level && !stageFitsLevel(cert) && !isCiscoL1AssociateStarter(cert)) return false;
                    return true;
                });
            }

            // Level 1 special case handled above; this section no longer needed

            // Determine locked previous selections and possible anchor vendor
            const lockedPrev = level ? getCumulativeSelection(level-1) : new Set();
            let anchorVendor = null;
            if (vendorAnchored && level) {
                const counts = {};
                lockedPrev.forEach(id => {
                    const found = certifications.find(c=>c.id===id);
                    if (found?.vendor) counts[found.vendor] = (counts[found.vendor]||0)+1;
                });
                const top = Object.entries(counts).sort((a,b)=>b[1]-a[1])[0];
                // Prefer explicit vendor if selected
                anchorVendor = vendor || (top ? top[0] : null);
            }

            // Eligible-only: constrain additions to anchorVendor, with fallback to ensure min requirements can be met
            // Exception: Cisco with strictChronology already rebuilt cumulative list above; skip anchoring to preserve it
            let preEligibleFiltered = filtered.slice();
            if (eligibleOnly && level && anchorVendor && !(strictChronology && vendor === 'Cisco' && level >= 1 && level <= 5)) {
                filtered = filtered.filter(c=>c.vendor===anchorVendor);
                // Fallback: if not enough options remain to satisfy the current level's minimum
                const { min } = levelRules[level] || { min: 0 };
                const cumulativeCount = getSelectedCount(level);
                const remainingNeeded = Math.max(0, min - cumulativeCount);
                const availableCandidates = filtered.filter(c=>!getCumulativeSelection(level).has(c.id)).length;
                if (remainingNeeded > 0 && availableCandidates < remainingNeeded) {
                    try {
                        const vendorName = vendor || anchorVendor || 'selected vendor';
                        const msg = (level===1 && vendor)
                          ? `Not enough ${vendorName} options to meet Level ${level} minimum selections. Keeping single-vendor view. Consider selecting additional vendors or clearing filters.`
                          : `Showing more options by relaxing anchoring (still honoring your filters) to help you meet Level ${level} minimum selections.`;
                        const bannerId = 'filterRelaxedNotice';
                        let banner = document.getElementById(bannerId);
                        if (!banner) {
                            banner = document.createElement('div');
                            banner.id = bannerId;
                            banner.style.cssText = 'margin:10px 0;padding:10px;border:1px solid #fde68a;background:#fffbeb;color:#92400e;border-radius:8px;';
                            const container = document.querySelector('.filter-section .container') || document.body;
                            container.insertBefore(banner, container.firstChild);
                        }
                        banner.textContent = msg;
                        setTimeout(()=>{ banner?.remove(); }, 6000);
                    } catch(_){ /* no-op */ }
                    // Behavior: Cisco L1-5 -> do NOT relax vendor (cumulative list already built); Others -> relax anchoring only
                    if (!(vendor === 'Cisco' && level >= 1 && level <= 5)) {
                        // Relax anchoring but keep previously applied vendor/filter constraints
                        filtered = preEligibleFiltered;
                    }
                }
            }
            // Secondary safety: if explicit vendor filter still leaves too few candidates to meet minimums, optionally relax vendor
            // Exception: Cisco L1-5 already has cumulative list, don't relax
            if (level && vendor && !(vendor === 'Cisco' && level >= 1 && level <= 5)) {
                const { min } = levelRules[level] || { min: 0 };
                const cumulativeCount = getSelectedCount(level);
                const remainingNeeded = Math.max(0, min - cumulativeCount);
                const availableCandidates = filtered.filter(c=>!getCumulativeSelection(level).has(c.id)).length;
                if (remainingNeeded > 0 && availableCandidates < remainingNeeded) {
                    const expanded = buildListIgnoringVendor();
                    if (expanded.length > filtered.length) {
                        filtered = expanded;
                        try {
                            const msg = `Showing more vendors (temporarily relaxed single-vendor filter) to help you meet Level ${level} minimum selections. You can re-apply vendor filter after meeting requirements.`;
                            const bannerId = 'filterRelaxedNotice';
                            let banner = document.getElementById(bannerId);
                            if (!banner) {
                                banner = document.createElement('div');
                                banner.id = bannerId;
                                banner.style.cssText = 'margin:10px 0;padding:10px;border:1px solid #fde68a;background:#fffbeb;color:#92400e;border-radius:8px;';
                                const container = document.querySelector('.filter-section .container') || document.body;
                                container.insertBefore(banner, container.firstChild);
                            }
                            banner.textContent = msg;
                            setTimeout(()=>{ banner?.remove(); }, 6000);
                        } catch(_){ /* no-op */ }
                    }
                }
            }
            // Always ensure locked previous selections are visible in results
            if (level) {
                const present = new Set(filtered.map(c=>c.id));
                lockedPrev.forEach(id => {
                    if (!present.has(id)){
                        const cc = certifications.find(c=>c.id===id);
                        if (cc) filtered.push(cc);
                    }
                });
            }

            // Guardrail: if remaining minimum cannot be met with current filters, suggest relax options
            try {
                const host = document.getElementById('certification-filtering');
                let banner = document.getElementById('relax-banner');
                if (banner) { banner.remove(); banner = null; }
                if (level) {
                    const { min } = levelRules[level] || { min: 0 };
                    const cumulativeCount = getSelectedCount(level);
                    const remainingNeeded = Math.max(0, min - cumulativeCount);
                    const availableCandidates = filtered.filter(c=>!getCumulativeSelection(level).has(c.id)).length;
                    const needHelp = remainingNeeded > 0 && availableCandidates < remainingNeeded;
                    if (needHelp && host) {
                        banner = document.createElement('div');
                        banner.id = 'relax-banner';
                        banner.style.margin = '0.75rem 0 0.5rem';
                        banner.style.padding = '0.75rem 1rem';
                        banner.style.border = '1px solid #fde68a';
                        banner.style.background = '#fffbeb';
                        banner.style.borderRadius = '12px';
                        banner.style.color = '#92400e';
                        const msg = document.createElement('div');
                        msg.textContent = `You need ${remainingNeeded} more for Level ${level}, but only ${availableCandidates} available with current filters.`;
                        const chips = document.createElement('div');
                        chips.style.marginTop = '0.5rem';
                        const makeChip = (label, onClick)=>{
                            const b = document.createElement('button');
                            b.type = 'button';
                            b.textContent = label;
                            b.style.marginRight = '0.5rem';
                            b.style.padding = '0.25rem 0.5rem';
                            b.style.border = '1px solid #e5e7eb';
                            b.style.borderRadius = '9999px';
                            b.style.background = '#fff';
                            b.style.cursor = 'pointer';
                            b.addEventListener('click', ()=>{ onClick(); setPage(1); applyFilters(); });
                            return b;
                        };
                        if (vendor) chips.appendChild(makeChip('Relax Vendor', ()=>{ const sel=document.getElementById('vendorFilter'); if (sel) sel.value=''; }));
                        if (vendorArea) chips.appendChild(makeChip('Clear Vendor Area', ()=>{ const sel=document.getElementById('vendorAreaFilter'); if (sel) sel.value=''; }));
                        if (partnership) chips.appendChild(makeChip('Clear Partnership', ()=>{ const sel=document.getElementById('partnershipFilter'); if (sel) sel.value=''; }));
                        const trackSel = document.getElementById('trackFilter');
                        if (trackSel && Array.from(trackSel.selectedOptions).length>0) chips.appendChild(makeChip('Clear Tracks', ()=>{ Array.from(trackSel.options).forEach(o=>o.selected=false); }));
                        const focusSel = document.getElementById('focusFilter');
                        if (focusSel && focusSel.value) chips.appendChild(makeChip('Clear Focus', ()=>{ focusSel.value=''; }));
                        banner.appendChild(msg);
                        banner.appendChild(chips);
                        host.insertBefore(banner, host.firstChild);
                    }
                }
            } catch(_) { /* no-op */ }

            // "Why these?" explainer for CompTIA levels and areas
            try {
                const explId = 'why-these-explainer';
                let expl = document.getElementById(explId);
                const shouldShowExpl = vendor === 'CompTIA' && !!level;
                if (shouldShowExpl) {
                    if (!expl) {
                        expl = document.createElement('div');
                        expl.id = explId;
                        expl.style.cssText = 'margin:8px 0 0; font-size:0.9rem; color:#475569;';
                        const host = document.getElementById('dynamic-results');
                        if (host && host.parentNode) host.parentNode.insertBefore(expl, host);
                    }
                    const area = document.getElementById('vendorAreaFilter')?.value || '';
                    const levelText = level === 1 ? 'Tech+, A+, Network+' : (level === 2 ? 'Tech+, A+, Network+, Security+' : (level === 3 ? 'Security+ with CySA+ or PenTest+; includes infra/data unless Area chosen' : (level === 4 ? 'Security+, CySA+ and PenTest+; infra optional' : 'SecurityX (master) with prior stack')));
                    const areaText = area ? ` â¢ Focus: ${area}` : '';
                    const trackHint = area ? '' : ' â¢ Tip: pick an Area (e.g., Cybersecurity (Defense), Offensive Cybersecurity, Infrastructure, Cloud, Data & Analytics) to focus results.';
                    const shownCount = Array.isArray(filtered) ? filtered.length : 0;
                    const rule = levelRules[level] || { min: undefined, max: undefined };
                    const goalText = (rule.min ? ` â¢ Goal: ${rule.min}${(rule.max && rule.max !== rule.min) ? '-' + rule.max : ''}` : '');
                    const countText = ` â¢ Showing ${shownCount}${goalText}`;
                    expl.innerHTML = `<a href="#" style="color:#2563eb; text-decoration:underline;">Why these?</a><span style='margin-left:6px;'>CompTIA Level ${level}: ${levelText}${areaText}${trackHint}${countText}</span>`;
                    // Show modal with full mapping
                    const link = expl.querySelector('a');
                    link.onclick = (e)=>{ e.preventDefault(); 
                        // Build curated target again for counts/breakdown
                        const norm = (s)=>{ const t=String(s||'').toLowerCase(); if (t.includes('offensive')) return 'Offensive Cybersecurity'; if (t.includes('defense') || t==='security' || t.includes('cybersecurity')) return 'Cybersecurity (Defense)'; if (t.includes('infra')) return 'Infrastructure'; if (t.includes('cloud')) return 'Cloud'; if (t.includes('data')) return 'Data & Analytics'; if (t.includes('xpert') || t.includes('expert')) return 'Xpert'; return s; };
                        const COMPTIA_PATHWAY = {
                            1: ['CompTIA Tech+','Foundation Certification','CompTIA Network+'],
                            2: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+'],
                            3: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+','CompTIA CySA+','CompTIA PenTest+','CompTIA Cloud+','CompTIA Server+','CompTIA Linux+','CompTIA Data+'],
                            4: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+','CompTIA CySA+','CompTIA PenTest+','CompTIA Cloud+','CompTIA Server+','CompTIA Linux+'],
                            5: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+','CompTIA CySA+','CompTIA PenTest+','CompTIA SecurityX']
                        };
                        const CORE_BY_LEVEL = {
                            1: ['CompTIA Tech+','Foundation Certification','CompTIA Network+'],
                            2: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+'],
                            3: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+'],
                            4: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+'],
                            5: ['CompTIA Tech+','Foundation Certification','CompTIA Network+','CompTIA Security+']
                        };
                        const AREA_EXTRAS_BY_LEVEL = {
                            3: {
                                'Cybersecurity (Defense)': ['CompTIA CySA+'],
                                'Offensive Cybersecurity': ['CompTIA PenTest+'],
                                'Infrastructure': ['CompTIA Server+','CompTIA Linux+'],
                                'Cloud': ['CompTIA Cloud+'],
                                'Data & Analytics': ['CompTIA Data+'],
                                'Xpert': []
                            },
                            4: {
                                'Cybersecurity (Defense)': ['CompTIA CySA+'],
                                'Offensive Cybersecurity': ['CompTIA PenTest+'],
                                'Infrastructure': ['CompTIA Server+','CompTIA Linux+'],
                                'Cloud': ['CompTIA Cloud+'],
                                'Data & Analytics': ['CompTIA Data+','CompTIA DataSys+'],
                                'Xpert': []
                            },
                            5: {
                                'Cybersecurity (Defense)': ['CompTIA CySA+','CompTIA SecurityX'],
                                'Offensive Cybersecurity': ['CompTIA PenTest+','CompTIA SecurityX'],
                                'Infrastructure': ['CompTIA Server+','CompTIA Linux+'],
                                'Cloud': ['CompTIA Cloud+','CompTIA CloudNetX'],
                                'Data & Analytics': ['CompTIA Data+','CompTIA DataSys+','CompTIA DataX'],
                                'Xpert': ['CompTIA SecurityX']
                            }
                        };
                        const areaKey = norm(area);
                        let curated = [...(COMPTIA_PATHWAY[level]||[])];
                        if (level >= 2 && areaKey) {
                            const core = CORE_BY_LEVEL[level] || CORE_BY_LEVEL[3] || [];
                            const extras = (AREA_EXTRAS_BY_LEVEL[level] && AREA_EXTRAS_BY_LEVEL[level][areaKey]) || [];
                            curated = Array.from(new Set([...(core||[]), ...extras]));
                        }
                        const curatedSet = new Set(curated);
                        const coreSet = new Set(CORE_BY_LEVEL[level] || []);
                        const isSpec = (n)=> n==='CompTIA CySA+' || n==='CompTIA PenTest+' || n==='CompTIA SecurityX';
                        let coreCount=0, specCount=0, optCount=0;
                        curated.forEach(n=>{ if (coreSet.has(n)) coreCount++; else if (isSpec(n)) specCount++; else optCount++; });
                        const curatedTargetCount = curated.length;
                        const countsSection = { heading: 'Counts & goals', points: [
                            `Curated target (before additional filters): ${curatedTargetCount}`,
                            `Currently showing: ${shownCount}`,
                            `Level ${level} goal: ${rule.min ? (rule.max && rule.max!==rule.min ? `${rule.min}-${rule.max}` : `${rule.min}`) : 'n/a'} certifications`,
                            `Breakdown: Core ${coreCount}${specCount?`, Specialization ${specCount}`:''}${optCount?`, Optional ${optCount}`:''}`
                        ].concat((rule.min && shownCount < rule.min) ? ['Hint: add more items or relax filters to meet the minimum.'] : []) };
                        // Build explicit grouped names list for beginners
                        const coreNames = curated.filter(n => coreSet.has(n));
                        const specNames = curated.filter(n => !coreSet.has(n) && isSpec(n));
                        const optNames = curated.filter(n => !coreSet.has(n) && !isSpec(n));
                        const fmt = (arr)=> arr && arr.length ? arr.join(', ') : 'â';
                        const whatsIncludedSection = { heading: "What's included", points: [
                            `Core: ${fmt(coreNames)}`,
                            `Specialization: ${fmt(specNames)}`,
                            `Optional: ${fmt(optNames)}`
                        ] };
                        openInfoModal({
                        title: `Why these (CompTIA â¢ Level ${level})`,
                        meta: [['Vendor','CompTIA'],['Level', String(level)]],
                        sections: [
                            countsSection,
                            whatsIncludedSection,
                            { heading: 'Pathway Logic', points: [
                                'L1: Tech+, A+, Network+',
                                'L2: Tech+, A+, Network+, Security+',
                                'L3: Security+ with CySA+ (Defense) or PenTest+ (Offensive); includes Cloud+/Server+/Linux+/Data+ unless an Area is selected',
                                'L4: Defense + Offensive (CySA+ and PenTest+); infra options available',
                                'L5: SecurityX (Xpert)'] },
                            { heading: 'Areas & Tracks', points: [
                                'Cybersecurity (Defense): Security+, CySA+',
                                'Offensive Cybersecurity: PenTest+',
                                'Infrastructure: A+, Network+, Server+, Linux+',
                                'Cloud: Cloud+, CloudNetX (when present)',
                                'Data & Analytics: Data+, DataSys+, DataX (when present)',
                                'Xpert: SecurityX'] },
                            { heading: 'How to choose', points: [
                                'New to security? Start with Security+; then choose CySA+ (Defense) or PenTest+ (Offensive).',
                                'Prefer systems/ops? Focus Infrastructure (Server+/Linux+) and optionally Cloud+.',
                                'Interested in data? Pick Data+ / DataSys+; advance toward DataX when available.',
                                'Not sure yet? Keep Area empty at L3 to see mixed options, then refine.'] }
                        ],
                        chips: ['CompTIA','Guided Pathways','Areas available']
                    }); };
                } else if (expl) { expl.remove(); }
            } catch(_) {}

            // Relevance boost: If Level 1 and vendor is CompTIA or anchored to CompTIA, prioritize Tech+, A+, Network+
            if (level === 1 && (vendor === 'CompTIA' || anchorVendor === 'CompTIA')) {
                const preferred = new Set(['CompTIA Tech+','Foundation Certification','CompTIA Network+']);
                filtered.sort((a,b)=>{
                    const av = preferred.has(a.name) ? 1 : 0;
                    const bv = preferred.has(b.name) ? 1 : 0;
                    if (av !== bv) return bv - av; // preferred first
                    return 0;
                });
            }

            // Ranking: compute relevance score when recommendedFirst is enabled
            if (recommendedFirst) {
                const anchor = anchorVendor || vendor || null;
                const selectedTracks = trackSelections;
                const normalize = (x)=>Math.max(0, Math.min(1, Number(x)||0));
                // Tunable thresholds for reason surfacing
                const SALARY_REASON_THRESHOLD = 0.68;
                const DEMAND_REASON_THRESHOLD = 0.62;
                const FAST_TIME_MONTHS = 3;
                const weights = (lvl)=>({
                    wVendor: lvl<=2 ? 0.25 : 0.2,
                    wLevel: 0.25,
                    wNeutral: lvl===1 ? 0.35 : (lvl===2 ? 0.15 : 0.05),
                    wTrack: 0.25,
                    wPrereq: 0.4,
                    wSynergy: 0.15,
                    wArea: 0.2,
                    wTime: 0.1,
                    wSalary: 0.1,
                    wDemand: 0.1,
                    wSearch: search ? 0.15 : 0
                });
                const W = weights(level||1);
                const priorCerts = certifications.filter(c=>prior.has(c.id));
                const priorVendors = new Set(priorCerts.map(c=>c.vendor));
                const priorTracks = new Set(priorCerts.flatMap(c=>c.tracks||[]));
                const score = (c)=>{
                    const reasons = [];
                    const V = anchor ? (c.vendor===anchor?1:0) : 0.5;
                    if (anchor && c.vendor===anchor) reasons.push('Matches your vendor choice');
                    const L = inLevelWindow(c) ? 1 : 0;
                    if (L) reasons.push('Aligned to your Level choice');
                    const N = c.neutral ? 1 : 0;
                    if (level===1 && c.neutral) reasons.push('Vendor-neutral foundation (great for Level 1)');
                    let T = ((c.tracks||[]).some(t=>priorTracks.has(t))?0.7:0.5);
                    if (selectedTracks.length>0) {
                        const anySel = (c.tracks||[]).some(t=>selectedTracks.includes(t));
                        T = anySel ? 1 : 0.2;
                        if (anySel) reasons.push('Matches your selected track(s)');
                    } else if ((c.tracks||[]).some(t=>priorTracks.has(t))) {
                        reasons.push('Builds on your prior track(s)');
                    }
                    const R = prereqsMet(c) ? 1 : 0;
                    if (R) reasons.push('Prerequisites satisfied');
                    const Y = (priorVendors.has(c.vendor)?0.5:0) + ((c.tracks||[]).some(t=>priorTracks.has(t))?0.5:0);
                    if (priorVendors.has(c.vendor)) reasons.push('Builds on your previous vendor');
                    if ((c.tracks||[]).some(t=>priorTracks.has(t))) reasons.push('Builds on your previous track(s)');
                    const A = vendor ? (()=>{ const areasRaw = Array.isArray(c.vendor_area) ? c.vendor_area : (c.vendor_area ? [c.vendor_area] : (c.vendor==='Microsoft' && c.solution_area ? [c.solution_area] : [])); if (!vendorArea) return (areasRaw.length?0.7:0.5); const filterKey = normArea(vendorArea); return areasRaw.some(a=> normArea(a)===filterKey) ? 1 : 0; })() : 0.5;
                    if (vendor && vendorArea) {
                        const areasRaw = Array.isArray(c.vendor_area) ? c.vendor_area : (c.vendor_area ? [c.vendor_area] : (c.vendor==='Microsoft' && c.solution_area ? [c.solution_area] : []));
                        const filterKey = normArea(vendorArea);
                        if (areasRaw.some(a=> normArea(a)===filterKey)) reasons.push('Matches your selected vendor area');
                    }
                    const H = 1 - Math.min(1, (Number(c.time_estimate_months)||2)/8);
                    if ((Number(c.time_estimate_months)||0) > 0) {
                        const months = Number(c.time_estimate_months);
                        if (months <= FAST_TIME_MONTHS) reasons.push('Quick to complete (~' + months + ' mo)');
                    }
                    const M = normalize(c.salary_index);
                    if (M >= SALARY_REASON_THRESHOLD) reasons.push('Strong salary outlook');
                    const D = normalize(c.popularity);
                    if (D >= DEMAND_REASON_THRESHOLD) reasons.push('Strong market demand');
                    const Q = search ? (c.name.toLowerCase().includes(search) ? 1 : 0) : 0;
                    if (Q) reasons.push('Matches your search');
                    const S = c.vendor_stage ? (/Fundamental|Foundational/i.test(c.vendor_stage) ? (level===1?1:0.6) : /Associate/i.test(c.vendor_stage) ? (level<=2?0.9:0.6) : /Professional|Expert|Specialty/i.test(c.vendor_stage) ? (level>=3?1:0.3) : 0.5) : 0.5;
                    if (S >= 0.9) reasons.push('Certification stage matches your Level');
                    // Fine-grained surfacing boost for Security-focused tracks/solution areas (Microsoft/Fortinet)
                    let B = 0;
                    if (c.vendor === 'Microsoft') {
                        const sec = (c.solution_area && /security/i.test(String(c.solution_area))) || (Array.isArray(c.tracks) && c.tracks.some(t=>/security/i.test(String(t))));
                        if (sec) { B += 0.06; reasons.push('Security solution area'); }
                    }
                    if (c.vendor === 'Fortinet') {
                        const nameSec = /ztna|sase|secure\s*(email|web)/i.test(String(c.name||''));
                        const trackSec = Array.isArray(c.tracks) && c.tracks.some(t=>/security|ztna|sase|email|web/i.test(String(t)));
                        const catSec = /security/i.test(String(c.category||''));
                        if (nameSec || trackSec || catSec) { B += 0.06; reasons.push('Security specialization'); }
                    }
                    const raw = W.wVendor*V + W.wLevel*L + W.wNeutral*N + W.wTrack*T + W.wPrereq*R + W.wSynergy*Y + W.wArea*A + W.wTime*H + W.wSalary*M + W.wDemand*D + W.wSearch*Q + 0.15*S + B;
                    return { raw, reasons };
                };
                const scored = filtered.map(c=>{ const {raw,reasons} = score(c); return { c, s: raw, r: Array.from(new Set(reasons)) }; });
                scored.sort((a,b)=>b.s-a.s);
                filtered = scored.map(x=>{ x.c._why = x.r; return x.c; });
            } else {
                // Clear any previous why reasons when not ranking by recommendations
                filtered.forEach(c=>{ if (c._why) delete c._why; });
            }

            // Sorting
            const collator = new Intl.Collator('en', { sensitivity: 'base' });
            const sorters = {
                'name-asc': (a,b)=>collator.compare(a.name,b.name),
                'name-desc': (a,b)=>collator.compare(b.name,a.name),
                'level-asc': (a,b)=>a.level-b.level || collator.compare(a.name,b.name),
                'level-desc': (a,b)=>b.level-a.level || collator.compare(a.name,b.name),
                'vendor-asc': (a,b)=>collator.compare(a.vendor,b.vendor) || collator.compare(a.name,b.name),
                'vendor-desc': (a,b)=>collator.compare(b.vendor,a.vendor) || collator.compare(a.name,b.name),
                'salary-desc': (a,b)=>(estimateSalary(b)||0) - (estimateSalary(a)||0) || collator.compare(a.name,b.name),
                'salary-asc': (a,b)=>(estimateSalary(a)||0) - (estimateSalary(b)||0) || collator.compare(a.name,b.name),
                'demand-desc': (a,b)=>(Number(b.popularity)||0) - (Number(a.popularity)||0) || collator.compare(a.name,b.name),
                'demand-asc': (a,b)=>(Number(a.popularity)||0) - (Number(b.popularity)||0) || collator.compare(a.name,b.name),
            };
            if (sort !== 'relevance' && sorters[sort]) filtered = filtered.sort(sorters[sort]);

            // Save filters to URL
            try {
                const params = new URLSearchParams();
                if (level) params.set('level', String(level));
                if (category) params.set('category', category);
                if (focus) params.set('focus', focus);
                if (trackSelections.length>0) params.set('tracks', trackSelections.join('|'));
                if (vendor) params.set('vendor', vendor);
                if (vendor && vendorArea) params.set('varea', vendorArea);
                if (partnership) params.set('partner', partnership);
                if (search) params.set('q', search);
                if (sort && sort !== 'level-asc') params.set('sort', sort);
                const newUrl = `${location.pathname}?${params.toString()}`;
                history.replaceState(null, '', newUrl);
            } catch (_) {}

            // Render compact results summary
            try {
                const summaryEl = document.getElementById('results-summary');
                if (summaryEl) {
                    summaryEl.textContent = `${filtered.length} result${filtered.length===1?'':'s'} â¢ ${active.length} active total`;
                }
            } catch(_) {}

            // L1 guidance strip and associate allowance explainer
            try {
                const el = document.getElementById('l1-guidance');
                if (el) {
                    if (level === 1) {
                        // Count selected by stage type
                        const prior = getCumulativeSelection(0); // empty
                        const l1Sel = selectedByLevel[1] || new Set();
                        const l1Certs = certifications.filter(c=>l1Sel.has(c.id));
                        const isFound = c=>/Fundamental|Foundational/i.test(String(c.vendor_stage||''));
                        const isAssoc = c=>/Associate|Administrator|Developer/i.test(String(c.vendor_stage||''));
                        const foundCount = l1Certs.filter(isFound).length;
                        const assocCount = l1Certs.filter(isAssoc).length;
                        const assocLimit = 2;
                        el.style.display = '';
                        el.innerHTML = `
                            <div style="border:1px solid #c7d2fe;background:#eef2ff;color:#1e3a8a;border-radius:10px;padding:10px 12px;display:flex;gap:10px;align-items:flex-start;">
                                <i class="fas fa-graduation-cap" style="margin-top:2px;"></i>
                                <div style="flex:1;">
                                    <div style="font-weight:700; margin-bottom:4px;">Level 1 Guidance</div>
                                    <div>Pick 3 certifications: 1â2 Foundational and up to ${assocLimit} Associate.</div>
                                    <div style="margin-top:4px;color:#334155;">Selected so far â Foundational: <strong>${foundCount}</strong>, Associate: <strong>${assocCount}</strong>.</div>
                                </div>
                                <button id="l1WhatBtn" class="btn-secondary" style="white-space:nowrap;">Whatâs this?</button>
                            </div>
                        `;
                        el.querySelector('#l1WhatBtn')?.addEventListener('click', ()=>{
                            openInfoModal({
                                title: 'Level 1 Associate Allowance',
                                sections: [
                                    { heading: 'How Level 1 Works', points: [
                                        'Choose 3 total certifications',
                                        'Include 2 Foundational items to build core skills',
                                        'Include up to 1 Associate-level item (within your selected vendor) to accelerate momentum'
                                    ] },
                                    { heading: 'Why Allow 1 Associate at L1?', points: [
                                        'Early exposure to vendor ecosystems boosts motivation and alignment',
                                        'Pairs practical vendor skills with strong fundamentals',
                                        'Limits avoid overreach and maintain progression hygiene'
                                    ] }
                                ]
                            });
                        }, { once: true });
                    } else {
                        el.style.display = 'none'; el.innerHTML = '';
                    }
                }
            } catch(_) {}

            // Cisco Level 1 starter hint: surface CCST/CCT before Associates
            try {
                const vendorVal = document.getElementById('vendorFilter')?.value || '';
                const levelVal = parseInt(document.getElementById('levelFilter')?.value);
                const hintId = 'ciscoL1Hint';
                let banner = document.getElementById(hintId);
                if (vendorVal === 'Cisco' && levelVal === 1) {
                    if (!banner) {
                        banner = document.createElement('div');
                        banner.id = hintId;
                        banner.style.cssText = 'margin:10px auto;max-width:var(--container-max);padding:10px 12px;border:1px solid #bfdbfe;background:#eff6ff;color:#1e3a8a;border-radius:10px;display:flex;gap:10px;align-items:flex-start;';
                        const container = document.querySelector('.filter-section .container');
                        const anchor = document.getElementById('results-summary');
                        if (container && anchor) container.insertBefore(banner, anchor.nextSibling);
                    }
                    banner.innerHTML = `
                        <i class="fas fa-network-wired" style="margin-top:2px;color:#1d4ed8;"></i>
                        <div style="flex:1;">
                            <div style="font-weight:700; margin-bottom:4px;">Cisco Level 1: Start with Foundational + 1 Associate</div>
                            <div>Begin with these entry certifications, and add any one Associate (prefer CCNA for broad networking fundamentals and employer recognition):</div>
                            <ul style="margin:6px 0 0 18px; color:#334155;">
                                <li>Cisco Certified Support Technician (CCST) Networking</li>
                                <li>Cisco CCST Cybersecurity</li>
                                <li>Cisco Certified Technician (CCT) Routing & Switching</li>
                                <li>Cisco CCT Data Center (DCTECH)</li>
                            </ul>
                        </div>
                        <div style="font-size:12px; color:#1f3b58; margin-top:6px;">Associates to consider now: CCNA, CyberOps Associate, DevNet Associate</div>
                        <button id="ciscoWhyOrderBtn" class="btn-secondary" style="white-space:nowrap;">Why this order?</button>
                    `;
                    banner.querySelector('#ciscoWhyOrderBtn')?.addEventListener('click', ()=>{
                        openInfoModal({
                            title: 'Cisco at Level 1 â 2F + 1A Recommendation',
                            sections: [
                                { heading: 'Recommended Mix', points: [
                                    'Choose 2 Foundational (CCST/CCT) + 1 Associate to meet the value target (~$8,100)',
                                    'Associates to consider: CCNA (preferred), CyberOps Associate, DevNet Associate'
                                ]},
                                { heading: 'Why CCNA first?', points: [
                                    'Broad networking fundamentals that strengthen all Cisco paths',
                                    'High employer recognition and job relevance',
                                    'Pairs well with CCST/CCT for a balanced L1 portfolio'
                                ]},
                                { heading: 'Notes', points: [
                                    'We still enforce chronological sorting: Foundational items appear first with Level â',
                                    'If you focus on security or software, CyberOps or DevNet Associate can be your one Associate at L1'
                                ]}
                            ],
                            chips: ['Cisco','Level 1','2F + 1A']
                        });
                    }, { once: true });
                } else {
                    document.getElementById(hintId)?.remove();
                }
            } catch(_) {}

            // Cisco Level 2â5 guidance banners to maintain consistent hints across levels
            try {
                const vendorVal = document.getElementById('vendorFilter')?.value || '';
                const levelVal = parseInt(document.getElementById('levelFilter')?.value);
                // Emit a brief diagnostic to confirm policy in effect (throttled by vendor+level)
                try {
                    const vNorm = normVendor(vendorVal);
                    const pol = (VENDOR_POLICY[vNorm] || VENDOR_POLICY.default)[levelVal];
                    if (vNorm && levelVal && pol && !window.__lastPolicyLog) {
                        console.log('Vendor policy in effect:', { vendor: vNorm, level: levelVal, allowedStages: pol });
                        window.__lastPolicyLog = `${vNorm}:${levelVal}`;
                        setTimeout(()=>{ window.__lastPolicyLog = null; }, 1500);
                    }
                } catch(_){/* no-op */}
                const strict = !!document.getElementById('toggleStrictChronology')?.checked;
                // Aggregation helper (memoized per apply cycle) to build cumulative Cisco stage lists
                const buildCiscoStageLists = ()=>{
                    const cacheKey = '__ciscoStageCache';
                    if (window[cacheKey]) return window[cacheKey];
                    const isFoundational = (c)=> /Fundamental|Foundational/i.test(String(c.vendor_stage || inferVendorStage(c)));
                    const isAssociate = (c)=> /Associate|Administrator|Developer/i.test(String(c.vendor_stage || inferVendorStage(c)));
                    const isProfessional = (c)=> /Professional/i.test(String(c.vendor_stage || inferVendorStage(c)));
                    const isExpert = (c)=> /Expert/i.test(String(c.vendor_stage || inferVendorStage(c)));
                    const ciscoActive = certifications.filter(c=>!c.retired && c.vendor==='Cisco');
                    const foundations = ciscoActive.filter(isFoundational).sort((a,b)=>String(a.name).localeCompare(b.name));
                    // Associates: include level exception associates (CCNA, CyberOps, DevNet) plus any other Associate items present
                    const associatesAll = ciscoActive.filter(isAssociate).sort((a,b)=>String(a.name).localeCompare(b.name));
                    const professionalsAll = ciscoActive.filter(isProfessional).sort((a,b)=>String(a.name).localeCompare(b.name));
                    const expertsAll = ciscoActive.filter(isExpert).sort((a,b)=>String(a.name).localeCompare(b.name));
                    const out = { foundations, associatesAll, professionalsAll, expertsAll };
                    window[cacheKey] = out; return out;
                };
                const stageLists = buildCiscoStageLists();
                const selectedPrev = levelVal ? getCumulativeSelection(levelVal) : new Set();
                const selCerts = certifications.filter(c=>selectedPrev.has(c.id) && c.vendor==='Cisco');
                const countBy = (pred)=> selCerts.filter(pred).length;
                const isFound = (c)=> /Fundamental|Foundational/i.test(String(c.vendor_stage||inferVendorStage(c)));
                const isAssoc = (c)=> /Associate|Administrator|Developer/i.test(String(c.vendor_stage||inferVendorStage(c)));
                const isProf = (c)=> /Professional/i.test(String(c.vendor_stage||inferVendorStage(c)));
                const isExp = (c)=> /Expert/i.test(String(c.vendor_stage||inferVendorStage(c)));
                const selFound = countBy(isFound), selAssoc = countBy(isAssoc), selProf = countBy(isProf), selExp = countBy(isExp);
                const levelRule = levelRules[levelVal] || { min:0, max:0 };
                const unmetSummary = ()=>{
                    if (!levelVal) return '';
                    const parts = [];
                    if (levelVal===2) {
                        // Recommend 1-2 associates total (already cumulative) â ensure at least 1 associate chosen
                        if (selAssoc < 2) parts.push(`Add ${2-selAssoc} more Associate${(2-selAssoc)===1?'':'s'} (target 2)`);
                    } else if (levelVal===3) {
                        if (selProf < 1) parts.push('Select a CCNP core (Professional)');
                        if (selAssoc < 2) parts.push('Ensure at least 2 Associates');
                    } else if (levelVal===4) {
                        if (selProf < 2) parts.push('Add a CCNP concentration (2nd Professional)');
                    } else if (levelVal===5) {
                        if (selExp < 1) parts.push('Consider an Expert-aligned selection');
                    }
                    return parts.length ? ` â¢ Next: ${parts.join('; ')}` : '';
                };
                const idMap = {
                    2: 'ciscoL2Hint',
                    3: 'ciscoL3Hint',
                    4: 'ciscoL4Hint',
                    5: 'ciscoL5Hint'
                };
                Object.entries(idMap).forEach(([lvlKey, id])=>{
                    const lvl = Number(lvlKey);
                    if (!(vendorVal === 'Cisco' && levelVal === lvl && strict)) { document.getElementById(id)?.remove(); return; }
                    let b = document.getElementById(id);
                    if (!b) {
                        b = document.createElement('div');
                        b.id = id;
                        b.style.cssText = 'margin:10px auto;max-width:var(--container-max);padding:10px 12px;border:1px solid #c7d2fe;background:#eef2ff;color:#1e3a8a;border-radius:10px;display:flex;gap:10px;align-items:flex-start;';
                        const container = document.querySelector('.filter-section .container');
                        const anchor = document.getElementById('results-summary');
                        if (container && anchor) container.insertBefore(b, anchor.nextSibling);
                    }
                    const common = (()=>{
                        const parts = [
                            `Foundations (${stageLists.foundations.length})`,
                            `Associates (${stageLists.associatesAll.length})`
                        ];
                        if (lvl>=3) parts.push(`Professional (${stageLists.professionalsAll.length})`);
                        if (lvl>=5) parts.push(`Expert (${stageLists.expertsAll.length})`);
                        const selParts = [
                            `F ${selFound}`,
                            `A ${selAssoc}`
                        ];
                        if (lvl>=3) selParts.push(`P ${selProf}`);
                        if (lvl>=5) selParts.push(`E ${selExp}`);
                        return `<div style=\"font-size:12px; color:#1f3b58; margin-top:6px;\">Cumulative view: ${parts.join(', ')}. Selected so far: ${selParts.join(', ')}${unmetSummary()}</div>`;
                    })();
                    const makeBtns = (lvl)=>{
                        return `<div style='display:flex;gap:6px;margin-top:6px;flex-wrap:wrap;'>
                            <button type='button' class='btn-secondary' style='padding:4px 8px;font-size:12px;' data-cwhy='${lvl}'>Why this order?</button>
                            <button type='button' class='btn-secondary' style='padding:4px 8px;font-size:12px;' data-cfull='${lvl}'>Full list</button>
                        </div>`;
                    };
                    const attachHandlers = (host)=>{
                        // Order rationale
                        host.querySelectorAll('button[data-cwhy]')?.forEach(btn=>{
                            btn.onclick = ()=>{
                                const L = Number(btn.getAttribute('data-cwhy'));
                                const rationale = {
                                    2: ['Finish Associate layer for breadth before diving into CCNP core.', 'Multiple associates strengthen core selection value.'],
                                    3: ['Select a single CCNP core aligned to your track.', 'Professional-tier introduces advanced depthâensure associates are locked first.'],
                                    4: ['Add a concentration to deepen specialization (2nd Professional).', 'This sets foundation for Expert prep.'],
                                    5: ['Capstone: align with CCIE domain focus or automation/design depth.', 'Ensure earlier Professional core + concentration are in place.']
                                }[L]||[];
                                openInfoModal({
                                    title:`Cisco Level ${L} â¢ Order Rationale`,
                                    meta:[['Level',String(L)],['Strict Chronology','Yes']],
                                    sections:[{heading:'Why this order', points:rationale},{heading:'Progress Snapshot', points:[`Foundational selected: ${selFound}/${stageLists.foundations.length}`, `Associates selected: ${selAssoc}/${stageLists.associatesAll.length}`, L>=3?`Professional selected: ${selProf}/${stageLists.professionalsAll.length}`:'', L>=5?`Expert selected: ${selExp}/${stageLists.expertsAll.length}`:''].filter(Boolean)}],
                                    chips:['Cisco','Chronology','Guidance']
                                });
                            };
                        });
                        // Full list modal
                        host.querySelectorAll('button[data-cfull]')?.forEach(btn=>{
                            btn.onclick = ()=>{
                                const L = Number(btn.getAttribute('data-cfull'));
                                const sections = [];
                                const fmt = (arr)=> arr.length ? arr.map(c=>c.name).join(', ') : 'â';
                                sections.push({ heading: 'Foundational', points:[fmt(stageLists.foundations)]});
                                sections.push({ heading: 'Associates', points:[fmt(stageLists.associatesAll)]});
                                if (L>=3) sections.push({ heading: 'Professional (Level 3 add-ons)', points:[fmt(stageLists.professionalsAll)]});
                                if (L>=5) sections.push({ heading: 'Expert (Level 5 capstone)', points:[fmt(stageLists.expertsAll)]});
                                sections.push({ heading: 'Your Progress', points:[`Foundational: ${selFound}`, `Associates: ${selAssoc}`, L>=3?`Professional: ${selProf}`:'', L>=5?`Expert: ${selExp}`:''].filter(Boolean)});
                                if (L>=3) sections.push({ heading: 'Next Suggestions', points: unmetSummary().replace(/^ \u2022 Next: /,'').split('; ').filter(Boolean)});
                                openInfoModal({
                                    title:`Cisco Level ${L} â¢ Cumulative List`,
                                    meta:[['Level',String(L)],['View','Cumulative'],['Strict Chronology','Yes']],
                                    sections:sections,
                                    chips:['Cisco','Cumulative','Full List']
                                });
                            };
                        });
                    };
                    if (lvl === 2) {
                        b.innerHTML = `
                            <i class="fas fa-network-wired" style="margin-top:2px;color:#1d4ed8;"></i>
                            <div style="flex:1;">
                                <div style="font-weight:700; margin-bottom:4px;">Cisco Level 2: Consolidate Associates</div>
                                <div>Lock in a strong Associate portfolio. Aim for 2 Associates total (e.g., CCNA + CyberOps or DevNet) before progressing to Professional at Level 3.</div>
                                ${makeBtns(lvl)}
                            </div>
                            ${common}
                        `;
                        attachHandlers(b);
                    } else if (lvl === 3) {
                        b.innerHTML = `
                            <i class="fas fa-medal" style="margin-top:2px;color:#1d4ed8;"></i>
                            <div style="flex:1;">
                                <div style="font-weight:700; margin-bottom:4px;">Cisco Level 3: Choose a Professional Core</div>
                                <div>Select your CCNP core (ENCOR, SCOR, DCCOR, CLCOR, SPCOR, DEVCOR). Ensure Associates are complete to maximize success.</div>
                                ${makeBtns(lvl)}
                            </div>
                            ${common}
                        `;
                        attachHandlers(b);
                    } else if (lvl === 4) {
                        b.innerHTML = `
                            <i class="fas fa-layer-group" style="margin-top:2px;color:#1d4ed8;"></i>
                            <div style="flex:1;">
                                <div style="font-weight:700; margin-bottom:4px;">Cisco Level 4: Add a CCNP Concentration</div>
                                <div>Add a concentration (e.g., ENARSI, SECOPS, ISE, automation) to deepen specialization. This sets trajectory for Expert.</div>
                                ${makeBtns(lvl)}
                            </div>
                            ${common}
                        `;
                        attachHandlers(b);
                    } else if (lvl === 5) {
                        b.innerHTML = `
                            <i class="fas fa-chess-king" style="margin-top:2px;color:#1d4ed8;"></i>
                            <div style="flex:1;">
                                <div style="font-weight:700; margin-bottom:4px;">Cisco Level 5: Capstone toward Expert</div>
                                <div>Finalize with Expert-aligned prep (CCIE domain focus, advanced automation/design). Validate earlier Professional core + concentration.</div>
                                ${makeBtns(lvl)}
                            </div>
                            ${common}
                        `;
                        attachHandlers(b);
                    }
                });
            } catch(_) {}

            // AWS Level 1â5 guidance banners
            try {
                const vendorVal = document.getElementById('vendorFilter')?.value || '';
                const levelVal = parseInt(document.getElementById('levelFilter')?.value);
                const idMap = { 1:'awsL1', 2:'awsL2', 3:'awsL3', 4:'awsL4', 5:'awsL5' };
                Object.entries(idMap).forEach(([lvlKey, id])=>{
                    const lvl = Number(lvlKey);
                    if (!(vendorVal === 'AWS' && levelVal === lvl)) { document.getElementById(id)?.remove(); return; }
                    let b = document.getElementById(id);
                    if (!b) {
                        b = document.createElement('div'); b.id = id;
                        b.style.cssText = 'margin:10px auto;max-width:var(--container-max);padding:10px 12px;border:1px solid #c7d2fe;background:#eef2ff;color:#1e3a8a;border-radius:10px;display:flex;gap:10px;align-items:flex-start;';
                        const container = document.querySelector('.filter-section .container');
                        const anchor = document.getElementById('results-summary');
                        if (container && anchor) container.insertBefore(b, anchor.nextSibling);
                    }
                    const common = `<div style="font-size:12px; color:#1f3b58; margin-top:6px;">Level ${lvl} is cumulative â earlier AWS foundations remain.</div>`;
                    const map = {
                        1: ['Start with Entry Level Certification (CLF-C02) and consider 1 Associate (SAA/DVA/SOA) if ready.'],
                        2: ['Ensure an Associate (Solutions Architect or Developer/ SysOps) to cement fundamentals.'],
                        3: ['Target a Professional core (Solutions Architect Professional or DevOps Professional).'],
                        4: ['Add a Specialty aligned to your track (Security, Data, Networking, Machine Learning, etc.).'],
                        5: ['Capstone: deepen Specialty or complete the professional pair for your role path.']
                    };
                    b.innerHTML = `<i class='fas fa-cloud' style='margin-top:2px;color:#1d4ed8;'></i><div style='flex:1;'><div style='font-weight:700;margin-bottom:4px;'>AWS Level ${lvl}</div><div>${(map[lvl]||[]).join(' ')}</div></div>${common}`;
                });
            } catch(_) {}

            // Microsoft Level 1â5 guidance banners
            try {
                const vendorVal = document.getElementById('vendorFilter')?.value || '';
                const levelVal = parseInt(document.getElementById('levelFilter')?.value);
                const idMap = { 1:'msL1', 2:'msL2', 3:'msL3', 4:'msL4', 5:'msL5' };
                Object.entries(idMap).forEach(([lvlKey, id])=>{
                    const lvl = Number(lvlKey);
                    if (!(vendorVal === 'Microsoft' && levelVal === lvl)) { document.getElementById(id)?.remove(); return; }
                    let b = document.getElementById(id);
                    if (!b) {
                        b = document.createElement('div'); b.id = id;
                        b.style.cssText = 'margin:10px auto;max-width:var(--container-max);padding:10px 12px;border:1px solid #c7d2fe;background:#eef2ff;color:#1e3a8a;border-radius:10px;display:flex;gap:10px;align-items:flex-start;';
                        const container = document.querySelector('.filter-section .container');
                        const anchor = document.getElementById('results-summary');
                        if (container && anchor) container.insertBefore(b, anchor.nextSibling);
                    }
                    const common = `<div style=\"font-size:12px; color:#1f3b58; margin-top:6px;\">Level ${lvl} is cumulative â earlier Microsoft fundamentals remain.</div>`;
                    const map = {
                        1: ['Pick 1â2 Fundamentals (AZ-900, SC-900, DP-900, AI-900) + up to 1 Associate (e.g., AZ-104, SC-200/300, AZ-204).'],
                        2: ['Solidify Associate in your role (AZ-104 admin, SC-200 SOC, SC-300 ID, AZ-204 dev).'],
                        3: ['Advance to your primary role (security, data, devops, admin).'],
                        4: ['Add AZ-305 (architect) if cloud infra path; security/data add relevant pro-level role.'],
                        5: ['Capstone: cross-domain enhancement (security+cloud, data+infra, dev+platform).']
                    };
                    b.innerHTML = `<i class='fas fa-windows' style='margin-top:2px;color:#1d4ed8;'></i><div style='flex:1;'><div style='font-weight:700;margin-bottom:4px;'>Microsoft Level ${lvl}</div><div>${(map[lvl]||[]).join(' ')}</div></div>${common}`;
                });
            } catch(_) {}

            // Render active filter chips with quick clear
            try {
                const chipsHost = document.getElementById('active-filter-chips');
                if (chipsHost) {
                    const chips = [];
                    if (level) chips.push({k:'level', label:`Level ${level}`, clear:()=>{ document.getElementById('levelFilter').value=''; }});
                    if (category) chips.push({k:'category', label:(categoryLabelMap[category]||category), clear:()=>{ document.getElementById('categoryFilter').value=''; }});
                    if (focus) chips.push({k:'focus', label:focus, clear:()=>{ document.getElementById('focusFilter').value=''; }});
                    if (trackSelections.length) chips.push({k:'tracks', label:`Tracks (${trackSelections.length})`, clear:()=>{ const el=document.getElementById('trackFilter'); Array.from(el.options).forEach(o=>o.selected=false); }});
                    if (vendor) chips.push({k:'vendor', label:vendor, clear:()=>{ document.getElementById('vendorFilter').value=''; document.getElementById('vendorAreaFilter').value=''; rebuildVendorAreaOptions(); }});
                    if (vendor && vendorArea) chips.push({k:'varea', label:vendorArea, clear:()=>{ document.getElementById('vendorAreaFilter').value=''; }});
                    if (partnership) chips.push({k:'partner', label:partnership==='premium'?'Premium':'Standard', clear:()=>{ document.getElementById('partnershipFilter').value=''; }});
                    if (search) chips.push({k:'q', label:`Search: ${search}`, clear:()=>{ const si=document.querySelector('.search-input'); if (si) si.value=''; }});
                    chipsHost.innerHTML = '';
                    chips.forEach(ch => {
                        const div = document.createElement('div');
                        div.className = 'filter-chip';
                        div.innerHTML = `<span>${ch.label}</span><button aria-label="Clear">Ã</button>`;
                        div.querySelector('button').addEventListener('click', ()=>{ ch.clear(); setPage(1); applyFilters(); });
                        chipsHost.appendChild(div);
                    });
                }
            } catch(_) {}

            // L2 prerequisite guidance banners for Programming, Security, and Cloud Architect paths
            try {
                const levelVal = parseInt(document.getElementById('levelFilter').value);
                const strict = !!document.getElementById('toggleStrictChronology')?.checked;
                const catVal = document.getElementById('categoryFilter').value;
                const focusVal = document.getElementById('focusFilter').value;
                const vendorVal = document.getElementById('vendorFilter').value;
                const priorCerts = certifications.filter(c=>prior.has(c.id));
                const priorTags = new Set(priorCerts.flatMap(c=>c.tags||[]));
                const hasProgFund = priorTags.has('Programming-Fundamentals');
                const looksDevPath = (catVal==='software-devops') || (/Programming|CI\/CD|Containers|Kubernetes|Application Platforms|Databases/i.test(String(focusVal||''))) || (["Cisco","MongoDB","Microsoft","AWS","Google Cloud","Oracle","Docker","Python Institute"].includes(vendorVal));
                const ensureBanner = (id)=>{
                    let b = document.getElementById(id);
                    if (!b) {
                        b = document.createElement('div');
                        b.id = id;
                        b.style.cssText = 'margin:10px auto;max-width:var(--container-max);padding:10px 12px;border:1px solid #c7d2fe;background:#eef2ff;color:#1e3a8a;border-radius:10px;display:flex;gap:8px;align-items:center;';
                        const container = document.querySelector('.filter-section .container');
                        const anchor = document.getElementById('results-summary');
                        if (container && anchor) container.insertBefore(b, anchor.nextSibling);
                    }
                    return b;
                };
                // Programming nudge
                const progId = 'prereqHintProgramming';
                if (strict && levelVal===2 && looksDevPath && !hasProgFund) {
                    const banner = ensureBanner(progId);
                    banner.innerHTML = `
                        <i class='fas fa-lightbulb' style='color:#1d4ed8;'></i>
                        <div style='flex:1;'>Some Level 2 developer certifications require a Programming Foundations pick at Level 1. Consider adding one (e.g., Python Institute PCEP, ISACA Software Development Fundamentals, or Oracle Java Foundations) to unlock L2 developer options.</div>
                        <div style='display:flex;gap:6px;'>
                            <button id='showL1ProgrammingBtn' class='btn-secondary' style='white-space:nowrap;'>Show L1 Programming Foundations</button>
                            <button id='dismissPrereqProgBtn' class='btn-secondary' style='white-space:nowrap;'>Dismiss</button>
                        </div>`;
                    banner.querySelector('#showL1ProgrammingBtn')?.addEventListener('click', ()=>{
                        const lv = document.getElementById('levelFilter'); const cat = document.getElementById('categoryFilter'); const foc = document.getElementById('focusFilter'); const ven = document.getElementById('vendorFilter'); const varea = document.getElementById('vendorAreaFilter'); const si = document.querySelector('.search-input');
                        if (lv) lv.value = '1'; if (cat) cat.value = 'software-devops'; if (foc) foc.value = 'Programming'; if (ven) ven.value = ''; if (varea) varea.value = ''; if (si) si.value = '';
                        try { rebuildVendorAreaOptions(); } catch(_) {}
                        document.getElementById('certification-filtering').scrollIntoView({ behavior: 'smooth' });
                        try { setPage(1); applyFilters(); } catch(_) {}
                    }, { once: true });
                    banner.querySelector('#dismissPrereqProgBtn')?.addEventListener('click', ()=>{ document.getElementById(progId)?.remove(); }, { once: true });
                } else { document.getElementById(progId)?.remove(); }

                // Security path nudge: at L2 with security focus but missing network foundations
                const hasNetFund = priorTags.has('foundation-network');
                const looksSecurity = (catVal==='cybersecurity') || (/Security|SOC|Blue Team|Offensive|Privacy|GRC/i.test(String(focusVal||'')));
                const secId = 'prereqHintSecurity';
                if (strict && levelVal===2 && looksSecurity && !hasNetFund) {
                    const banner = ensureBanner(secId);
                    banner.innerHTML = `
                        <i class='fas fa-shield-alt' style='color:#1d4ed8;'></i>
                        <div style='flex:1;'>Many Level 2 security certifications benefit from a networking foundation at Level 1 (e.g., CompTIA Network+ or Cisco CCNA). Add one to unlock better-aligned L2 options.</div>
                        <div style='display:flex;gap:6px;'>
                            <button id='showL1NetworkBtn' class='btn-secondary' style='white-space:nowrap;'>Show L1 Networking Foundations</button>
                            <button id='dismissPrereqSecBtn' class='btn-secondary' style='white-space:nowrap;'>Dismiss</button>
                        </div>`;
                    banner.querySelector('#showL1NetworkBtn')?.addEventListener('click', ()=>{
                        const lv = document.getElementById('levelFilter'); const cat = document.getElementById('categoryFilter'); const foc = document.getElementById('focusFilter'); const ven = document.getElementById('vendorFilter'); const varea = document.getElementById('vendorAreaFilter'); const si = document.querySelector('.search-input');
                        if (lv) lv.value = '1'; if (cat) cat.value = 'core-it'; if (foc) foc.value = 'Enterprise R&S'; if (ven) ven.value = ''; if (varea) varea.value = ''; if (si) si.value = '';
                        try { rebuildVendorAreaOptions(); } catch(_) {}
                        document.getElementById('certification-filtering').scrollIntoView({ behavior: 'smooth' });
                        try { setPage(1); applyFilters(); } catch(_) {}
                    }, { once: true });
                    banner.querySelector('#dismissPrereqSecBtn')?.addEventListener('click', ()=>{ document.getElementById(secId)?.remove(); }, { once: true });
                } else { document.getElementById(secId)?.remove(); }

                // Cloud architect nudge: at L2 cloud path but missing cloud fundamentals
                const hasCloudFund = priorTags.has('vendor-cloud-fund');
                const looksCloudArch = (catVal==='cloud-platforms') || (/Public Cloud|Architect|Cloud Engineer/i.test(String(focusVal||'')));
                const cloudId = 'prereqHintCloud';
                if (strict && levelVal===2 && looksCloudArch && !hasCloudFund) {
                    const banner = ensureBanner(cloudId);
                    banner.innerHTML = `
                        <i class='fas fa-cloud' style='color:#1d4ed8;'></i>
                        <div style='flex:1;'>For Level 2 cloud roles, complete a cloud fundamentals at Level 1 (e.g., AWS CLF-C01, Microsoft AZ-900, or Google Cloud Digital Leader).</div>
                        <div style='display:flex;gap:6px;'>
                            <button id='showL1CloudBtn' class='btn-secondary' style='white-space:nowrap;'>Show L1 Cloud Fundamentals</button>
                            <button id='dismissPrereqCloudBtn' class='btn-secondary' style='white-space:nowrap;'>Dismiss</button>
                        </div>`;
                    banner.querySelector('#showL1CloudBtn')?.addEventListener('click', ()=>{
                        const lv = document.getElementById('levelFilter'); const cat = document.getElementById('categoryFilter'); const foc = document.getElementById('focusFilter'); const ven = document.getElementById('vendorFilter'); const varea = document.getElementById('vendorAreaFilter'); const si = document.querySelector('.search-input');
                        if (lv) lv.value = '1'; if (cat) cat.value = 'cloud-platforms'; if (foc) foc.value = 'Public Cloud'; if (ven) ven.value = ''; if (varea) varea.value = ''; if (si) si.value = '';
                        try { rebuildVendorAreaOptions(); } catch(_) {}
                        document.getElementById('certification-filtering').scrollIntoView({ behavior: 'smooth' });
                        try { setPage(1); applyFilters(); } catch(_) {}
                    }, { once: true });
                    banner.querySelector('#dismissPrereqCloudBtn')?.addEventListener('click', ()=>{ document.getElementById(cloudId)?.remove(); }, { once: true });
                } else { document.getElementById(cloudId)?.remove(); }
            } catch(_) {}

            // Keep last filtered for exporting
            window.__lastFiltered = filtered.slice();

            // Render certification cards
            const resultsDiv = document.getElementById('dynamic-results');
            resultsDiv.innerHTML = '';
            if (filtered.length === 0) {
                // Contextual empty state hints
                const hints = [];
                if (vendor) hints.push('Clear Vendor to see more options');
                if (vendor && vendorArea) hints.push('Clear Vendor Area');
                if (focus) hints.push('Clear Focus');
                if (trackSelections.length) hints.push('Remove one selected Track');
                if (strictChronology && level && level>1) hints.push('Turn off Strict chronology or add missing Level 1 foundations');
                const html = `
                    <div style="border:1px solid #fde68a;background:#fffbeb;color:#92400e;border-radius:10px;padding:10px 12px;">
                        <div style="font-weight:700; margin-bottom:6px;">No certifications match your filters</div>
                        <div>${hints.length ? 'Try: ' + hints.map(h=>`<button class="btn-secondary" style="margin:2px;" data-hint="${h}">${h}</button>`).join(' ') : 'Try clearing one or more filters.'}</div>
                    </div>`;
                resultsDiv.innerHTML = html;
                resultsDiv.querySelectorAll('button[data-hint]')?.forEach(btn=>{
                    btn.addEventListener('click', ()=>{
                        const text = btn.getAttribute('data-hint')||'';
                        if (text.includes('Clear Vendor Area')) document.getElementById('vendorAreaFilter').value='';
                        if (text.includes('Clear Vendor')) document.getElementById('vendorFilter').value='', rebuildVendorAreaOptions();
                        if (text.includes('Clear Focus')) document.getElementById('focusFilter').value='';
                        if (text.includes('Remove one selected Track')) { const el=document.getElementById('trackFilter'); const sel=Array.from(el.options).filter(o=>o.selected); if (sel[0]) sel[0].selected=false; }
                        if (text.includes('Turn off Strict chronology')) document.getElementById('toggleStrictChronology').checked=false;
                        setPage(1); applyFilters();
                    });
                });
                renderPagination(0, ()=>{});
            } else {
                // Pagination slice
                const total = filtered.length;
                const start = (currentPage - 1) * PAGE_SIZE;
                const end = start + PAGE_SIZE;
                const pageItems = filtered.slice(start, end);

                const grid = document.createElement('div');
                grid.style.display = 'grid';
                grid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(320px, 1fr))';
                grid.style.gap = '2rem';
                if (document.getElementById('densityToggle')?.checked) grid.classList.add('grid-compact');

                const currentRules = level ? levelRules[level] : null;
                const currentSelected = level ? selectedByLevel[level] : null;
                const lockedPrev = level ? getCumulativeSelection(level-1) : new Set();

                function renderCard(cert){
                    const card = document.createElement('div');
                    card.className = 'cert-card-premium';
                    card.style.background = cert.premium ? 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)' : '#fff';
                    card.style.border = cert.premium ? '2px solid #667eea' : '1px solid #cbd5e1';
                    card.style.borderRadius = '18px';
                    card.style.boxShadow = '0 8px 32px rgba(102,126,234,0.08)';
                    card.style.padding = '2rem';
                    card.style.display = 'flex';
                    card.style.flexDirection = 'column';
                    card.style.alignItems = 'center';

                                        const logoSrc = resolveLogoSrc(cert);
                                        const displayArea = (vendor && cert.vendor===vendor) ? (Array.isArray(cert.vendor_area) ? (cert.vendor_area[0]||'') : (cert.vendor_area || cert.solution_area || '')) : '';
                                        const recommendedL1CompTIA = (level===1) && ((vendor==='CompTIA') || (anchorVendor==='CompTIA')) && ['CompTIA Tech+','Foundation Certification','CompTIA Network+'].includes(cert.name);
                                        const whyText = recommendedL1CompTIA ? 'Foundation stack for Level 1: Media & Enterta literacy, endpoint, and networking basics' : '';
                                        // Stage badge (use explicit stage or inferred)
                                        const stageLabel = cert.vendor_stage || inferVendorStage(cert);
                                        const stageHtml = stageLabel ? `<div title='Vendor stage' style="display:inline-flex;align-items:center;gap:0.35rem;background:#fff7ed;border:1px solid #fdba74;color:#9a3412;padding:0.15rem 0.5rem;border-radius:999px;font-weight:700;font-size:0.75rem;margin-bottom:0.5rem;"><i class='fas fa-medal'></i> ${stageLabel}</div>` : '';
                                                                                                    const whyHtml = (Array.isArray(cert._why) && cert._why.length) ? `
                                                                                                            <div style='margin-left:auto; position:relative;'>
                                                                                                                <button class='why-btn' title='Why recommended?' style='border:1px solid #94a3b8; color:#0f172a; background:#f8fafc; padding:0.2rem 0.5rem; border-radius:6px; font-size:0.78rem; cursor:pointer;'>Why?</button>
                                                                                                                <div class='why-popover' style='display:none; position:fixed; z-index:9999; background:#fff; border:1px solid #cbd5e1; box-shadow:0 10px 30px rgba(0,0,0,0.18); border-radius:10px; padding:0.75rem; width:min(360px, 92vw);'>
                                                                                                                    <div style='display:flex; align-items:center; gap:0.5rem; justify-content:space-between; margin-bottom:0.25rem;'>
                                                                                                                        <div style='font-weight:700; color:#0f172a;'>Why we recommend this</div>
                                                                                                                        <div style='display:flex; gap:0.5rem;'>
                                                                                                                            <button class='why-copy' title='Copy reasons' style='border:1px solid #cbd5e1; background:#f8fafc; color:#0f172a; cursor:pointer; font-size:0.78rem; padding:0.1rem 0.4rem; border-radius:6px;'>Copy</button>
                                                                                                                            <button class='why-close' aria-label='Close' style='border:none; background:transparent; color:#475569; cursor:pointer; font-size:0.9rem;'>â</button>
                                                                                                                        </div>
                                                                                                                    </div>
                                                                                                                    <ul class='why-list' style='margin:0; padding-left:1.1rem; color:#334155; font-size:0.9rem;'>${cert._why.map(r=>`<li>${r}</li>`).join('')}</ul>
                                                                                                                </div>
                                                                                                            </div>
                                                                                                    ` : '';
                                                                                                    card.innerHTML = `
                                                                                                            <img src='${logoSrc}' alt='${cert.vendor} logo' style='height:56px;margin-bottom:1rem;max-width:100%;object-fit:contain;' loading='lazy' onerror="this.onerror=null;this.src='../assets/images/vendor-logos/default-logo.svg';">
                        <h4 style='font-size:1.2rem;color:#1e293b;margin-bottom:0.5rem;'>${cert.vendor==='Microsoft' ? canonicalMicrosoftDisplayName(cert) : cert.name}</h4>
                        <div style='color:#64748b;font-size:1rem;margin-bottom:0.5rem;'>Vendor: <strong>${cert.vendor}</strong></div>
                        <div style='color:#64748b;font-size:0.98rem;margin-bottom:0.5rem;'>Category: ${cert.category.replace(/-/g,' ').replace(/\b\w/g, l => l.toUpperCase())}</div>
                        <div style='color:#64748b;font-size:0.98rem;margin-bottom:0.5rem;'>Focus Area: ${cert.focus}</div>
                                                ${displayArea ? `<div style="display:inline-flex;align-items:center;gap:0.4rem;background:#eef2ff;border:1px solid #c7d2fe;color:#3730a3;padding:0.15rem 0.5rem;border-radius:999px;font-weight:700;font-size:0.75rem;margin-bottom:0.5rem;"><i class='fas fa-diagram-project'></i> ${displayArea}</div>` : ''}
                                                ${stageHtml}
                        <div style='color:#3b82f6;font-size:0.98rem;margin-bottom:0.5rem;'>Level ${cert.level}</div>
                        <div style='color:#059669;font-size:0.98rem;margin-bottom:1rem;'>Exam: ${cert.exam || 'N/A'} ${cert.exam ? `<button class='copy-exam-btn' title='Copy exam' style='margin-left:0.5rem; padding:0.2rem 0.5rem; font-size:0.8rem; border:1px solid #10b981; color:#065f46; background:#ecfdf5; border-radius:6px; cursor:pointer;'><i class='fas fa-copy'></i> Copy</button>` : ''}</div>
                                                ${recommendedL1CompTIA ? `<div title='${whyText}' style="display:inline-flex;align-items:center;gap:0.4rem;background:#ecfeff;border:1px solid #06b6d4;color:#0e7490;padding:0.2rem 0.5rem;border-radius:999px;font-weight:700;font-size:0.78rem;margin-bottom:0.75rem;"><i class='fas fa-thumbs-up'></i> Recommended for Level 1 (CompTIA)</div>` : ''}
                                                                    <div style='display:flex; gap:0.5rem; width:100%; align-items:center;'>
                                                                        <button class='info-button' title='More information'><i class='fas fa-circle-info'></i> Info</button>
                                                                        ${whyHtml}
                                                                        <button class='select-cert-btn cta-button cta-standard' style='margin-left:auto;'>Select</button>
                                                                    </div>
                    `;

                    const btn = card.querySelector('.select-cert-btn');
                    const whyBtn = card.querySelector('.why-btn');
                    const whyPop = card.querySelector('.why-popover');
                    const whyClose = card.querySelector('.why-close');
                    const whyCopy = card.querySelector('.why-copy');
                    if (whyBtn && whyPop) {
                        const placePopover = ()=>{
                            const rect = whyBtn.getBoundingClientRect();
                            const pad = 8;
                            let top = rect.bottom + pad;
                            let left = Math.min(window.innerWidth - pad - whyPop.offsetWidth, Math.max(pad, rect.right - whyPop.offsetWidth));
                            if (top + whyPop.offsetHeight > window.innerHeight - pad) {
                                top = rect.top - pad - whyPop.offsetHeight; // flip above if not enough space
                            }
                            whyPop.style.top = `${Math.max(pad, top)}px`;
                            whyPop.style.left = `${Math.max(pad, left)}px`;
                        };
                        whyBtn.addEventListener('click', (e)=>{
                            e.stopPropagation();
                            const open = whyPop.style.display === 'block';
                            if (!open) {
                                document.body.appendChild(whyPop);
                                whyPop.style.display = 'block';
                                // Wait for layout to compute width/height
                                requestAnimationFrame(placePopover);
                            } else {
                                whyPop.style.display = 'none';
                            }
                        });
                        if (whyClose) {
                            whyClose.addEventListener('click', (e)=>{ e.stopPropagation(); whyPop.style.display='none'; });
                        }
                        if (whyCopy) {
                            whyCopy.addEventListener('click', async (e)=>{
                                e.stopPropagation();
                                try {
                                    const items = Array.from(whyPop.querySelectorAll('.why-list li')).map(li=>`â¢ ${li.textContent}`);
                                    await navigator.clipboard.writeText(items.join('\n'));
                                    whyCopy.textContent = 'Copied';
                                    setTimeout(()=>whyCopy.textContent='Copy', 1200);
                                } catch(_) {}
                            });
                        }
                        document.addEventListener('click', (ev)=>{
                            if (!card.contains(ev.target)) whyPop.style.display = 'none';
                        }, { once: true });
                    }
                    const isLockedPrev = !!(level && lockedPrev.has(cert.id));
                    let isSelected = isLockedPrev || !!(level && currentSelected && currentSelected.has(cert.id));

                    function updateButtonUI() {
                        if (!level) {
                            btn.textContent = 'Select (choose a Level first)';
                            btn.disabled = true;
                            btn.style.opacity = '0.6';
                            return;
                        }
                        const count = getSelectedCount(level);
                        const atMax = currentRules && count >= currentRules.max;
                        if (isSelected) {
                            btn.textContent = isLockedPrev ? 'Locked (Prev Level)' : 'Selected';
                            btn.classList.add('selected');
                            btn.style.background = '#059669';
                            btn.style.borderColor = '#059669';
                            btn.style.color = '#fff';
                            btn.disabled = isLockedPrev ? true : false;
                            btn.style.opacity = '1';
                        } else {
                            btn.textContent = 'Select';
                            btn.classList.remove('selected');
                            btn.style.background = '';
                            btn.style.borderColor = '';
                            btn.style.color = '';
                            btn.disabled = !!(currentRules && atMax);
                            btn.style.opacity = btn.disabled ? '0.6' : '1';
                        }
                    }

                    updateButtonUI();

                    btn.addEventListener('click', () => {
                        if (!level || !currentRules) return;
                        if (isLockedPrev) return; // cannot deselect prior-level items
                        const set = selectedByLevel[level];
                        if (set.has(cert.id)) {
                            set.delete(cert.id);
                        } else {
                            const total = getSelectedCount(level);
                            if (total < currentRules.max) set.add(cert.id);
                        }
                        applyFilters();
                    });

                    // Info modal handler
                    const infoBtn = card.querySelector('.info-button');
                    if (infoBtn) {
                        infoBtn.addEventListener('click', (e)=>{
                            e.stopPropagation();
                            const avgSalary = estimateSalary(cert);
                            const roles = suggestRoles(cert);
                            const reasons = Array.isArray(cert._why) ? cert._why.slice(0, 8) : [];
                            const whySection = reasons.length ? { heading: 'Why we recommend this', points: reasons, copy: true } : null;
                            openInfoModal({
                                title: cert.name,
                                meta: [
                                    ['Vendor', cert.vendor],
                                    ['Category', cert.category.replace(/-/g,' ')],
                                    ['Focus', cert.focus],
                                    ['Level', String(cert.level)],
                                    ['Exam Code', cert.exam || 'N/A']
                                ],
                                sections: [
                                    whySection,
                                    { heading: 'Primary Focus', body: `Become proficient in ${cert.focus} within ${cert.vendor} ecosystem, aligning skills with industry-standard practices.` },
                                    { heading: 'Deeper Purpose', body: 'Establish rigorous technical foundations and validated competencies to operate confidently in professional environments.' },
                                    { heading: 'Professional Impact', points: [
                                        'Role Readiness: Build capabilities for roles aligned to this certification focus',
                                        'Execution Quality: Apply best practices to real-world workloads',
                                        'Career Mobility: Gain a portable credential recognized by employers'
                                    ] },
                                    { heading: 'Use Cases', points: [
                                        'Hands-on lab implementation and troubleshooting',
                                        'Project delivery in enterprise environments',
                                        'Operational excellence and continuous improvement'
                                    ] },
                                    { heading: 'Common Roles', points: roles },
                                    avgSalary ? { heading: 'Compensation (Indicative)', body: `Estimated average annual salary: USD ${avgSalary.toLocaleString()} (varies by region, role, and experience).` } : null
                                ].filter(Boolean),
                                chips: [
                                    `<i class=\"fas fa-layer-group\"></i> Level ${cert.level}`,
                                    `<i class=\"fas fa-clock\"></i> Est. Level Duration: ${levelDuration[cert.level] || 'Varies'}`,
                                    `<i class=\"fas fa-hourglass-half\"></i> Est. Cert Duration: ${estimateCertDuration(cert)}`,
                                    cert.premium ? '<i class="fas fa-star"></i> Premium Vendor' : '<i class="fas fa-badge-check"></i> Standard Vendor'
                                ].filter(Boolean)
                            });
                        });
                    }

                    // Copy exam button handler
                    const copyBtn = card.querySelector('.copy-exam-btn');
                    if (copyBtn && cert.exam) {
                        copyBtn.addEventListener('click', (e)=>{
                            e.stopPropagation();
                            try { navigator.clipboard.writeText(String(cert.exam)); } catch(_) {}
                            copyBtn.textContent = 'Copied!';
                            setTimeout(()=>{ copyBtn.innerHTML = `<i class='fas fa-copy'></i> Copy`; }, 1200);
                        });
                    }

                    grid.appendChild(card);
                }

                if (groupBy === 'vendor' || groupBy === 'category') {
                    const keyFn = (c)=> groupBy==='vendor' ? c.vendor : (categoryLabelMap[c.category]||c.category);
                    const groups = new Map();
                    pageItems.forEach(c=>{ const k=keyFn(c); if(!groups.has(k)) groups.set(k, []); groups.get(k).push(c); });
                    groups.forEach((list, key)=>{
                        const h = document.createElement('h4'); h.textContent = `${key} (${list.length})`;
                        h.style.margin='0.5rem 0'; h.style.color='#334155'; h.style.gridColumn='1 / -1';
                        grid.appendChild(h);
                        list.forEach(renderCard);
                    });
                } else {
                    pageItems.forEach(renderCard);
                }

                resultsDiv.appendChild(grid);

                // Pagination controls (top/bottom)
                renderPagination(total, ()=>applyFilters());

                if (level) {
                    const note = document.createElement('p');
                    note.style.color = '#64748b';
                    note.style.marginTop = '0.5rem';
                    const cum = getSelectedCount(level);
                    note.textContent = `${rulesTextFor(level)} Cumulative selected across L1-${level}: ${cum}.`;
                    resultsDiv.appendChild(note);
                    renderSelectionSummary(level, resultsDiv);

                    // Current Level Price badge
                    try {
                        const priceWrap = document.createElement('div');
                        priceWrap.style.marginTop = '0.5rem';
                        priceWrap.innerHTML = `<span style="display:inline-block; background:#f1f5f9; border:1px solid #e2e8f0; color:#334155; padding:0.4rem 0.6rem; border-radius:8px; font-weight:600;">Level Price: ${pricingConfig.currency} ${computeSubtotal(level).toLocaleString()}</span>`;
                        resultsDiv.appendChild(priceWrap);
                    } catch(_) {}
                }
            }

            // Anchor nudges when min cannot be met
            try {
                const { min } = levelRules[level] || { min: 0 };
                const remaining = Math.max(0, min - getSelectedCount(level));
                if (level && remaining > 0) {
                    const bannerId = 'anchorNudge';
                    let banner = document.getElementById(bannerId);
                    if (!banner) {
                        banner = document.createElement('div');
                        banner.id = bannerId;
                        banner.style.cssText='margin:10px 0;padding:10px;border:1px solid #bae6fd;background:#e0f2fe;color:#075985;border-radius:8px;display:flex;gap:8px;align-items:center;';
                        const container = document.querySelector('.filter-section .container');
                        container.insertBefore(banner, document.getElementById('results-summary'));
                    }
                    banner.innerHTML = `
                        <i class='fas fa-lightbulb'></i>
                        <div style='flex:1;'>Need ${remaining} more to meet Level ${level}. Try relaxing anchoring or clearing vendor to unlock more options.</div>
                        <button class='btn-secondary' id='relaxAnchorBtn'>Relax anchoring</button>
                        <button class='btn-secondary' id='clearVendorBtn'>Clear vendor</button>
                    `;
                    banner.querySelector('#relaxAnchorBtn')?.addEventListener('click', ()=>{ const t=document.getElementById('toggleVendorAnchor'); if (t){ t.checked=false; setPage(1); applyFilters(); } });
                    banner.querySelector('#clearVendorBtn')?.addEventListener('click', ()=>{ const v=document.getElementById('vendorFilter'); const a=document.getElementById('vendorAreaFilter'); if (v){ v.value=''; } if (a){ a.value=''; } rebuildVendorAreaOptions(); setPage(1); applyFilters(); });
                } else {
                    document.getElementById('anchorNudge')?.remove();
                }
            } catch(_) {}

            // Render professional development modules for selected level as cards
            const modulesDiv = document.getElementById('level-modules');
            modulesDiv.innerHTML = '';
            if (level && pdModules[level]) {
                const header = document.createElement('h3');
                header.textContent = `Level ${level} Professional Development Modules`;
                const mgrid = document.createElement('div');
                mgrid.className = 'modules-grid';
                pdModules[level].forEach(mod => {
                    const m = document.createElement('div');
                    m.className = 'module-card';
                    const meta = mod;
                    m.innerHTML = `
                        <div class='module-icon'><i class="fas ${meta.icon || 'fa-check-circle'}"></i></div>
                        <div class='module-title'>${meta.code}: ${meta.title}</div>
                        <div class='module-desc'>${meta.desc} â¢ ${meta.hours} â¢ ${meta.levelLabel}</div>
                    `;
                    // Modal for module info
                    m.style.cursor = 'pointer';
                    m.addEventListener('click', ()=>{
                        openInfoModal({
                            title: `${meta.code}: ${meta.title}`,
                            meta: [
                                ['Level', meta.levelLabel],
                                ['Hours', meta.hours]
                            ],
                            sections: [
                                { heading: 'Primary Focus', body: meta.desc },
                                { heading: 'Professional Impact', points: [
                                    'Improves execution quality and collaboration',
                                    'Enhances leadership readiness and communication',
                                    'Strengthens workplace performance and delivery'
                                ] },
                                { heading: 'Personal Development Benefits', points: [
                                    'Builds confidence through mastery',
                                    'Accelerates learning and adaptability',
                                    'Supports ethical, customer-centric behavior'
                                ] }
                            ],
                            chips: [
                                `<i class=\"fas fa-layer-group\"></i> ${meta.levelLabel}`,
                                `<i class=\"fas fa-clock\"></i> Est. Level Duration: ${levelDuration[parseInt(document.getElementById('levelFilter').value) || 1] || 'Varies'}`
                            ]
                        });
                    });
                    mgrid.appendChild(m);
                });
                modulesDiv.appendChild(header);
                modulesDiv.appendChild(mgrid);
            }

            // Checkout CTA gated by min rule
            if (level && levelRules[level]) {
                const { min } = levelRules[level];
                const count = getSelectedCount(level);
                const checkoutBtn = document.createElement('button');
                checkoutBtn.className = 'cta-button cta-standard';
                checkoutBtn.style.marginTop = '1rem';
                checkoutBtn.textContent = count >= min ? 'Proceed to Checkout' : `Select at least ${min} to proceed`;
                checkoutBtn.disabled = count < min;
                checkoutBtn.style.opacity = checkoutBtn.disabled ? '0.6' : '1';
                checkoutBtn.onclick = function () {
                    if (checkoutBtn.disabled) return;
                    alert('Proceeding to checkout...');
                };
                modulesDiv.appendChild(checkoutBtn);
            }

            // Nudge: When CompTIA is selected at Level 3+ without a Vendor Area, suggest choosing an area
            try {
                const vSel = document.getElementById('vendorFilter')?.value || '';
                const vAreaSel = document.getElementById('vendorAreaFilter')?.value || '';
                const shouldNudge = vSel === 'CompTIA' && level >= 3 && !vAreaSel;
                let nudge = document.getElementById('vendorAreaNudge');
                if (shouldNudge) {
                    if (!nudge) {
                        nudge = document.createElement('div');
                        nudge.id = 'vendorAreaNudge';
                        nudge.style.cssText = 'margin:10px 0;padding:10px;border:1px solid #93c5fd;background:#eff6ff;color:#1d4ed8;border-radius:8px;display:flex;flex-wrap:wrap;gap:6px;align-items:center;';
                        const container = document.querySelector('.filter-section .container') || document.body;
                        container.insertBefore(nudge, container.firstChild);
                    }
                    nudge.innerHTML = `
                        <span style='font-weight:600;'><i class="fas fa-filter"></i> Tip:</span>
                        <span>You selected CompTIA at Level ${level}. Choose an Area to focus the results:</span>
                        <button class='btn-secondary' data-area='Cybersecurity (Defense)'>Cybersecurity (Defense)</button>
                        <button class='btn-secondary' data-area='Offensive Cybersecurity'>Offensive Cybersecurity</button>
                        <button class='btn-secondary' data-area='Infrastructure'>Infrastructure</button>
                        <button class='btn-secondary' data-area='Cloud'>Cloud</button>
                        <button class='btn-secondary' data-area='Data & Analytics'>Data & Analytics</button>
                    `;
                    nudge.querySelectorAll('button[data-area]')?.forEach(btn => {
                        btn.addEventListener('click', (e)=>{
                            const area = e.currentTarget.getAttribute('data-area');
                            const aSel = document.getElementById('vendorAreaFilter');
                            if (aSel) { aSel.value = area; }
                            setPage(1); applyFilters();
                        });
                    });
                } else if (nudge) {
                    nudge.remove();
                }
            } catch(_) {}

                        // Render Quote panel rows
            try {
                const qc = document.getElementById('quote-content');
                if (qc) {
                    const rows = [];
                    for (let l=1; l<=5; l++) {
                        const ids = getCumulativeSelection(l);
                                                const count = ids.size;
                                                const subtotal = computeSubtotal(l);
                                                                                                rows.push(`<div style='display:flex; align-items:center; gap:0.75rem; padding:0.4rem 0; border-bottom:1px dashed #e2e8f0;'>
                          <strong style='min-width:70px;'>Level ${l}</strong>
                                                                            <span style='color:#64748b;'>${count} selected cumulative â¢ Level Price ${pricingConfig.currency} ${subtotal.toLocaleString()}</span>
                          <span style='margin-left:auto;'>
                            <button class='btn-secondary' onclick="exportQuote(${l}, 'json')">Export L${l} (JSON)</button>
                            <button class='btn-secondary' onclick="exportQuote(${l}, 'csv')">Export L${l} (CSV)</button>
                                                                                                        <button class='btn-secondary' onclick="printQuote(${l})">Print L${l}</button>
                          </span>
                        </div>`);
                    }
                                                                qc.innerHTML = rows.join('') + `<div style='color:#94a3b8; font-size:0.85rem; margin-top:0.5rem;'>Prices reflect all-inclusive level bundles (certifications + professional development). You can override amounts in <code>assets/data/pricing.json</code>.</div>`;
                }
            } catch(_) {}
        }

        // Tiny toast for Quick Pick selections
        function showQuickPickToast(level, names, reason){
            try {
                const id = 'quickPickToast';
                let el = document.getElementById(id);
                if (!el){
                    el = document.createElement('div'); el.id = id;
                    el.style.cssText = 'position:sticky; top:8px; z-index:999; margin:8px auto; max-width:var(--container-max); padding:10px 12px; border:1px solid #bbf7d0; background:#ecfdf5; color:#065f46; border-radius:10px; font-size:0.9rem;';
                    const container = document.querySelector('.filter-section .container') || document.body;
                    container.insertBefore(el, container.firstChild.nextSibling);
                }
                const list = names && names.length ? names.map(n=>`â¢ ${n}`).join('<br>') : 'No changes';
                el.innerHTML = `<strong>Quick Pick (Level ${level})</strong> â ${reason || 'Recommended selection'}<br>${list}`;
                setTimeout(()=>{ el?.remove(); }, 6000);
            } catch(_) { /* ignore */ }
        }

        // Quick Pick recommender: vendor-aware defaults with AWS/Microsoft support
        function quickPickRecommend(vendor, level){
            // Ensure structure
            if (!selectedByLevel[level]) selectedByLevel[level] = new Set();
            const priorIds = getCumulativeSelection(level);
            const addByName = (nm)=>{
                const c = certifications.find(x=>x.name===nm);
                if (c && !priorIds.has(c.id)) selectedByLevel[level].add(c.id);
            };
            const getTracks = ()=> Array.from(document.getElementById('trackFilter')?.selectedOptions || []).map(o=>o.value);
            const tracksSet = new Set(getTracks());
            const isCisco = vendor==='Cisco';
            const isAWS = vendor==='AWS';
            const isMicrosoft = vendor==='Microsoft';
            if (level===1){
                if (isCisco){
                    // 2F + 1A (prefer CCNA)
                    const picks = ['Cisco Certified Support Technician (CCST) Networking','Cisco Certified Technician (CCT) Routing & Switching','Cisco CCNA'];
                    picks.forEach(addByName);
                    showQuickPickToast(level, picks, 'Cisco: 2 Foundational + 1 Associate');
                } else if (isAWS) {
                    const picks = [];
                    // AWS: Foundational + second foundational (best available) + 1 Associate
                    picks.push('AWS Certified Cloud Practitioner');
                    // try to add a second AWS foundational if present (rare), else best cross-vendor foundational
                    const foundAll = certifications.filter(c=>/Foundational|Fundamental/i.test(String(c.vendor_stage||'')));
                    const awsSecond = foundAll.find(c=>c.vendor==='AWS' && c.name!=='AWS Certified Cloud Practitioner');
                    if (awsSecond) picks.push(awsSecond.name); else {
                        // pick a strong cross-vendor foundational if not already chosen
                        const cross = ['Microsoft Azure Fundamentals (AZ-900)','Google Cloud Digital Leader','CompTIA Tech+'];
                        const nm = cross.find(n=>certifications.some(c=>c.name===n));
                        if (nm) picks.push(nm);
                    }
                    const assocPref = ['AWS Certified Solutions Architect â Associate','AWS Certified Developer â Associate','AWS Certified SysOps Administrator â Associate'];
                    const assocNm = assocPref.find(n=>certifications.some(c=>c.name===n));
                    if (assocNm) picks.push(assocNm);
                    picks.forEach(addByName);
                    showQuickPickToast(level, picks, 'AWS: 2 Foundational + 1 Associate');
                } else if (isMicrosoft) {
                    const picks = [];
                    // Microsoft: choose two fundamentals by availability, then one associate (AZ-104 default; SC-200/SC-300 for Security; AZ-204 for Dev)
                    const fundamentals = ['Microsoft Azure Fundamentals (AZ-900)','Microsoft Azure Data Fundamentals (DP-900)','Microsoft Azure AI Fundamentals (AI-900)','Microsoft Power Platform Fundamentals (PL-900)','Microsoft 365 Fundamentals (MS-900)'];
                    const avail = fundamentals.filter(n=>certifications.some(c=>c.name===n));
                    if (avail[0]) picks.push(avail[0]);
                    if (avail[1]) picks.push(avail[1]);
                    let assocChoices = ['Microsoft Azure Administrator (AZ-104)','Microsoft Azure Developer (AZ-204)'];
                    if (tracksSet.has('Security')) assocChoices = ['Microsoft Security Operations Analyst (SC-200)','Microsoft Identity and Access Administrator (SC-300)'];
                    const assocNm = assocChoices.find(n=>certifications.some(c=>c.name===n));
                    if (assocNm) picks.push(assocNm);
                    picks.forEach(addByName);
                    showQuickPickToast(level, picks, 'Microsoft: 2 Fundamentals + 1 Associate');
                } else {
                    // Generic: prefer two Foundational + one Associate for other vendors when available
                    const found = certifications.filter(c=>/Foundational|Fundamental/i.test(c.vendor_stage||''));
                    const assoc = certifications.filter(c=>/Associate|Administrator|Developer/i.test(c.vendor_stage||''));
                    const f1 = found.find(c=>(!vendor || c.vendor===vendor) && !priorIds.has(c.id));
                    const f2 = found.find(c=>(!vendor || c.vendor===vendor) && c!==f1 && !priorIds.has(c.id));
                    const a1 = assoc.find(c=>(!vendor || c.vendor===vendor) && !priorIds.has(c.id));
                    const picks = [];
                    if (f1) { selectedByLevel[level].add(f1.id); picks.push(f1.name); }
                    if (f2) { selectedByLevel[level].add(f2.id); picks.push(f2.name); }
                    if (a1) { selectedByLevel[level].add(a1.id); picks.push(a1.name); }
                    if (picks.length) showQuickPickToast(level, picks, 'Generic: 2 Foundational + 1 Associate');
                }
                return;
            }
            if (level===2){
                if (isCisco){
                    // Fill missing associate(s) if not chosen at L1
                    ['Cisco CCNA','Cisco CyberOps Associate','Cisco DevNet Associate'].forEach(nm=>{
                        const c = certifications.find(x=>x.name===nm);
                        if (c && !getCumulativeSelection(1).has(c.id)) selectedByLevel[2].add(c.id);
                    });
                    showQuickPickToast(level, ['Cisco CCNA','Cisco CyberOps Associate','Cisco DevNet Associate'].filter(nm=>{
                        const c=certifications.find(x=>x.name===nm); return c && !getCumulativeSelection(1).has(c.id);
                    }), 'Cisco: Fill remaining Associates');
                } else if (isAWS) {
                    const assoc = ['AWS Certified Solutions Architect â Associate','AWS Certified Developer â Associate','AWS Certified SysOps Administrator â Associate'];
                    const add = assoc.find(nm=>{
                        const c = certifications.find(x=>x.name===nm); return c && !getCumulativeSelection(2).has(c.id);
                    });
                    if (add) { addByName(add); showQuickPickToast(level, [add], 'AWS: Ensure at least one Associate'); }
                } else if (isMicrosoft) {
                    let choices = ['Microsoft Azure Administrator (AZ-104)','Microsoft Azure Developer (AZ-204)'];
                    if (tracksSet.has('Security')) choices = ['Microsoft Security Operations Analyst (SC-200)','Microsoft Identity and Access Administrator (SC-300)'];
                    const add = choices.find(nm=>{
                        const c = certifications.find(x=>x.name===nm); return c && !getCumulativeSelection(2).has(c.id);
                    });
                    if (add) { addByName(add); showQuickPickToast(level, [add], 'Microsoft: Consolidate Associate tier'); }
                }
                return;
            }
            if (level===3){
                if (isCisco){
                    // Choose a single core; prefer ENCOR
                    const prefer = ['Cisco CCNP Enterprise (ENCOR)','Cisco CCNP Security (SCOR)','Cisco DevNet Professional','Cisco CCNP Data Center (DCCOR)','Cisco CCNP Collaboration (CLCOR)','Cisco CCNP Service Provider (SPCOR)'];
                    for (const nm of prefer){ const c=certifications.find(x=>x.name===nm); if (c){ selectedByLevel[3].add(c.id); showQuickPickToast(level, [nm], 'Cisco: Professional core'); break; } }
                } else if (isAWS) {
                    const prefer = tracksSet.has('DevOps') ? ['AWS Certified DevOps Engineer â Professional','AWS Certified Solutions Architect â Professional'] : ['AWS Certified Solutions Architect â Professional','AWS Certified DevOps Engineer â Professional'];
                    const nm = prefer.find(n=>certifications.some(c=>c.name===n));
                    if (nm) { addByName(nm); showQuickPickToast(level, [nm], 'AWS: Professional core'); }
                } else if (isMicrosoft) {
                    let choices = ['Microsoft Azure Administrator (AZ-104)','Microsoft Azure Developer (AZ-204)'];
                    if (tracksSet.has('Security')) choices = ['Microsoft Security Operations Analyst (SC-200)','Microsoft Identity and Access Administrator (SC-300)'];
                    const nm = choices.find(n=>certifications.some(c=>c.name===n));
                    if (nm) { addByName(nm); showQuickPickToast(level, [nm], 'Microsoft: Primary role certification'); }
                }
                return;
            }
            if (level===4){
                if (isCisco){
                    // Add one concentration that matches the chosen core
                    const have = Array.from(getCumulativeSelection(4)).map(id=>certifications.find(c=>c.id===id));
                    const has = (nm)=> have.some(c=>c && c.name===nm);
                    if (has('Cisco CCNP Enterprise (ENCOR)')){
                        const opts = ['Cisco CCNP Enterprise Concentration: ENARSI','Cisco CCNP Enterprise Concentration: ENAUTO'];
                        const c = certifications.find(x=>opts.includes(x.name)); if (c) { selectedByLevel[4].add(c.id); showQuickPickToast(level, [c.name], 'Cisco: Concentration for Enterprise core'); }
                    } else if (has('Cisco CCNP Security (SCOR)')){
                        const opts = ['Cisco CCNP Security Concentration: SISE','Cisco CCNP Security Concentration: SVPN','Cisco CCNP Security Concentration: SESA'];
                        const c = certifications.find(x=>opts.includes(x.name)); if (c) { selectedByLevel[4].add(c.id); showQuickPickToast(level, [c.name], 'Cisco: Concentration for Security core'); }
                    } else if (has('Cisco CCNP Data Center (DCCOR)')){
                        const opts = ['Cisco CCNP Data Center Concentration: DCACI','Cisco CCNP Data Center Concentration: DCAUTO','Cisco CCNP Data Center Concentration: DCMedia & Enterta'];
                        const c = certifications.find(x=>opts.includes(x.name)); if (c) { selectedByLevel[4].add(c.id); showQuickPickToast(level, [c.name], 'Cisco: Concentration for Data Center core'); }
                    } else if (has('Cisco CCNP Collaboration (CLCOR)')){
                        const opts = ['Cisco CCNP Collaboration Concentration: CLCEI','Cisco CCNP Collaboration Concentration: CLAUTO'];
                        const c = certifications.find(x=>opts.includes(x.name)); if (c) { selectedByLevel[4].add(c.id); showQuickPickToast(level, [c.name], 'Cisco: Concentration for Collaboration core'); }
                    } else if (has('Cisco CCNP Service Provider (SPCOR)')){
                        const opts = ['Cisco CCNP Service Provider Concentration: SPRI','Cisco CCNP Service Provider Concentration: SPAUTO'];
                        const c = certifications.find(x=>opts.includes(x.name)); if (c) { selectedByLevel[4].add(c.id); showQuickPickToast(level, [c.name], 'Cisco: Concentration for Service Provider core'); }
                    } else if (have.some(c=>c && c.name==='Cisco DevNet Professional')){
                        const opts = ['Cisco DevNet Professional Concentration: DEVOPS','Cisco DevNet Professional Concentration: DEVIOT'];
                        const c = certifications.find(x=>opts.includes(x.name)); if (c) { selectedByLevel[4].add(c.id); showQuickPickToast(level, [c.name], 'Cisco: Concentration for DevNet core'); }
                    }
                } else if (isAWS) {
                    const opts = tracksSet.has('Security') ? ['AWS Certified Security â Specialty']
                              : tracksSet.has('Data') ? ['AWS Certified Data Analytics â Specialty','AWS Certified Database â Specialty']
                              : tracksSet.has('Networking') ? ['AWS Certified Advanced Networking â Specialty']
                              : ['AWS Certified Security â Specialty','AWS Certified Data Analytics â Specialty'];
                    const nm = opts.find(n=>certifications.some(c=>c.name===n));
                    if (nm) { addByName(nm); showQuickPickToast(level, [nm], 'AWS: Add Specialty aligned to focus'); }
                } else if (isMicrosoft) {
                    const nm = 'Microsoft Azure Solutions Architect Expert (AZ-305)';
                    if (certifications.some(c=>c.name===nm)) { addByName(nm); showQuickPickToast(level, [nm], 'Microsoft: Expert credential'); }
                }
                return;
            }
            if (level===5){
                if (isCisco){
                    // Suggest aligned expert based on L3/L4
                    const haveNames = Array.from(getCumulativeSelection(5)).map(id=>{ const c=certifications.find(x=>x.id===id); return c?c.name:''; });
                    const suggest = () => {
                        if (haveNames.includes('Cisco CCNP Enterprise (ENCOR)')) return 'Cisco CCIE Enterprise Infrastructure';
                        if (haveNames.includes('Cisco CCNP Security (SCOR)')) return 'Cisco CCIE Security';
                        if (haveNames.includes('Cisco CCNP Data Center (DCCOR)')) return 'Cisco CCIE Data Center';
                        if (haveNames.includes('Cisco CCNP Collaboration (CLCOR)')) return 'Cisco CCIE Collaboration';
                        if (haveNames.includes('Cisco CCNP Service Provider (SPCOR)')) return 'Cisco CCIE Service Provider';
                        if (haveNames.includes('Cisco DevNet Professional')) return 'Cisco DevNet Expert';
                        return 'Cisco CCDE (Design Expert)';
                    };
                    const pick = suggest(); addByName(pick); showQuickPickToast(level, [pick], 'Cisco: Aligned Expert');
                } else if (isAWS) {
                    const options = ['AWS Certified Security â Specialty','AWS Certified Data Analytics â Specialty','AWS Certified Advanced Networking â Specialty','AWS Certified Solutions Architect â Professional','AWS Certified DevOps Engineer â Professional'];
                    const nm = options.find(n=>certifications.some(c=>c.name===n));
                    if (nm) { addByName(nm); showQuickPickToast(level, [nm], 'AWS: Capstone (second Specialty or Pro)'); }
                } else if (isMicrosoft) {
                    const options = tracksSet.has('Security') ? ['Microsoft Identity and Access Administrator (SC-300)']
                                  : tracksSet.has('Data') ? []
                                  : ['Microsoft Identity and Access Administrator (SC-300)','Microsoft Security Operations Analyst (SC-200)'];
                    const nm = options.find(n=>certifications.some(c=>c.name===n));
                    if (nm) { addByName(nm); showQuickPickToast(level, [nm], 'Microsoft: Cross-domain enhancement'); }
                }
            }
        }

        function clearFilters() {
            setPage(1);
            document.getElementById('levelFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            const focusEl = document.getElementById('focusFilter'); if (focusEl) focusEl.value = '';
            document.getElementById('vendorFilter').value = '';
            document.getElementById('partnershipFilter').value = '';
            const sortEl = document.getElementById('sortFilter'); if (sortEl) sortEl.value = 'level-asc';
            document.querySelector('.search-input').value = '';
            sessionStorage.removeItem('appliedFilters');
            document.getElementById('dynamic-results').innerHTML = '';
            document.getElementById('level-modules').innerHTML = '';
        }

        function clearUrlState(){
            try {
                history.replaceState(null, '', location.pathname);
            } catch(_) {}
        }

        // Load external certifications dataset (if available), then auto-apply on filter inputs
        document.addEventListener('DOMContentLoaded', function () {
            // Heuristic enrichment for external datasets so ranking/chronology work across all items
            function enrichImportedCerts(list){
                const neutralNames = [/tech\+/i, /itf\+/i, /a\+/i, /network\+/i, /security\+/i, /linux\+/i, /itil 4 foundation/i, /cc\s?\b\)?$/i, /ccsk/i, /lfca/i, /kcna/i, /capm/i, /csm/i, /splunk core certified user/i];
                const vendorDefaults = {
                    'CompTIA': { pop: 0.8, sal: 0.55 }, 'Cisco': { pop: 0.85, sal: 0.65 }, 'AWS': { pop: 0.9, sal: 0.7 }, 'Microsoft': { pop: 0.93, sal: 0.73 },
                    'Google Cloud': { pop: 0.75, sal: 0.65 }, '(ISC)Â²': { pop: 0.8, sal: 0.75 }, 'ISACA': { pop: 0.7, sal: 0.7 }, 'Linux Foundation': { pop: 0.7, sal: 0.65 },
                    'PeopleCert': { pop: 0.7, sal: 0.55 }, 'VMware/Omnissa': { pop: 0.75, sal: 0.7 }, 'Red Hat': { pop: 0.7, sal: 0.7 },
                    'Check Point': { pop: 0.65, sal: 0.65 }, 'Sophos': { pop: 0.6, sal: 0.6 }, 'Elastic': { pop: 0.65, sal: 0.65 },
                    'Databricks': { pop: 0.7, sal: 0.7 }, 'Nutanix': { pop: 0.65, sal: 0.65 }, 'Dell Technologies': { pop: 0.65, sal: 0.65 },
                    'Fortinet': { pop: 0.74, sal: 0.63 }
                };
                const trackByCategory = {
                    'core-it': 'network', 'cloud-platforms': 'cloud', 'cybersecurity': 'security', 'software-devops': 'devops', 'governance-agile': 'governance',
                    'specialized-tech': 'specialized', 'emerging-tech': 'emerging'
                };
                const addTags = (c)=>{
                    const tags = new Set(c.tags || []);
                    const nm = String(c.name||'');
                    if (/tech\+/i.test(nm) || /itf\+/i.test(nm) || /a\+/i.test(nm)) tags.add('foundation-it');
                    if (/network\+/i.test(nm) || /ccna/i.test(nm) || /jncia/i.test(nm)) tags.add('foundation-network');
                    if (/az-900/i.test(nm) || /cloud practitioner|clf-c0/i.test(nm)) tags.add('vendor-cloud-fund');
                    c.tags = Array.from(tags);
                };
                const derive = (c)=>{
                    const out = { ...c };
                    const nm = String(out.name||'');
                    const exam = String(out.exam||'');
                    // neutral
                    if (typeof out.neutral === 'undefined') out.neutral = neutralNames.some(rx=>rx.test(out.name||''));
                    // tracks
                    if (!Array.isArray(out.tracks) || !out.tracks.length) {
                        const t = trackByCategory[out.category] || (/(data|db)/i.test(out.focus||'')?'data':null);
                        out.tracks = t ? [t] : [];
                        if (out.neutral && (/(foundation|associate|fundamentals|entry)/i.test(out.name||'') || (out.level|0)===1)) out.tracks.push('support');
                    }
                    // Microsoft solution areas and stage
                    if (out.vendor === 'Microsoft') {
                        // solution areas: Infrastructure (Azure), Data & AI, Digital & App Innovation (incl. Power Platform), Modern Work (M365), Security
                        const s = (exam+nm).toUpperCase();
                        if (s.includes('AZ-')) out.solution_area = 'Infrastructure';
                        if (s.includes('DP-') || s.includes('AI-') || /DATA|AI/i.test(nm)) out.solution_area = out.solution_area || 'Data & AI';
                        if (s.includes('AZ-204') || s.includes('PL-') || /Developer|App/i.test(nm)) out.solution_area = out.solution_area || 'Digital & App Innovation';
                        if (s.includes('MS-') || /Microsoft 365|Modern Work/i.test(nm)) out.solution_area = out.solution_area || 'Modern Work';
                        if (s.includes('SC-') || /Security|Identity|Compliance/i.test(nm)) out.solution_area = out.solution_area || 'Security';
                        // ms_level
                        if (/\b(AZ|DP|AI|SC|MS)-900\b/i.test(s)) out.vendor_stage = 'Fundamentals';
                        else if (/\b(AZ|DP|AI|SC|MS)-(1|2)\d{2}\b/i.test(s)) out.vendor_stage = 'Associate';
                        else if (/\bAZ-305\b/i.test(s)) out.vendor_stage = 'Expert';
                        out.vendor_area = out.solution_area;
                    }
                    // AWS vendor stages
                    if (out.vendor === 'AWS') {
                        const s = (exam+nm).toUpperCase();
                        if (s.includes('CLF-') || /Cloud Practitioner/i.test(nm)) out.vendor_stage = 'Foundational';
                        else if (/\b(SAA|DVA|SOA)-/i.test(s)) out.vendor_stage = 'Associate';
                        else if (/\b(SAP|DOP)-/i.test(s)) out.vendor_stage = 'Professional';
                        else if (/\bSCS-\b/i.test(s) || /Specialty/i.test(nm)) out.vendor_stage = 'Specialty';
                        // AWS domains
                        if (/Architect/i.test(nm) || /SAA-/i.test(s)) out.vendor_area = 'Architect';
                        else if (/Developer|DVA-/i.test(s)) out.vendor_area = 'Developer';
                        else if (/SysOps|SOA-/i.test(s)) out.vendor_area = 'Operations';
                        else if (/Security|SCS-/i.test(s)) out.vendor_area = 'Security';
                        else if (/Data|Analytics/i.test(nm)) out.vendor_area = 'Data';
                        else if (/Machine Learning|ML/i.test(nm)) out.vendor_area = 'Machine Learning';
                        else if (/Cloud Practitioner|CLF-/i.test(s)) out.vendor_area = 'Foundations';
                    }
                    // CompTIA vendor areas and stages
                    if (out.vendor === 'CompTIA') {
                        const nmU = nm.toUpperCase();
                        // Areas
                        if (/TECH\+|Media & EntertaF\+/i.test(nm)) {
                            out.vendor_area = 'Foundations';
                            out.vendor_stage = out.vendor_stage || 'Foundational';
                        } else if (/A\+/.test(nmU)) {
                            out.vendor_area = 'Infrastructure';
                            out.vendor_stage = out.vendor_stage || 'Associate';
                        } else if (/NETWORK\+/.test(nmU)) {
                            out.vendor_area = 'Infrastructure';
                            out.vendor_stage = out.vendor_stage || 'Associate';
                        } else if (/SERVER\+/.test(nmU)) {
                            out.vendor_area = 'Infrastructure';
                            out.vendor_stage = out.vendor_stage || 'Professional';
                        } else if (/LINUX\+/.test(nmU)) {
                            out.vendor_area = 'Infrastructure';
                            out.vendor_stage = out.vendor_stage || 'Professional';
                        } else if (/SECURMedia & EntertaYX/i.test(nm)) {
                            out.vendor_area = 'Xpert';
                            out.vendor_stage = out.vendor_stage || 'Expert';
                        } else if (/SECURMedia & EntertaY\+/.test(nmU)) {
                            out.vendor_area = 'Cybersecurity (Defense)';
                            out.vendor_stage = out.vendor_stage || 'Professional';
                        } else if (/CYSA\+/.test(nmU)) {
                            out.vendor_area = 'Cybersecurity (Defense)';
                            out.vendor_stage = out.vendor_stage || 'Professional';
                        } else if (/PENTEST\+/.test(nmU)) {
                            out.vendor_area = 'Offensive Cybersecurity';
                            out.vendor_stage = out.vendor_stage || 'Professional';
                        } else if (/CLOUDNETX/i.test(nm)) {
                            out.vendor_area = 'Cloud';
                            out.vendor_stage = out.vendor_stage || 'Expert';
                        } else if (/CLOUD\+/.test(nmU)) {
                            out.vendor_area = 'Cloud';
                            out.vendor_stage = out.vendor_stage || 'Professional';
                        } else if (/DATAX/i.test(nm)) {
                            out.vendor_area = 'Data & Analytics';
                            out.vendor_stage = out.vendor_stage || 'Expert';
                        } else if (/DATASYS\+/.test(nmU)) {
                            out.vendor_area = 'Data & Analytics';
                            out.vendor_stage = out.vendor_stage || 'Professional';
                        } else if (/DATA\+/.test(nmU)) {
                            out.vendor_area = 'Data & Analytics';
                            out.vendor_stage = out.vendor_stage || 'Professional';
                        }
                    }
                    // Google Cloud stages (basic)
                    if (out.vendor === 'Google Cloud') {
                        if (/Digital Leader/i.test(nm)) out.vendor_stage = 'Foundational';
                        else if (/Associate/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/Professional/i.test(nm)) out.vendor_stage = 'Professional';
                        if (/Architect/i.test(nm)) out.vendor_area = 'Architect';
                        else if (/Data Engineer|Analytics|BigQuery|Data/i.test(nm)) out.vendor_area = 'Data';
                        else if (/Machine Learning|ML|AI/i.test(nm)) out.vendor_area = 'Machine Learning';
                        else if (/Security/i.test(nm)) out.vendor_area = 'Security';
                        else if (/Cloud Engineer|Associate Cloud/i.test(nm)) out.vendor_area = 'Cloud Engineer';
                    }
                    // Cisco areas and stages
                    if (out.vendor === 'Cisco') {
                        const s = (exam+nm).toUpperCase();
                        if (/CCNA/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/CCNP|DEVNET PROFESSIONAL/i.test(s)) out.vendor_stage = 'Professional';
                        else if (/CCIE/i.test(s)) out.vendor_stage = 'Expert';
                        if (/DEVNET/i.test(s)) out.vendor_area = 'DevNet';
                        else if (/SEC|Security|SCOR/i.test(s)) out.vendor_area = 'Security';
                        else if (/DC|Data Center/i.test(s)) out.vendor_area = 'Data Center';
                        else if (/Collab|Collaboration/i.test(s)) out.vendor_area = 'Collaboration';
                        else if (/SP|Service Provider/i.test(s)) out.vendor_area = 'Service Provider';
                        else out.vendor_area = 'Enterprise';
                    }
                    // Juniper
                    if (out.vendor === 'Juniper') {
                        const s = (exam+nm).toUpperCase();
                        if (/JNCIA/i.test(s)) out.vendor_stage = 'Associate';
                        else if (/JNCIS/i.test(s)) out.vendor_stage = 'Specialist';
                        else if (/JNCIP/i.test(s)) out.vendor_stage = 'Professional';
                        else if (/JNCIE/i.test(s)) out.vendor_stage = 'Expert';
                        if (/Security/i.test(nm)) out.vendor_area = 'Security';
                        else if (/Service Provider|SP/i.test(nm)) out.vendor_area = 'Service Provider';
                        else if (/Data Center|DC/i.test(nm)) out.vendor_area = 'Data Center';
                        else out.vendor_area = 'Enterprise';
                    }
                    // Fortinet
                    if (out.vendor === 'Fortinet') {
                        const s = (exam+nm).toUpperCase();
                        if (/NSE\s?[1-2]/i.test(s)) out.vendor_stage = 'Fundamental';
                        else if (/NSE\s?[3-4]/i.test(s)) out.vendor_stage = 'Associate';
                        else if (/NSE\s?[5-6]/i.test(s)) out.vendor_stage = 'Professional';
                        else if (/NSE\s?[7-8]/i.test(s)) out.vendor_stage = 'Expert';
                        if (/Cloud/i.test(nm)) out.vendor_area = 'Cloud Security'; else out.vendor_area = 'Network Security';
                    }
                    // Aruba
                    if (out.vendor === 'Aruba') {
                        if (/ACMA|Associate/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/ACMP|Professional/i.test(nm)) out.vendor_stage = 'Professional';
                        else if (/ACMX|Expert/i.test(nm)) out.vendor_stage = 'Expert';
                        out.vendor_area = /Switch|CX/i.test(nm) ? 'Switching' : 'Wireless';
                    }
                    // CWNP
                    if (out.vendor === 'CWNP') {
                        if (/CWNA|CWS|CWT/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/CWSP|CWDP|CWAP/i.test(nm)) out.vendor_stage = 'Professional';
                        else if (/CWNE/i.test(nm)) out.vendor_stage = 'Expert';
                        out.vendor_area = 'Wireless';
                    }
                    // Red Hat
                    if (out.vendor === 'Red Hat') {
                        if (/RHCSA/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/RHCE/i.test(nm)) out.vendor_stage = 'Professional';
                        out.vendor_area = /OpenShift|Containers/i.test(nm) ? 'OpenShift' : (/Ansible/i.test(nm) ? 'Automation' : 'Linux');
                    }
                    // SUSE
                    if (out.vendor === 'SUSE') {
                        if (/SCA/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/SCE/i.test(nm)) out.vendor_stage = 'Professional';
                        out.vendor_area = /Rancher|Kubernetes/i.test(nm) ? 'Kubernetes' : 'Linux';
                    }
                    // VMware/Omnissa
                    if (out.vendor === 'VMware/Omnissa') {
                        if (/VCTA/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/VCP/i.test(nm)) out.vendor_stage = 'Professional';
                        else if (/VCAP/i.test(nm)) out.vendor_stage = 'Advanced Professional';
                        else if (/VCDX/i.test(nm)) out.vendor_stage = 'Expert';
                        if (/NSX|Network/i.test(nm)) out.vendor_area = 'Network Virtualization';
                        else if (/Horizon|Workspace/i.test(nm)) out.vendor_area = 'Digital Workspace';
                        else if (/vSphere|Data Center|DCV/i.test(nm)) out.vendor_area = 'Data Center Virtualization';
                        else out.vendor_area = 'Cloud Mgmt & Automation';
                    }
                    // Snowflake
                    if (out.vendor === 'Snowflake') {
                        out.vendor_area = /Architect/i.test(nm) ? 'Architect' : (/Data Engineer/i.test(nm) ? 'Data Engineering' : (/Analyst|Analytics/i.test(nm) ? 'Data Analytics' : 'Administrator'));
                        if (/Associate/i.test(nm)) out.vendor_stage = 'Associate'; else if (/Professional/i.test(nm)) out.vendor_stage = 'Professional';
                    }
                    // MongoDB
                    if (out.vendor === 'MongoDB') {
                        out.vendor_area = /Developer/i.test(nm) ? 'Developer' : 'Database Administration';
                        if (/Associate/i.test(nm)) out.vendor_stage = 'Associate'; else if (/Professional/i.test(nm)) out.vendor_stage = 'Professional';
                    }
                    // NetApp
                    if (out.vendor === 'NetApp') {
                        out.vendor_area = /Hybrid|Cloud/i.test(nm) ? 'Hybrid Cloud' : 'Data Storage';
                        if (/Associate/i.test(nm)) out.vendor_stage = 'Associate'; else if (/Professional|Specialist/i.test(nm)) out.vendor_stage = 'Professional';
                    }
                    // Oracle
                    if (out.vendor === 'Oracle') {
                        out.vendor_area = /Database|SQL/i.test(nm) ? 'Database' : (/OCI|Cloud/i.test(nm) ? 'Cloud Infrastructure' : 'Applications');
                        if (/Associate/i.test(nm)) out.vendor_stage = 'Associate'; else if (/Professional/i.test(nm)) out.vendor_stage = 'Professional'; else if (/Master/i.test(nm)) out.vendor_stage = 'Expert';
                    }
                    // (ISC)Â²
                    if (out.vendor === '(ISC)Â²') {
                        out.vendor_area = /Cloud Security|CCSP/i.test(nm) ? 'Cloud Security' : 'Cybersecurity';
                        if (/CC\b|Entry/i.test(nm)) out.vendor_stage = 'Foundational'; else out.vendor_stage = 'Professional';
                    }
                    // ISACA
                    if (out.vendor === 'ISACA') {
                        if (/CISA/i.test(nm)) out.vendor_area = 'Audit';
                        else if (/CISM/i.test(nm)) out.vendor_area = 'Management & Governance';
                        else if (/CRISC/i.test(nm)) out.vendor_area = 'Risk'; else out.vendor_area = 'Governance';
                        out.vendor_stage = /Foundation|Fundamental|Certified in/i.test(nm) ? 'Professional' : 'Professional';
                    }
                    // EC-Council
                    if (out.vendor === 'EC-Council') {
                        // Respect vendor_area if provided; otherwise infer from name
                        if (!out.vendor_area) {
                            if (/Forensic|CHFI/i.test(nm)) out.vendor_area = 'Forensics';
                            else if (/CEH|Penetration|CPENT|W\|AHS/i.test(nm)) out.vendor_area = 'Offensive Security';
                            else if (/Cloud Security|C\|CSE/i.test(nm)) out.vendor_area = 'Cloud Security';
                            else if (/DevSecOps|C\|ASE|Application Security/i.test(nm)) out.vendor_area = 'Application Security';
                            else if (/SOC/i.test(nm)) out.vendor_area = 'SOC';
                            else if (/Incident|E\|CIH/i.test(nm)) out.vendor_area = 'Incident Response';
                            else if (/Threat Intelligence|C\|TIA/i.test(nm)) out.vendor_area = 'Threat Intelligence';
                            else if (/C\|ND|Network Defense/i.test(nm)) out.vendor_area = 'Blue Team';
                            else if (/Blockchain/i.test(nm)) out.vendor_area = 'Blockchain';
                            else if (/Disaster Recovery|E\|DRP/i.test(nm)) out.vendor_area = 'BCDR';
                            else if (/C\|CISO/i.test(nm)) out.vendor_area = 'Management & Leadership';
                            else if (/Encryption|E\|CES/i.test(nm)) out.vendor_area = 'Encryption & Crypto';
                            else if (/Essential/i.test(nm)|/C\|SCU|E\|CSS|C\|CT/.test(nm)) out.vendor_area = 'Foundations';
                            else out.vendor_area = 'Cybersecurity';
                        }
                        // Stage inference: Essentials/CSCU/ECSS/C|CT are foundational; Associate C|CISO is Associate; others default Professional
                        if (/Essential|C\|SCU|E\|CSS|C\|CT/i.test(nm)) out.vendor_stage = 'Foundational';
                        else if (/Associate C\|CISO/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/Master/i.test(nm)) out.vendor_stage = 'Professional';
                        else out.vendor_stage = out.vendor_stage || 'Professional';
                    }
                    // GIAC
                    if (out.vendor === 'GIAC') {
                        out.vendor_area = /Forensic|Forensics|GCFA|GCFE/i.test(nm) ? 'DFIR' : (/Penetration|GPEN|GXPN|OSCP/i.test(nm) ? 'Offensive Security' : (/Cloud|GCSA/i.test(nm) ? 'Cloud Security' : 'Blue Team'));
                        out.vendor_stage = 'Professional';
                    }
                    // IAPP
                    if (out.vendor === 'IAPP') {
                        out.vendor_area = 'Privacy';
                        out.vendor_stage = 'Professional';
                    }
                    // CSA
                    if (out.vendor === 'CSA') {
                        out.vendor_area = 'Cloud Security';
                        out.vendor_stage = /CCSK/i.test(nm) ? 'Foundational' : 'Professional';
                    }
                    // PeopleCert (Media & EntertaIL/PRINCE2)
                    if (out.vendor === 'PeopleCert') {
                        if (/Media & EntertaIL/i.test(nm)) {
                            out.vendor_area = 'Media & EntertaIL';
                            out.vendor_stage = /Foundation/i.test(nm) ? 'Fundamentals' : (/Managing Professional|MP|Leader/i.test(nm) ? 'Professional' : 'Associate');
                        } else if (/PRINCE2|PRINCE 2/i.test(nm)) {
                            out.vendor_area = 'Project Management';
                            out.vendor_stage = /Foundation/i.test(nm) ? 'Fundamentals' : 'Professional';
                        } else {
                            out.vendor_area = 'Service Mgmt';
                        }
                    }
                    // PMI
                    if (out.vendor === 'PMI') {
                        out.vendor_area = /Agile|ACP/i.test(nm) ? 'Agile' : 'Project Management';
                        out.vendor_stage = /CAPM/i.test(nm) ? 'Associate' : (/PMP|PgMP/i.test(nm) ? 'Professional' : 'Professional');
                    }
                    // Scrum Alliance
                    if (out.vendor === 'Scrum Alliance') {
                        if (/Product Owner|CSPO/i.test(nm)) out.vendor_area = 'Product Ownership';
                        else if (/Developer|CSD/i.test(nm)) out.vendor_area = 'Developer';
                        else out.vendor_area = 'Scrum Mastery';
                        out.vendor_stage = /Advanced|A-CSM|A-CSPO/i.test(nm) ? 'Professional' : 'Associate';
                    }
                    // Veeam
                    if (out.vendor === 'Veeam') {
                        out.vendor_area = /Architect|VMCA/i.test(nm) ? 'Architecture' : 'Data Protection';
                        out.vendor_stage = /Associate/i.test(nm) ? 'Associate' : (/Professional|Engineer|VMCE/i.test(nm) ? 'Professional' : 'Professional');
                    }
                    // Splunk
                    if (out.vendor === 'Splunk') {
                        if (/Core/i.test(nm)) out.vendor_area = 'Core'; else if (/Observability/i.test(nm)) out.vendor_area = 'Observability'; else out.vendor_area = 'Security';
                        out.vendor_stage = /User/i.test(nm) ? 'Associate' : (/Admin|Architect/i.test(nm) ? 'Professional' : 'Professional');
                    }
                    // Citrix
                    if (out.vendor === 'Citrix') {
                        if (/CCA-V|Associate/i.test(nm)) out.vendor_stage = 'Associate'; else if (/CCP-V|Professional/i.test(nm)) out.vendor_stage = 'Professional'; else if (/CCE-V|Expert/i.test(nm)) out.vendor_stage = 'Expert';
                        out.vendor_area = /Networking|ADC|NetScaler/i.test(nm) ? 'Networking' : 'Virtual Apps & Desktops';
                    }
                    // Teradata
                    if (out.vendor === 'Teradata') {
                        out.vendor_area = 'Data';
                        out.vendor_stage = /Associate/i.test(nm) ? 'Associate' : (/Professional/i.test(nm) ? 'Professional' : (/Master/i.test(nm) ? 'Expert' : 'Professional'));
                    }
                    // ForgeRock
                    if (out.vendor === 'ForgeRock') {
                        out.vendor_area = 'Identity & Access Mgmt';
                        out.vendor_stage = /Specialist|Professional/i.test(nm) ? 'Professional' : 'Associate';
                    }
                    // ETA International
                    if (out.vendor === 'ETA International') {
                        out.vendor_area = /Fiber|Telecom/i.test(nm) ? 'Telecom' : 'Electronics';
                        out.vendor_stage = /Associate|Installer|Technician/i.test(nm) ? 'Associate' : 'Professional';
                    }
                    // Linux Foundation
                    if (out.vendor === 'Linux Foundation') {
                        if (/LFCA/i.test(nm)) out.vendor_stage = 'Foundational'; else if (/LFCS/i.test(nm)) out.vendor_stage = 'Associate'; else if (/LFCE/i.test(nm)) out.vendor_stage = 'Professional';
                        out.vendor_area = /Kubernetes|CKA|CKAD|CKS|KCNA/i.test(nm) ? 'Kubernetes' : 'Linux';
                    }
                    // CNCF
                    if (out.vendor === 'CNCF') {
                        out.vendor_area = /KCNA/i.test(nm) ? 'Foundations' : (/CKA|CKAD|CKS/i.test(nm) ? 'Kubernetes' : 'Cloud Native');
                        out.vendor_stage = /KCNA/i.test(nm) ? 'Foundational' : 'Professional';
                    }
                    // Unity
                    if (out.vendor === 'Unity') {
                        out.vendor_area = /Artist|Designer/i.test(nm) ? 'Design' : 'Game Dev';
                        out.vendor_stage = /Associate/i.test(nm) ? 'Associate' : (/Professional|Expert/i.test(nm) ? 'Professional' : 'Associate');
                    }
                    // Huawei
                    if (out.vendor === 'Huawei') {
                        if (!out.vendor_area) {
                            if (/Datacom/i.test(nm)) out.vendor_area = 'Datacom';
                            else if (/Security/i.test(nm)) out.vendor_area = 'Security';
                            else if (/Cloud Service/i.test(nm)) out.vendor_area = 'Cloud Service';
                            else if (/5G|Carrier/i.test(nm)) out.vendor_area = '5G/Carrier';
                        }
                        if (/HCIA|Associate/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/HCIP|Professional/i.test(nm)) out.vendor_stage = 'Professional';
                        else if (/HCIE|Expert/i.test(nm)) out.vendor_stage = 'Expert';
                        else out.vendor_stage = out.vendor_stage || 'Professional';
                    }
                    // ZTE
                    if (out.vendor === 'ZTE') {
                        if (!out.vendor_area) {
                            if (/5G|Carrier/i.test(nm)) out.vendor_area = '5G/Carrier'; else out.vendor_area = 'Networking';
                        }
                        if (/ZCNE|Engineer/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/ZCNP|Professional/i.test(nm)) out.vendor_stage = 'Professional';
                        else if (/ZCIE|Expert/i.test(nm)) out.vendor_stage = 'Expert';
                    }
                    // NVIDIA
                    if (out.vendor === 'NVIDIA') {
                        out.vendor_area = /CUDA|Compute/i.test(nm) ? 'CUDA' : (/Omniverse|Graphics/i.test(nm) ? 'Graphics/Omniverse' : 'AI/ML');
                        out.vendor_stage = /Associate/i.test(nm) ? 'Associate' : 'Professional';
                    }
                    // Zend
                    if (out.vendor === 'Zend') {
                        out.vendor_area = 'PHP Development';
                        out.vendor_stage = 'Professional';
                    }
                    // Qt
                    if (out.vendor === 'Qt') {
                        out.vendor_area = /Designer/i.test(nm) ? 'UI/UX' : 'C++/Application Dev';
                        out.vendor_stage = 'Professional';
                    }
                    // Generic fallback inference for any vendor not covered above
                    if (!out.vendor_area) {
                        const text = `${nm} ${String(out.focus||'')} ${String(out.category||'')} ${(out.tracks||[]).join(' ')}`.toLowerCase();
                        if (/(security|soc|forensic|identity|iam|grc|privacy|siem)/i.test(text)) out.vendor_area = 'Security';
                        else if (/(cloud|azure|aws|gcp|oci)/i.test(text)) out.vendor_area = 'Cloud';
                        else if (/(data|database|sql|analytics|big data|warehouse)/i.test(text)) out.vendor_area = 'Data';
                        else if (/(network|routing|switch|wireless|5g|sp|service provider)/i.test(text)) out.vendor_area = 'Networking';
                        else if (/(devops|cicd|containers|kubernetes|platform|sre)/i.test(text)) out.vendor_area = 'DevOps';
                        else if (/(virtualization|vsphere|horizon|euc)/i.test(text)) out.vendor_area = 'Virtualization';
                        else if (/(storage|backup|protection)/i.test(text)) out.vendor_area = 'Storage';
                        else if (/(developer|programming|application|software)/i.test(text)) out.vendor_area = 'Developer';
                        else if (/(ai|ml|machine learning)/i.test(text)) out.vendor_area = 'AI/ML';
                        else if (/(project|agile|scrum|itil|service)/i.test(text)) out.vendor_area = 'Media & EntertaSM/PM';
                        else out.vendor_area = (out.focus || out.category || 'General');
                    }
                    if (!out.vendor_stage) {
                        if (/(foundation|fundamental|entry|beginner)/i.test(nm)) out.vendor_stage = 'Fundamentals';
                        else if (/(associate|junior)/i.test(nm)) out.vendor_stage = 'Associate';
                        else if (/(professional|engineer|administrator|architect)/i.test(nm)) out.vendor_stage = 'Professional';
                        else if (/(expert|master|advanced)/i.test(nm)) out.vendor_stage = 'Expert';
                    }
                    // level_range: small window around stated level
                    if (!Array.isArray(out.level_range)) {
                        const lv = Number(out.level)||1; out.level_range = [Math.max(1, lv), Math.min(5, lv+1)];
                    }
                    // prereqTags: basic heuristics
                    if (!Array.isArray(out.prereqTags)) {
                        const req = [];
                        const lv = Number(out.level)||1;
                        if (lv>1 && (out.category==='core-it' || out.tracks.includes('network'))) req.push('foundation-network');
                        if (lv>1) req.push('foundation-it');
                        if (/associate|administrator|engineer/i.test(out.name||'') && lv>=2 && out.category!=='governance-agile') req.push('foundation-it');
                        out.prereqTags = Array.from(new Set(req));
                    }
                    // time estimate by level
                    if (typeof out.time_estimate_months === 'undefined') {
                        const lv = Number(out.level)||1;
                        let est = lv<=1?2:lv===2?3.5:lv===3?5:lv===4?6.5:7.5;
                        if (out.neutral && lv===1) est = 1.5;
                        out.time_estimate_months = est;
                    }
                    // popularity/salary defaults
                    const vd = vendorDefaults[out.vendor] || { pop: 0.6, sal: 0.55 };
                    if (typeof out.popularity === 'undefined') out.popularity = vd.pop;
                    if (typeof out.salary_index === 'undefined') out.salary_index = vd.sal;
                    addTags(out);
                    return out;
                };
                return Array.isArray(list) ? list.map(derive) : list;
            }
            // Try to load external dataset
            fetch('../assets/data/media-certifications.json', { cache: 'no-store' })
                .then(r => (r.ok ? r.json() : Promise.reject(new Error('No dataset'))))
                .then(data => {
                    if (Array.isArray(data) && data.length) {
                        certifications = enrichImportedCerts(data);
                    }
                    buildFiltersFromDataset();
                    populateCategoryCardsFromDataset();
                    try { applyFilters(); } catch (_) {}
                })
                .catch(() => {
                    // Enrich inline seed too for consistent behavior
                    try { certifications = enrichImportedCerts(certifications); } catch(_) {}
                    buildFiltersFromDataset();
                    populateCategoryCardsFromDataset();
                    try { applyFilters(); } catch (_) {}
                });

                                                // Load optional pricing overrides
                                fetch('../assets/data/pricing.json', { cache: 'no-store' })
                                    .then(r => (r.ok ? r.json() : Promise.resolve(null)))
                                    .then(p => {
                                        if (p && typeof p === 'object') {
                                                                if (p.currency) pricingConfig.currency = p.currency;
                                                                if (p.levelBundle && typeof p.levelBundle === 'object') pricingConfig.levelBundle = Object.assign({}, pricingConfig.levelBundle, p.levelBundle);
                                        }
                                        try { applyFilters(); } catch(_) {}
                                    })
                                    .catch(()=>{});

                const selects = ['levelFilter', 'categoryFilter', 'focusFilter', 'trackFilter', 'vendorFilter', 'partnershipFilter', 'sortFilter']
                .map(id => document.getElementById(id))
                .filter(Boolean);
            selects.forEach(sel => sel.addEventListener('change', () => { try { setPage(1); applyFilters(); } catch (_) {} }));
            const searchInput = document.querySelector('.search-input');
            if (searchInput) searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { try { setPage(1); applyFilters(); } catch (_) {} } });
            // Toggle listeners
            document.getElementById('toggleVendorAnchor')?.addEventListener('change', ()=>{ try { setPage(1); applyFilters(); } catch(_){} });
            document.getElementById('toggleEligibleOnly')?.addEventListener('change', ()=>{ try { setPage(1); applyFilters(); } catch(_){} });
            document.getElementById('toggleStrictChronology')?.addEventListener('change', ()=>{ try { setPage(1); applyFilters(); } catch(_){} });
            document.getElementById('toggleRecommendedFirst')?.addEventListener('change', ()=>{ try { setPage(1); applyFilters(); } catch(_){} });
            // Rebuild vendor area options when vendor changes
            document.getElementById('vendorFilter')?.addEventListener('change', ()=>{ try { rebuildVendorAreaOptions(); } catch(_){} });
            document.getElementById('vendorAreaFilter')?.addEventListener('change', ()=>{ try { setPage(1); applyFilters(); } catch(_){} });

            // Copy shareable link
            document.getElementById('copyLinkBtn')?.addEventListener('click', async ()=>{
                try {
                    // ensure URL is current
                    try { applyFilters(); } catch(_) {}
                    await navigator.clipboard.writeText(location.href);
                    const btn = document.getElementById('copyLinkBtn');
                    if (btn) { const old = btn.innerHTML; btn.innerHTML = '<i class="fas fa-check"></i> Copied!'; setTimeout(()=>btn.innerHTML=old, 1200); }
                } catch(_) {}
            });

            // Group-by and density
            document.getElementById('groupByFilter')?.addEventListener('change', ()=>{ try { setPage(1); applyFilters(); } catch(_){} });
            document.getElementById('densityToggle')?.addEventListener('change', ()=>{ try { applyFilters(); } catch(_){} });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e)=>{
                if (e.target && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable)) return;
                if (e.key === '/') { e.preventDefault(); document.querySelector('.search-input')?.focus(); }
                if (e.key.toLowerCase() === 'g') {
                    let awaiting = true;
                    const handler = (ev)=>{
                        if (!awaiting) return;
                        awaiting = false;
                        document.removeEventListener('keydown', handler, true);
                        const k = ev.key?.toLowerCase();
                        if (k === 'v') document.getElementById('vendorFilter')?.focus();
                        if (k === 'c') document.getElementById('categoryFilter')?.focus();
                        if (k === 'l') document.getElementById('levelFilter')?.focus();
                    };
                    document.addEventListener('keydown', handler, true);
                    setTimeout(()=>{ awaiting=false; document.removeEventListener('keydown', handler, true); }, 800);
                }
            });

            // Restore from URL params on load
            try {
                const params = new URLSearchParams(location.search);
                const map = new Map([
                    ['level','levelFilter'],
                    ['category','categoryFilter'],
                    ['focus','focusFilter'],
                    ['tracks','trackFilter'],
                    ['vendor','vendorFilter'],
                    ['varea','vendorAreaFilter'],
                    ['partner','partnershipFilter'],
                    ['sort','sortFilter'],
                    ['q','.search-input']
                ]);
                for (const [key, target] of map.entries()) {
                    if (!params.has(key)) continue;
                    const val = params.get(key);
                    if (target === '.search-input') {
                        const si = document.querySelector('.search-input');
                        if (si) si.value = val || '';
                    } else {
                        const el = document.getElementById(target);
                        if (el) {
                            if (key==='tracks' && el instanceof HTMLSelectElement && el.multiple) {
                                const arr = (val||'').split('|').filter(Boolean);
                                Array.from(el.options).forEach(o=>o.selected = arr.includes(o.value));
                            } else {
                                el.value = val;
                            }
                        }
                    }
                }
                // After restoring vendor value, rebuild vendor area options to show correct list
                try { rebuildVendorAreaOptions(); } catch(_) {}
                try { setPage(1); applyFilters(); } catch(_) {}
            } catch (_) {}
        });

        // Helper to label vendor area per vendor
        function vendorAreaLabelByVendor(vendor){
            if (!vendor) return 'Vendor Area';
            if (vendor === 'Microsoft') return 'Microsoft Solution Area';
            if (vendor === 'AWS') return 'AWS Domain';
            if (vendor === 'Google Cloud') return 'Google Cloud Domain';
            if (vendor === 'Cisco') return 'Cisco Technology';
            if (vendor === 'VMware/Omnissa') return 'VMware/Omnissa Track';
            if (vendor === 'PeopleCert') return 'PeopleCert Area';
            return `${vendor} Area`;
        }

        // Canonical areas per vendor (ensures expected options appear even if dataset is sparse)
        const canonicalVendorAreas = {
            'Microsoft': ['Infrastructure', 'Data & AI', 'Digital & App Innovation', 'Modern Work', 'Security'],
            'AWS': ['Foundations', 'Architect', 'Developer', 'Operations', 'Security', 'Networking', 'Data', 'Machine Learning', 'Specialty'],
            'Google Cloud': ['Cloud Engineer', 'Architect', 'Developer', 'Data', 'Machine Learning', 'Security', 'Networking', 'Workspace'],
            'Cisco': ['Enterprise', 'Security', 'Data Center', 'Collaboration', 'Service Provider', 'DevNet'],
            // Newly supported vendors in dataset expansion
            'Red Hat': ['Linux', 'OpenShift', 'Ansible Automation', 'Middleware', 'OpenStack'],
            'Oracle': ['Cloud Infrastructure', 'Database', 'Java', 'Applications', 'Security'],
            'NetApp': ['Data Storage', 'Hybrid Cloud', 'Data Protection'],
            'Splunk': ['Core', 'Security', 'Observability'],
            'CWNP': ['Wireless'],
            'PeopleCert': ['Media & EntertaIL'],
            'Palo Alto Networks': ['Network Security', 'Cloud Security', 'SOAR', 'SASE'],
            'Fortinet': ['Network Security', 'Cloud Security', 'OT Security', 'SD-WAN'],
            'Juniper': ['Enterprise', 'Security', 'Service Provider', 'Data Center', 'Automation'],
            'VMware/Omnissa': ['Data Center Virtualization', 'Network Virtualization', 'Digital Workspace', 'Cloud Mgmt & Automation'],
            'EC-Council': ['Offensive Security', 'Blue Team', 'Forensics', 'SOC', 'Incident Response', 'Threat Intelligence', 'Cloud Security', 'DevSecOps', 'Blockchain', 'BCDR', 'Management & Leadership', 'Encryption & Crypto', 'Application Security', 'Essentials', 'Foundations'],
            'ServiceNow': ['Media & EntertaSM', 'Now Platform', 'HR Service Delivery', 'Customer Service Mgmt', 'App Dev'],
            'Snowflake': ['Data Engineering', 'Data Analytics', 'Data Science', 'Architecture', 'Administration'],
            'HashiCorp': ['Terraform', 'Vault', 'Consul', 'Nomad'],
            'SUSE': ['Linux', 'Kubernetes', 'Rancher'],
            'Huawei': ['Datacom', 'Security', 'Cloud Service', '5G/Carrier'],
            'ZTE': ['Networking', '5G/Carrier'],
            // Newly added vendors
            'Check Point': ['Network Security', 'Cloud Security', 'Endpoint Security'],
            'Sophos': ['Endpoint Security', 'Network Security', 'Email Security'],
            'Elastic': ['Search', 'Observability', 'Security'],
            'Databricks': ['Data Engineering', 'Machine Learning', 'Analytics'],
            'Nutanix': ['Multicloud Infrastructure', 'Automation'],
            'Dell Technologies': ['Data Center', 'Storage', 'Networking'],
            // Governance/Agile & adjacent
            'PMI': ['Project Management', 'Agile', 'Program & Portfolio Mgmt'],
            'Scrum Alliance': ['Scrum Mastery', 'Product Ownership', 'Developer'],
            // Foundations & Platforms
            'Linux Foundation': ['Linux', 'Cloud Native', 'Kubernetes'],
            // Virtualization & Data Protection
            'Citrix': ['Virtual Apps & Desktops', 'Networking'],
            'Veeam': ['Data Protection', 'Architecture'],
            // Privacy & Cloud Security
            'IAPP': ['Privacy'],
            'CSA': ['Cloud Security']
        };

        function rebuildVendorAreaOptions(){
            try {
                const group = document.getElementById('vendorAreaGroup');
                const label = document.getElementById('vendorAreaLabel');
                const select = document.getElementById('vendorAreaFilter');
                const vendorSel = document.getElementById('vendorFilter');
                if (!group || !select || !vendorSel) return;
                const vendor = vendorSel.value;
                if (!vendor) { group.style.display = 'none'; select.value=''; return; }
                // Collect vendor areas for selected vendor
                const areaSet = new Set();
                certifications.forEach(c => {
                    if (c.vendor !== vendor) return;
                    const areas = Array.isArray(c.vendor_area) ? c.vendor_area : (c.vendor_area ? [c.vendor_area] : (vendor==='Microsoft' && c.solution_area ? [c.solution_area] : []));
                    areas.forEach(a => { if (a && String(a).trim()) areaSet.add(String(a).trim()); });
                });
                let areas = Array.from(areaSet).sort((a,b)=>a.localeCompare(b));
                const canon = canonicalVendorAreas[vendor];
                if (Array.isArray(canon) && canon.length) {
                    // Union canonical (preserve canonical order) + discovered extras
                    const extras = areas.filter(a => !canon.includes(a)).sort((a,b)=>a.localeCompare(b));
                    areas = [...canon, ...extras];
                }
                if (!areas.length) {
                    if (Array.isArray(canon) && canon.length) {
                        areas = canon.slice();
                    } else {
                        group.style.display = 'none';
                        select.value='';
                        return;
                    }
                }
                label.innerHTML = `<i class="fas fa-diagram-project"></i> ${vendorAreaLabelByVendor(vendor)}`;
                const current = select.value;
                while (select.firstChild) select.removeChild(select.firstChild);
                const all = document.createElement('option'); all.value=''; all.textContent='All Areas'; select.appendChild(all);
                areas.forEach(a => { const opt=document.createElement('option'); opt.value=a; opt.textContent=a; select.appendChild(opt); });
                if (current && areas.includes(current)) select.value = current; else select.value='';
                group.style.display = '';
            } catch(_) {}
        }

        // Category Selection
        document.querySelectorAll('.category-card').forEach(card => {
            card.addEventListener('click', function() {
                const category = this.dataset.category;
                document.getElementById('categoryFilter').value = category;
                
                // Smooth scroll to filter section
                document.getElementById('certification-filtering').scrollIntoView({
                    behavior: 'smooth'
                });
                try { setPage(1); applyFilters(); } catch(_){}
            });
        });

        // Vendor Badge click (inside category cards): set both Category and Vendor filters
        document.querySelectorAll('.category-card .vendor-badge').forEach(badge => {
            // Accessibility attributes
            badge.setAttribute('role', 'button');
            badge.setAttribute('tabindex', '0');
            badge.addEventListener('click', function(e) {
                e.stopPropagation();
                const vendorName = this.textContent.trim();
                const category = this.closest('.category-card')?.dataset?.category || '';
                const categorySel = document.getElementById('categoryFilter');
                const vendorSel = document.getElementById('vendorFilter');
                if (categorySel && category) categorySel.value = category;
                if (vendorSel) vendorSel.value = vendorName;
                // Clear search to avoid stale narrowing
                const si = document.querySelector('.search-input');
                if (si) si.value = '';
                try { rebuildVendorAreaOptions(); } catch(_) {}
                document.getElementById('certification-filtering').scrollIntoView({ behavior: 'smooth' });
                try { setPage(1); applyFilters(); } catch(_){ }
            });
            // Keyboard support: Enter/Space
            badge.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            });
        });

        // Focus Area Tag Selection (sets Focus dropdown instead of search)
        document.querySelectorAll('.focus-area-tag').forEach(tag => {
            tag.addEventListener('click', function(e) {
                e.stopPropagation();
                const focusArea = this.textContent;
                const focusSel = document.getElementById('focusFilter');
                if (focusSel) {
                    // Try to match exact option text, else clear
                    const opt = Array.from(focusSel.options).find(o=>o.value===focusArea || o.textContent===focusArea);
                    focusSel.value = opt ? opt.value : '';
                }
                // Clear search so ranking/filters reflect Focus accurately
                const si = document.querySelector('.search-input');
                if (si) si.value = '';

                document.getElementById('certification-filtering').scrollIntoView({ behavior: 'smooth' });
                try { setPage(1); applyFilters(); } catch(_){ }
            });
        });

        // Export selected helper
        function exportSelected(format='json'){
            // Determine current level in UI
            const levelVal = parseInt(document.getElementById('levelFilter').value);
            const ids = levelVal && selectedByLevel[levelVal] ? Array.from(selectedByLevel[levelVal]) : [];
            const items = certifications.filter(c => ids.includes(c.id));
            if (!items.length) { alert('No certifications selected for current level.'); return; }
            if (format === 'csv') {
                const headers = ['id','name','vendor','category','focus','level','retired','premium','exam'];
                const rows = [headers.join(',')].concat(items.map(c=>headers.map(h=>JSON.stringify(c[h] ?? '')).join(',')));
                const blob = new Blob([rows.join('\n')], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `selected-level${levelVal}.csv`; a.click(); URL.revokeObjectURL(url);
            } else {
                const blob = new Blob([JSON.stringify(items,null,2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `selected-level${levelVal}.json`; a.click(); URL.revokeObjectURL(url);
            }
        }

        // Export current results helper
        function exportResults(format='json'){
            try { if (!Array.isArray(window.__lastFiltered)) applyFilters(); } catch(_) {}
            const items = Array.isArray(window.__lastFiltered) ? window.__lastFiltered : certifications.filter(c=>!c.retired);
            if (!items.length) { alert('No results to export. Try applying filters first.'); return; }
            if (format === 'csv') {
                const headers = ['id','name','vendor','category','focus','level','retired','premium','exam'];
                const rows = [headers.join(',')].concat(items.map(c=>headers.map(h=>JSON.stringify(c[h] ?? '')).join(',')));
                const blob = new Blob([rows.join('\n')], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `results-${Date.now()}.csv`; a.click(); URL.revokeObjectURL(url);
            } else {
                const blob = new Blob([JSON.stringify(items,null,2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url; a.download = `results-${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
            }
        }

        // Simple info modal (clean)
        function openInfoModal(payload){
            let backdrop = document.getElementById('modal-backdrop');
            if (!backdrop){
                backdrop = document.createElement('div');
                backdrop.id = 'modal-backdrop';
                backdrop.className = 'modal-backdrop';
                backdrop.innerHTML = `
                    <div class='modal-card' role='dialog' aria-modal='true' aria-labelledby='modal-title'>
                        <div class='modal-header'>
                            <div id='modal-title' class='modal-title'></div>
                            <button class='modal-close' aria-label='Close'><i class="fas fa-times"></i></button>
                        </div>
                        <div class='modal-body'>
                            <div class='kv'></div>
                            <div class='modal-sections'></div>
                            <div class='modal-meta'></div>
                        </div>
                    </div>`;
                document.body.appendChild(backdrop);
                backdrop.addEventListener('click', (e)=>{ if (e.target === backdrop) backdrop.classList.remove('active'); });
                backdrop.querySelector('.modal-close').addEventListener('click', ()=> backdrop.classList.remove('active'));
                // ESC-to-close
                document.addEventListener('keydown', (e)=>{
                    if (e.key === 'Escape') backdrop.classList.remove('active');
                });
            }
            backdrop.querySelector('#modal-title').textContent = payload.title || 'Details';
            const kv = backdrop.querySelector('.kv');
            kv.innerHTML = '';
            // Premium meta grid: render as columns (each with label above value)
            if (payload.meta && payload.meta.length) {
                const grid = document.createElement('div');
                grid.className = 'meta-grid';
                payload.meta.forEach(([k,v])=>{
                    const col = document.createElement('div'); col.className = 'col';
                    const lab = document.createElement('div'); lab.className = 'label'; lab.textContent = k;
                    const val = document.createElement('div'); val.className = 'value'; val.textContent = v;
                    col.appendChild(lab); col.appendChild(val);
                    grid.appendChild(col);
                });
                kv.appendChild(grid);
                // subtle divider under meta grid
                const divLine = document.createElement('div');
                divLine.className = 'meta-divider';
                kv.appendChild(divLine);
            }

            const sectionsEl = backdrop.querySelector('.modal-sections');
            sectionsEl.innerHTML = '';
            // Map headings to style modifiers and icons
            const sectionStyle = (heading='')=>{
                const key = heading.toLowerCase();
                if (key.includes('why we recommend')) return {cls:'-why', icon:'fa-lightbulb'};
                if (key.includes('focus')) return {cls:'-focus', icon:'fa-bullseye'};
                if (key.includes('purpose')) return {cls:'-purpose', icon:'fa-compass'};
                if (key.includes('impact')) return {cls:'-impact', icon:'fa-chart-line'};
                if (key.includes('use')) return {cls:'-usecases', icon:'fa-list-check'};
                if (key.includes('role')) return {cls:'-roles', icon:'fa-user-tie'};
                if (key.includes('compensation') || key.includes('salary')) return {cls:'-comp', icon:'fa-dollar-sign'};
                if (key.includes('personal development')) return {cls:'-pd', icon:'fa-heart-circle-check'};
                return {cls:'', icon:'fa-circle-info'};
            };
            (payload.sections || []).forEach(sec => {
                const s = document.createElement('div'); s.className='modal-section';
                const sty = sectionStyle(sec.heading || '');
                if (sty.cls) s.classList.add(sty.cls);
                const h = document.createElement('h3'); h.setAttribute('role','button'); h.setAttribute('tabindex','0'); h.setAttribute('aria-expanded','true');
                const ico = document.createElement('i'); ico.className = `fas ${sty.icon} section-icon`;
                const text = document.createElement('span'); text.textContent = sec.heading || '';
                const chev = document.createElement('i'); chev.className = 'fas fa-chevron-down chev';
                const copyBtn = (sec.copy && Array.isArray(sec.points)) ? (()=>{ const b=document.createElement('button'); b.textContent='Copy'; b.className='modal-copy-btn'; b.style.marginLeft='auto'; b.style.border='1px solid #cbd5e1'; b.style.background='#f8fafc'; b.style.borderRadius='6px'; b.style.fontSize='0.85rem'; b.style.padding='0.1rem 0.4rem'; return b; })() : null;
                h.appendChild(ico); h.appendChild(text); h.appendChild(chev);
                if (copyBtn) h.appendChild(copyBtn);
                s.appendChild(h);
                if (Array.isArray(sec.points)) {
                    const ul = document.createElement('ul');
                    sec.points.forEach(p=>{ const li=document.createElement('li'); li.textContent=p; ul.appendChild(li); });
                    s.appendChild(ul);
                } else if (sec.body) {
                    const p = document.createElement('p'); p.textContent = sec.body; s.appendChild(p);
                }
                const toggle = ()=>{
                    const isCollapsed = s.classList.toggle('collapsed');
                    h.setAttribute('aria-expanded', String(!isCollapsed));
                };
                h.addEventListener('click', toggle);
                h.addEventListener('keydown', (e)=>{ if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggle(); } });
                if (copyBtn) {
                    copyBtn.addEventListener('click', async (e)=>{
                        e.stopPropagation();
                        try {
                            const items = Array.from(s.querySelectorAll('ul li')).map(li=>`â¢ ${li.textContent}`);
                            await navigator.clipboard.writeText(items.join('\n'));
                            copyBtn.textContent = 'Copied';
                            setTimeout(()=>copyBtn.textContent='Copy', 1200);
                        } catch(_) {}
                    });
                }
                sectionsEl.appendChild(s);
            });

            const metaEl = backdrop.querySelector('.modal-meta');
            metaEl.innerHTML='';
            (payload.chips || []).forEach(ch=>{
                const c = document.createElement('span'); c.className='modal-chip'; c.innerHTML = ch; metaEl.appendChild(c);
            });
            backdrop.classList.add('active');
            // Focus trap: keep tab focus within modal when open
            const card = backdrop.querySelector('.modal-card');
            const focusables = card.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            const first = focusables[0];
            const last = focusables[focusables.length - 1];
            if (first) first.focus();
            const trap = (e)=>{
                if (!backdrop.classList.contains('active')) return;
                if (e.key !== 'Tab') return;
                if (e.shiftKey) {
                    if (document.activeElement === first) { e.preventDefault(); last.focus(); }
                } else {
                    if (document.activeElement === last) { e.preventDefault(); first.focus(); }
                }
            };
            card.addEventListener('keydown', trap);
        }

        // Print-friendly quote for a level (branded, clean)
        function printQuote(level){
            try {
                const ids = Array.from(getCumulativeSelection(level));
                const items = certifications.filter(c => ids.includes(c.id));
                const price = computeSubtotal(level);
                const when = new Date();
                const htmlRows = items.map(c => `<tr><td>${c.name}</td><td>${c.vendor}</td><td>${c.category}</td><td>${c.focus}</td><td>L${c.level}</td><td>${c.exam || ''}</td></tr>`).join('');
                const mods = (pdModules && pdModules[level]) ? pdModules[level].map(m=>`<li><strong>${m.code}</strong> â ${m.title} (${m.hours})</li>`).join('') : '';
                const baseHref = location.href.slice(0, location.href.lastIndexOf('/') + 1);

                const w = window.open('', '_blank');
                w.document.write(`<!doctype html>
                <html>
                    <head>
                        <meta charset="utf-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1">
                        <title>BTH Education Group â Quote L${level}</title>
                        <base href="${baseHref}">
                        <style>
                            :root { --border: #e2e8f0; --muted:#64748b; --ink:#0f172a; --bg:#ffffff; }
                            body { font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Arial, sans-serif; color: var(--ink); background: var(--bg); padding: 28px; }
                            .header { display:flex; justify-content:space-between; align-items:flex-start; border-bottom:1px solid var(--border); padding-bottom:12px; }
                            .brand { display:flex; align-items:center; gap:12px; font-weight:800; font-size:20px; letter-spacing:0.2px; }
                            .brand img.logo { height: 42px; width:auto; border-radius:6px; border:1px solid var(--border); background:#fff; padding:4px; }
                            .brand small { display:block; color: var(--muted); font-weight:600; margin-top:2px; }
                            .quote-box { text-align:right; }
                            .quote-title { font-size:24px; font-weight:800; margin:0; }
                            .quote-price { display:inline-block; margin-top:6px; background:#f1f5f9; border:1px solid var(--border); padding:6px 10px; border-radius:8px; font-weight:700; }
                            .meta { color: var(--muted); margin-top:8px; }
                            h2 { margin:18px 0 8px; font-size:16px; }
                            table { width:100%; border-collapse:collapse; margin-top:8px; }
                            th, td { border:1px solid var(--border); padding:8px; text-align:left; font-size:13px; }
                            th { background:#f8fafc; }
                            .two-col { display:flex; gap:24px; align-items:flex-start; }
                            .box { flex:1; border:1px solid var(--border); border-radius:8px; padding:12px; background:#fafafa; }
                            .siggrid { display:grid; grid-template-columns:1fr 1fr; gap:18px; margin-top:18px; }
                            .sig { border:1px dashed var(--border); border-radius:8px; padding:12px; min-height:100px; }
                            .sig label { display:block; color:var(--muted); font-size:12px; margin-bottom:6px; }
                            .legal { margin-top:18px; color:#475569; font-size:12px; border-top:1px solid var(--border); padding-top:12px; }
                            .footer { position: fixed; left: 0; right: 0; bottom: 0; border-top: 1px solid var(--border); padding: 8px 28px; display:flex; justify-content:space-between; align-items:center; background:#fff; }
                            .footer .left { display:flex; align-items:center; gap:10px; color:#334155; font-size:12px; }
                            .footer img { height: 26px; width:auto; border-radius:4px; border:1px solid var(--border); background:#fff; padding:2px; }
                            .footer .right { color:#64748b; font-size:12px; }
                            @page { margin: 18mm; }
                            @media print { body { padding-bottom: 40mm; } .no-print{ display:none } .footer .right::after { content: 'Page ' counter(page) ' of ' counter(pages); } }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <div class="brand">
                                <img class="logo" src="../assets/images/bthlogo.png" alt="BTH Logo" />
                                <div>
                                    BTH Education Group
                                    <small>Media & Entertainment Technology â Standard Professional Pathway</small>
                                </div>
                            </div>
                            <div class="quote-box">
                                <div class="quote-title">Quote: Level ${level}</div>
                                <div class="quote-price">Bundle Price: ${pricingConfig.currency} ${price.toLocaleString()}</div>
                                <div class="meta">Generated: ${when.toLocaleString()}</div>
                            </div>
                        </div>

                        <h2>Included Certifications (cumulative up to L${level})</h2>
                        <table>
                            <thead><tr><th>Certification</th><th>Vendor</th><th>Category</th><th>Focus</th><th>Level</th><th>Exam</th></tr></thead>
                            <tbody>${htmlRows || '<tr><td colspan=6>No certifications selected yet.</td></tr>'}</tbody>
                        </table>

                        <div class="two-col" style="margin-top:16px;">
                            <div class="box">
                                <h2 style="margin-top:0;">Professional Development Modules (L${level})</h2>
                                <ul style="margin:6px 0 0 16px;">${mods || '<li>See program outline for module details.</li>'}</ul>
                            </div>
                            <div class="box">
                                <h2 style="margin-top:0;">Summary</h2>
                                <div class="meta">Cumulative certifications: ${items.length}</div>
                                    <div class="meta">Estimated Overall Level Duration: ${levelDuration[level] || 'Varies'}</div>
                                <div class="meta">Bundle includes: Certifications, Exams (as applicable), and Level ${level} Professional Development modules.</div>
                                <div class="meta">Currency: ${pricingConfig.currency}</div>
                            </div>
                        </div>

                        <div class="siggrid">
                            <div class="sig"><label>Prepared For</label>Organization / Name: __________________________<br>Date: __________________________<br>Signature: __________________________</div>
                            <div class="sig"><label>Prepared By</label>BTH Representative: __________________________<br>Date: __________________________<br>Signature: __________________________</div>
                        </div>

                        <div class="legal">
                            <div>All product names, logos, and brands are property of their respective owners. Use of these names, logos, and brands does not imply endorsement. Logos displayed are used under brand guidelines and authorized exam delivery partnerships.</div>
                            <div style="margin-top:6px;">Authorized Pearson VUE Testing Center & Exam Delivery Partner (Site ID: 89828)</div>
                            <div style="margin-top:6px; color:#64748b;">This quote reflects level-based bundle pricing (certifications + professional development). Unless otherwise specified, pricing is subject to change and may be valid for a limited time.</div>
                        </div>

                        <div class="no-print" style="margin-top:18px;"><button onclick="window.print()">Print</button></div>

                        <div class="footer">
                            <div class="left">
                                <img src="../assets/images/bthlogo.png" alt="BTH Logo" />
                                <div>BTH Education Group â¢ www.btheducationgroup.com â¢ info@btheducationgroup.com</div>
                            </div>
                            <div class="right"></div>
                        </div>
                    </body>
                </html>`);
                w.document.close();
            } catch(e){ console.error(e); }
        }

    // Export cumulative selections up to a level for quoting (bundle pricing)
        function exportQuote(level, format='json'){
            try {
                const ids = Array.from(getCumulativeSelection(level));
                const items = certifications.filter(c => ids.includes(c.id));
                if (!items.length) { alert(`No selections for Level ${level} yet.`); return; }
                if (format === 'csv') {
                    const bundleHeaders = ['level','currency','bundlePrice'];
                    const bundleRow = [JSON.stringify(level), JSON.stringify(pricingConfig.currency), JSON.stringify(computeSubtotal(level))].join(',');
                    const itemHeaders = ['id','name','vendor','category','focus','level','retired','premium','exam'];
                    const itemRows = [itemHeaders.join(',')].concat(items.map(c=>itemHeaders.map(h=>JSON.stringify(c[h] ?? '')).join(',')));
                    const content = [bundleHeaders.join(','), bundleRow, '', ...itemRows].join('\n');
                    const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = `quote-level${level}.csv`; a.click(); URL.revokeObjectURL(url);
                } else {
                    const payload = { level, currency: pricingConfig.currency, bundlePrice: computeSubtotal(level), items };
                    const blob = new Blob([JSON.stringify(payload,null,2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url; a.download = `quote-level${level}.json`; a.click(); URL.revokeObjectURL(url);
                }
            } catch (e) { console.error(e); }
        }
    </script>
</body>
</html>